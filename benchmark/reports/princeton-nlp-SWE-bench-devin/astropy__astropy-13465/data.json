{
  "instance_id": "astropy__astropy-13465",
  "model_patch": "diff --git a/astropy/utils/diff.py b/astropy/utils/diff.py\nindex 1542030a9d..0149da643e 100644\n--- a/astropy/utils/diff.py\n+++ b/astropy/utils/diff.py\n@@ -165,7 +165,16 @@ def where_not_allclose(a, b, rtol=1e-5, atol=1e-8):\n     if not np.all(np.isfinite(b)):\n         b = np.ma.fix_invalid(b).data\n \n-    if atol == 0.0 and rtol == 0.0:\n-        # Use a faster comparison for the most simple (and common) case\n-        return np.where(a != b)\n-    return np.where(np.abs(a - b) > (atol + rtol * np.abs(b)))\n+    print(\"Comparing arrays with rtol:\", rtol, \"and atol:\", atol)\n+    print(\"Array a:\", a)\n+    print(\"Array b:\", b)\n+\n+    # Symmetric comparison to handle relative tolerance correctly\n+    not_close = np.logical_or(\n+        np.abs(a - b) > (atol + rtol * np.abs(b)),\n+        np.abs(b - a) > (atol + rtol * np.abs(a))\n+    )\n+\n+    print(\"Comparison result:\", not_close)\n+\n+    return np.where(not_close)\n",
  "model_name_or_path": "Devin",
  "pass_or_fail": "fail",
  "model_patch_files": [
    "astropy/utils/diff.py"
  ],
  "repo": "astropy/astropy",
  "base_commit": "0f3e4a6549bc8bb3276184a021ecdd3482eb5d13",
  "patch": "diff --git a/astropy/io/fits/diff.py b/astropy/io/fits/diff.py\n--- a/astropy/io/fits/diff.py\n+++ b/astropy/io/fits/diff.py\n@@ -1051,7 +1051,8 @@ def _report(self):\n             index = [x + 1 for x in reversed(index)]\n             self._writeln(f' Data differs at {index}:')\n             report_diff_values(values[0], values[1], fileobj=self._fileobj,\n-                               indent_width=self._indent + 1)\n+                               indent_width=self._indent + 1, rtol=self.rtol,\n+                               atol=self.atol)\n \n         if self.diff_total > self.numdiffs:\n             self._writeln(' ...')\n@@ -1130,7 +1131,8 @@ def _report(self):\n         for index, values in self.diff_bytes:\n             self._writeln(f' Data differs at byte {index}:')\n             report_diff_values(values[0], values[1], fileobj=self._fileobj,\n-                               indent_width=self._indent + 1)\n+                               indent_width=self._indent + 1, rtol=self.rtol,\n+                               atol=self.atol)\n \n         self._writeln(' ...')\n         self._writeln(' {} different bytes found ({:.2%} different).'\n@@ -1417,7 +1419,8 @@ def _report(self):\n             name, attr = col_attr\n             self._writeln(f' Column {name} has different {col_attrs[attr]}:')\n             report_diff_values(vals[0], vals[1], fileobj=self._fileobj,\n-                               indent_width=self._indent + 1)\n+                               indent_width=self._indent + 1, rtol=self.rtol,\n+                               atol=self.atol)\n \n         if self.diff_rows:\n             self._writeln(' Table rows differ:')\n@@ -1433,7 +1436,8 @@ def _report(self):\n         for indx, values in self.diff_values:\n             self._writeln(' Column {} data differs in row {}:'.format(*indx))\n             report_diff_values(values[0], values[1], fileobj=self._fileobj,\n-                               indent_width=self._indent + 1)\n+                               indent_width=self._indent + 1, rtol=self.rtol,\n+                               atol=self.atol)\n \n         if self.diff_values and self.numdiffs < self.diff_total:\n             self._writeln(' ...{} additional difference(s) found.'.format(\ndiff --git a/astropy/utils/diff.py b/astropy/utils/diff.py\n--- a/astropy/utils/diff.py\n+++ b/astropy/utils/diff.py\n@@ -43,7 +43,7 @@ def diff_values(a, b, rtol=0.0, atol=0.0):\n         return a != b\n \n \n-def report_diff_values(a, b, fileobj=sys.stdout, indent_width=0):\n+def report_diff_values(a, b, fileobj=sys.stdout, indent_width=0, rtol=0.0, atol=0.0):\n     \"\"\"\n     Write a diff report between two values to the specified file-like object.\n \n@@ -60,6 +60,10 @@ def report_diff_values(a, b, fileobj=sys.stdout, indent_width=0):\n     indent_width : int\n         Character column(s) to indent.\n \n+    rtol, atol : float\n+        Relative and absolute tolerances as accepted by\n+        :func:`numpy.allclose`.\n+\n     Returns\n     -------\n     identical : bool\n@@ -75,15 +79,19 @@ def report_diff_values(a, b, fileobj=sys.stdout, indent_width=0):\n                                indent_width=indent_width + 1)\n             return False\n \n-        diff_indices = np.transpose(np.where(a != b))\n+        if (np.issubdtype(a.dtype, np.floating) and\n+            np.issubdtype(b.dtype, np.floating)):\n+            diff_indices = np.transpose(where_not_allclose(a, b, rtol=rtol, atol=atol))\n+        else:\n+            diff_indices = np.transpose(np.where(a != b))\n+\n         num_diffs = diff_indices.shape[0]\n \n         for idx in diff_indices[:3]:\n             lidx = idx.tolist()\n-            fileobj.write(\n-                fixed_width_indent(f'  at {lidx!r}:\\n', indent_width))\n+            fileobj.write(fixed_width_indent(f'  at {lidx!r}:\\n', indent_width))\n             report_diff_values(a[tuple(idx)], b[tuple(idx)], fileobj=fileobj,\n-                               indent_width=indent_width + 1)\n+                               indent_width=indent_width + 1, rtol=rtol, atol=atol)\n \n         if num_diffs > 3:\n             fileobj.write(fixed_width_indent(\n",
  "test_patch": "diff --git a/astropy/io/fits/tests/test_diff.py b/astropy/io/fits/tests/test_diff.py\n--- a/astropy/io/fits/tests/test_diff.py\n+++ b/astropy/io/fits/tests/test_diff.py\n@@ -893,3 +893,35 @@ def test_fitsdiff_with_names(tmpdir):\n \n     diff = FITSDiff(path1, path2)\n     assert \"Extension HDU 1:\" in diff.report()\n+\n+\n+def test_rawdatadiff_diff_with_rtol(tmpdir):\n+    \"\"\"Regression test for https://github.com/astropy/astropy/issues/13330\"\"\"\n+    path1 = str(tmpdir.join(\"test1.fits\"))\n+    path2 = str(tmpdir.join(\"test2.fits\"))\n+    a = np.zeros((10, 2), dtype='float32')\n+    a[:, 0] = np.arange(10, dtype='float32') + 10\n+    a[:, 1] = np.arange(10, dtype='float32') + 20\n+    b = a.copy()\n+    changes = [(3, 13.1, 23.1), (8, 20.5, 30.5)]\n+    for i, v, w in changes:\n+        b[i, 0] = v\n+        b[i, 1] = w\n+\n+    ca = Column('A', format='20E', array=[a])\n+    cb = Column('A', format='20E', array=[b])\n+    hdu_a = BinTableHDU.from_columns([ca])\n+    hdu_a.writeto(path1, overwrite=True)\n+    hdu_b = BinTableHDU.from_columns([cb])\n+    hdu_b.writeto(path2, overwrite=True)\n+    with fits.open(path1) as fits1:\n+        with fits.open(path2) as fits2:\n+\n+            diff = FITSDiff(fits1, fits2, atol=0, rtol=0.001)\n+            str1 = diff.report(fileobj=None, indent=0)\n+\n+            diff = FITSDiff(fits1, fits2, atol=0, rtol=0.01)\n+            str2 = diff.report(fileobj=None, indent=0)\n+\n+    assert \"...and at 1 more indices.\" in str1\n+    assert \"...and at 1 more indices.\" not in str2\n",
  "problem_statement": "rtol for FITSDiff not working as expected. \nI have question about the rtol parameter for FITSDiff, when I create a report it appears that the numbers cited as being different are within the given relative tolerance.  I couldn't figure out why so I thought this may be a bug, apologies if I'm missing something super obvious here! \r\n\r\n\r\nHere's how to recreate the issue using FITSdiff, I included a zip file containing the two fits file and an example logfile.\r\n```python\r\nfrom astropy.io import fits\r\nfits1 = fits.open('TEST.0.bin0000.source0000.FITS')\r\nfits2 = fits.open('TEST.0.bin0000.source0000.FITS.benchmark')\r\nfd = fits.FITSDiff(fits1,fits2,ignore_keywords=['DATE-MAP','CDATE','HISTORY'],atol=0,rtol=0.01)\r\nfd.report(fileobj='logfile', indent=0, overwrite=True)\r\n```\r\n\r\n[bug_FITSdiff.zip](https://github.com/astropy/astropy/files/8892253/bug_FITSdiff.zip)\r\n\r\n\r\n```\r\nlogfile contents=\r\n fitsdiff: 4.0.2\r\n a: /home/usno/difx/DIFX-TRUNK/tests/DiFXtest/complex-complex/TEST.0.bin0000.source0000.FITS\r\n b: /home/usno/difx/DIFX-TRUNK/tests/DiFXtest/complex-complex//benchmark_results/TEST.0.bin0000.source0000.FITS\r\n Keyword(s) not to be compared:\r\n  CDATE DATE-MAP HISTORY\r\n Maximum number of different data values to be reported: 10\r\n Relative tolerance: 0.01, Absolute tolerance: 0.0\r\n\r\nExtension HDU 8:\r\n\r\n   Data contains differences:\r\n\r\n\r\n     Column FLUX data differs in row 5:\r\n        at [3]:\r\n          a> -1.3716967e-11\r\n           ?         ^^\r\n          b> -1.3716938e-11\r\n           ?         ^^\r\n        at [4]:\r\n          a> 0.21090482\r\n           ?          -\r\n          b> 0.2109048\r\n        at [6]:\r\n          a> 0.20984006\r\n           ?          ^\r\n          b> 0.20984003\r\n           ?          ^\r\n        ...and at 5766 more indices.\r\n     1 different table data element(s) found (0.26% different).\r\n```\n",
  "hints_text": "Welcome to Astropy \ud83d\udc4b and thank you for your first issue!\n\nA project member will respond to you as soon as possible; in the meantime, please double-check the [guidelines for submitting issues](https://github.com/astropy/astropy/blob/main/CONTRIBUTING.md#reporting-issues) and make sure you've provided the requested details.\n\nGitHub issues in the Astropy repository are used to track bug reports and feature requests; If your issue poses a question about how to use Astropy, please instead raise your question in the [Astropy Discourse user forum](https://community.openastronomy.org/c/astropy/8) and close this issue.\n\nIf you feel that this issue has not been responded to in a timely manner, please leave a comment mentioning our software support engineer @embray, or send a message directly to the [development mailing list](http://groups.google.com/group/astropy-dev).  If the issue is urgent or sensitive in nature (e.g., a security vulnerability) please send an e-mail directly to the private e-mail feedback@astropy.org.\nHas anyone gotten a chance to look at this and recreate the issue? I played around with numpy.allclose which is cited as the function fitsdiff uses here:\r\n\r\nrtol[float](https://docs.python.org/3/library/functions.html#float), optional\r\nThe relative difference to allow when comparing two float values either in header values, image arrays, or table columns (default: 0.0). Values which satisfy the expression\r\n\r\n|\ud835\udc4e\u2212\ud835\udc4f|>atol+rtol\u22c5|\ud835\udc4f|\r\nare considered to be different. The underlying function used for comparison is [numpy.allclose](https://numpy.org/doc/stable/reference/generated/numpy.allclose.html#numpy.allclose).\r\n(from: https://docs.astropy.org/en/stable/io/fits/api/diff.html)\r\n\r\nand using numpy.allclose the results are what I would expect them to be for the numbers in my original post:\r\n\r\n\r\nPython 3.8.5 (default, Sep  4 2020, 07:30:14) \r\n[GCC 7.3.0] :: Anaconda, Inc. on linux\r\nType \"help\", \"copyright\", \"credits\" or \"license\" for more information.\r\n>>> import numpy\r\n>>> numpy.allclose(-1.3716944e-11,-1.3716938e-11,rtol=0.01,atol=0.0, equal_nan=False)\r\nTrue\r\n>>> numpy.allclose(-1.3716944e-11,-1.3716938e-11,rtol=0.001,atol=0.0, equal_nan=False)\r\nTrue\r\n>>> numpy.allclose(-1.3716944e-11,-1.3716938e-11,rtol=0.0001,atol=0.0, equal_nan=False)\r\nTrue\r\n>>> numpy.allclose(-1.3716944e-11,-1.3716938e-11,rtol=0.00001,atol=0.0, equal_nan=False)\r\nTrue\r\n>>> numpy.allclose(-1.3716944e-11,-1.3716938e-11,rtol=0.000001,atol=0.0, equal_nan=False)\r\nTrue\r\n>>> numpy.allclose(-1.3716944e-11,-1.3716938e-11,rtol=0.0000001,atol=0.0, equal_nan=False)\r\nFalse\nIndeed there is a bug for multidimensional columns (which is the case for FLUX here). The code identifies the rows where the diff is greater than atol/rtol, and then delegates the printing to `report_diff_values` which doesn't use atol/rtol :\r\nhttps://github.com/astropy/astropy/blob/2f4b3d2e51e22d2b4309b9cd74aa723a49cfff99/astropy/utils/diff.py#L46",
  "created_at": "2022-07-19T08:36:06Z",
  "version": "5.0",
  "FAIL_TO_PASS": "[\"astropy/io/fits/tests/test_diff.py::test_rawdatadiff_diff_with_rtol\"]",
  "PASS_TO_PASS": "[\"astropy/io/fits/tests/test_diff.py::test_fitsdiff_hdu_name\", \"astropy/io/fits/tests/test_diff.py::test_fitsdiff_no_hdu_name\", \"astropy/io/fits/tests/test_diff.py::test_fitsdiff_with_names\"]",
  "environment_setup_commit": "cdf311e0714e611d48b0a31eb1f0e2cbffab7f23",
  "patch_files": [
    "astropy/io/fits/diff.py",
    "astropy/utils/diff.py"
  ],
  "test_patch_files": [
    "astropy/io/fits/tests/test_diff.py"
  ],
  "patch_diff_details": {
    "astropy/io/fits/diff.py": {
      "diffs": [
        {
          "start_line_old": 1054,
          "end_line_old": 1054,
          "file_pos": 1,
          "file_context_length": 12859,
          "closest_snippet_id": "/tmp/repos/astropy/astropy/io/fits/diff.py_TableDataDiff._report_TableDataDiff._report.13",
          "closest_snippet_line_distance": 344,
          "pos": 8,
          "context_length": 3294
        },
        {
          "start_line_old": 1133,
          "end_line_old": 1133,
          "file_pos": 1,
          "file_context_length": 12859,
          "closest_snippet_id": "/tmp/repos/astropy/astropy/io/fits/diff.py_HDUDiff._report_HDUDiff._report.7.3",
          "closest_snippet_line_distance": 530,
          "pos": 5,
          "context_length": 2005
        },
        {
          "start_line_old": 1420,
          "end_line_old": 1420,
          "file_pos": 1,
          "file_context_length": 12859,
          "closest_snippet_id": "/tmp/repos/astropy/astropy/io/fits/diff.py_RawDataDiff._report_RawDataDiff._report.5",
          "closest_snippet_line_distance": 283,
          "pos": 7,
          "context_length": 3015
        },
        {
          "start_line_old": 1436,
          "end_line_old": 1436,
          "file_pos": 1,
          "file_context_length": 12859,
          "closest_snippet_id": "/tmp/repos/astropy/astropy/io/fits/diff.py_RawDataDiff._report_RawDataDiff._report.5",
          "closest_snippet_line_distance": 299,
          "pos": 7,
          "context_length": 3015
        }
      ]
    },
    "astropy/utils/diff.py": {
      "diffs": [
        {
          "start_line_old": 46,
          "end_line_old": 46,
          "file_pos": 4,
          "file_context_length": 26707,
          "closest_snippet_id": "/tmp/repos/astropy/astropy/utils/diff.py_difflib_diff_values.2.3.1.1",
          "closest_snippet_line_distance": 3,
          "pos": 25,
          "context_length": 12896
        },
        {
          "start_line_old": 63,
          "end_line_old": 63,
          "file_pos": 4,
          "file_context_length": 26707,
          "closest_snippet_id": "/tmp/repos/astropy/astropy/utils/diff.py_difflib_diff_values.2.3.1.1",
          "closest_snippet_line_distance": 20,
          "pos": 25,
          "context_length": 12896
        },
        {
          "start_line_old": 78,
          "end_line_old": 86,
          "file_pos": 4,
          "file_context_length": 26707,
          "closest_snippet_id": "/tmp/repos/astropy/astropy/utils/diff.py_difflib_diff_values.2.3.1.1",
          "closest_snippet_line_distance": 43,
          "pos": 25,
          "context_length": 12896
        }
      ]
    }
  },
  "vectors": 4532,
  "snippets": [
    {
      "position": 1,
      "id": "/tmp/repos/astropy/astropy/io/fits/diff.py_FITSDiff._report_FITSDiff._report.13.2.4",
      "distance": 0.5398068428039551,
      "file_path": "astropy/io/fits/diff.py",
      "start_line": 357,
      "end_line": 419,
      "tokens": 595,
      "context_length": 595,
      "file_pos": 1
    },
    {
      "position": 2,
      "id": "/tmp/repos/astropy/astropy/io/fits/scripts/fitsdiff.py_main_",
      "distance": 0.5455852150917053,
      "file_path": "astropy/io/fits/scripts/fitsdiff.py",
      "start_line": 282,
      "end_line": 347,
      "tokens": 448,
      "context_length": 1043
    },
    {
      "position": 3,
      "id": "/tmp/repos/astropy/astropy/io/fits/diff.py_FITSDiff._diff_FITSDiff._diff.13.2.1.2.1",
      "distance": 0.6581212282180786,
      "file_path": "astropy/io/fits/diff.py",
      "start_line": 318,
      "end_line": 355,
      "tokens": 473,
      "context_length": 1516,
      "file_pos": 2
    },
    {
      "position": 4,
      "id": "/tmp/repos/astropy/astropy/io/fits/diff.py_HDUDiff._report_HDUDiff._report.7.3",
      "distance": 0.6696374416351318,
      "file_path": "astropy/io/fits/diff.py",
      "start_line": 578,
      "end_line": 603,
      "tokens": 270,
      "context_length": 1786,
      "file_pos": 2
    },
    {
      "position": 5,
      "id": "/tmp/repos/astropy/astropy/io/fits/diff.py_RawDataDiff._report_RawDataDiff._report.5",
      "distance": 0.677562415599823,
      "file_path": "astropy/io/fits/diff.py",
      "start_line": 1116,
      "end_line": 1137,
      "tokens": 219,
      "context_length": 2005,
      "file_pos": 2
    },
    {
      "position": 6,
      "id": "/tmp/repos/astropy/astropy/io/fits/scripts/fitsdiff.py_argparse_EPILOG.1",
      "distance": 0.6779618859291077,
      "file_path": "astropy/io/fits/scripts/fitsdiff.py",
      "start_line": 2,
      "end_line": 62,
      "tokens": 500,
      "context_length": 2505
    },
    {
      "position": 7,
      "id": "/tmp/repos/astropy/astropy/io/fits/diff.py_TableDataDiff._report_TableDataDiff._report.13",
      "distance": 0.6956421136856079,
      "file_path": "astropy/io/fits/diff.py",
      "start_line": 1398,
      "end_line": 1447,
      "tokens": 510,
      "context_length": 3015,
      "file_pos": 2
    },
    {
      "position": 8,
      "id": "/tmp/repos/astropy/astropy/io/fits/diff.py_ImageDataDiff._report_ImageDataDiff._report.5",
      "distance": 0.7284969091415405,
      "file_path": "astropy/io/fits/diff.py",
      "start_line": 1032,
      "end_line": 1059,
      "tokens": 279,
      "context_length": 3294,
      "file_pos": 2
    },
    {
      "position": 9,
      "id": "/tmp/repos/astropy/astropy/io/fits/diff.py_TableDataDiff._diff_TableDataDiff._diff.colsa.self.diff_ratio.1",
      "distance": 0.7319502234458923,
      "file_path": "astropy/io/fits/diff.py",
      "start_line": 1258,
      "end_line": 1396,
      "tokens": 1274,
      "context_length": 4568,
      "file_pos": 2
    },
    {
      "position": 10,
      "id": "/tmp/repos/astropy/astropy/io/fits/diff.py_FITSDiff.__init___FITSDiff.__init__.19.2.2.1",
      "distance": 0.7382015585899353,
      "file_path": "astropy/io/fits/diff.py",
      "start_line": 199,
      "end_line": 316,
      "tokens": 984,
      "context_length": 5552,
      "file_pos": 2
    },
    {
      "position": 11,
      "id": "/tmp/repos/astropy/astropy/io/fits/diff.py_HeaderDiff._report_HeaderDiff._report.4.1.2",
      "distance": 0.7586888074874878,
      "file_path": "astropy/io/fits/diff.py",
      "start_line": 872,
      "end_line": 904,
      "tokens": 342,
      "context_length": 5894,
      "file_pos": 2
    },
    {
      "position": 12,
      "id": "/tmp/repos/astropy/astropy/io/fits/diff.py_fnmatch__COL_ATTRS.1",
      "distance": 0.7762011289596558,
      "file_path": "astropy/io/fits/diff.py",
      "start_line": 8,
      "end_line": 39,
      "tokens": 242,
      "context_length": 6136,
      "file_pos": 2
    },
    {
      "position": 13,
      "id": "/tmp/repos/astropy/astropy/io/fits/scripts/fitsdiff.py_handle_options_handle_options.group.1",
      "distance": 0.7770487070083618,
      "file_path": "astropy/io/fits/scripts/fitsdiff.py",
      "start_line": 92,
      "end_line": 165,
      "tokens": 688,
      "context_length": 6824
    },
    {
      "position": 14,
      "id": "/tmp/repos/astropy/astropy/io/fits/convenience.py_printdiff.5_printdiff.5.11.1",
      "distance": 0.7857592105865479,
      "file_path": "astropy/io/fits/convenience.py",
      "start_line": 857,
      "end_line": 897,
      "tokens": 429,
      "context_length": 7253
    },
    {
      "position": 15,
      "id": "/tmp/repos/astropy/astropy/io/fits/diff.py_HDUDiff._diff_HDUDiff._diff.6.5.self.diff_data.self.diff_data.b.1",
      "distance": 0.8124759197235107,
      "file_path": "astropy/io/fits/diff.py",
      "start_line": 532,
      "end_line": 576,
      "tokens": 456,
      "context_length": 7709,
      "file_pos": 3
    },
    {
      "position": 16,
      "id": "/tmp/repos/astropy/astropy/io/fits/diff.py_ImageDataDiff._diff_ImageDataDiff._diff.self.diff_ratio.1",
      "distance": 0.8226891756057739,
      "file_path": "astropy/io/fits/diff.py",
      "start_line": 996,
      "end_line": 1030,
      "tokens": 313,
      "context_length": 8022,
      "file_pos": 3
    },
    {
      "position": 17,
      "id": "/tmp/repos/astropy/astropy/utils/diff.py_difflib_diff_values.2.3.1.1",
      "distance": 0.8326002359390259,
      "file_path": "astropy/utils/diff.py",
      "start_line": 1,
      "end_line": 43,
      "tokens": 250,
      "context_length": 8272,
      "file_pos": 4
    },
    {
      "position": 18,
      "id": "/tmp/repos/astropy/astropy/io/fits/scripts/fitsdiff.py_handle_options.14_handle_options.21.1",
      "distance": 0.8391908407211304,
      "file_path": "astropy/io/fits/scripts/fitsdiff.py",
      "start_line": 167,
      "end_line": 200,
      "tokens": 309,
      "context_length": 8581
    },
    {
      "position": 19,
      "id": "/tmp/repos/astropy/astropy/io/fits/diff.py_TableDataDiff.__init___TableDataDiff.__init__.23",
      "distance": 0.8491921424865723,
      "file_path": "astropy/io/fits/diff.py",
      "start_line": 1188,
      "end_line": 1256,
      "tokens": 561,
      "context_length": 9142,
      "file_pos": 4
    },
    {
      "position": 20,
      "id": "/tmp/repos/astropy/astropy/io/fits/diff.py_HDUDiff.__init___HDUDiff.__init__.16",
      "distance": 0.8551685810089111,
      "file_path": "astropy/io/fits/diff.py",
      "start_line": 451,
      "end_line": 530,
      "tokens": 657,
      "context_length": 9799,
      "file_pos": 4
    },
    {
      "position": 21,
      "id": "/tmp/repos/astropy/astropy/io/fits/diff.py_HeaderDiff.__init___HeaderDiff.__init__.35",
      "distance": 0.8587121963500977,
      "file_path": "astropy/io/fits/diff.py",
      "start_line": 649,
      "end_line": 763,
      "tokens": 919,
      "context_length": 10718,
      "file_pos": 4
    },
    {
      "position": 22,
      "id": "/tmp/repos/astropy/astropy/io/fits/diff.py_HeaderDiff.3_HeaderDiff._diff.21.12.1",
      "distance": 0.8658454418182373,
      "file_path": "astropy/io/fits/diff.py",
      "start_line": 765,
      "end_line": 870,
      "tokens": 903,
      "context_length": 11621,
      "file_pos": 4
    },
    {
      "position": 23,
      "id": "/tmp/repos/astropy/astropy/io/fits/diff.py_FITSDiff_FITSDiff.1",
      "distance": 0.8663465976715088,
      "file_path": "astropy/io/fits/diff.py",
      "start_line": 185,
      "end_line": 197,
      "tokens": 140,
      "context_length": 11761,
      "file_pos": 4
    },
    {
      "position": 24,
      "id": "/tmp/repos/astropy/astropy/io/fits/diff.py__BaseDiff.report__BaseDiff._report.1",
      "distance": 0.8676697015762329,
      "file_path": "astropy/io/fits/diff.py",
      "start_line": 123,
      "end_line": 182,
      "tokens": 405,
      "context_length": 12166,
      "file_pos": 4
    },
    {
      "position": 25,
      "id": "/tmp/repos/astropy/astropy/utils/diff.py_report_diff_values_report_diff_values.8.1",
      "distance": 0.8834055662155151,
      "file_path": "astropy/utils/diff.py",
      "start_line": 46,
      "end_line": 138,
      "tokens": 730,
      "context_length": 12896,
      "file_pos": 4
    },
    {
      "position": 26,
      "id": "/tmp/repos/astropy/astropy/io/fits/diff.py_30_ImageDataDiff.__init__.12",
      "distance": 0.8929410576820374,
      "file_path": "astropy/io/fits/diff.py",
      "start_line": 906,
      "end_line": 994,
      "tokens": 807,
      "context_length": 13703,
      "file_pos": 4
    },
    {
      "position": 27,
      "id": "/tmp/repos/astropy/astropy/io/fits/scripts/fitsdiff.py_match_files_match_files.7.1",
      "distance": 0.9000881910324097,
      "file_path": "astropy/io/fits/scripts/fitsdiff.py",
      "start_line": 233,
      "end_line": 279,
      "tokens": 429,
      "context_length": 14132
    },
    {
      "position": 28,
      "id": "/tmp/repos/astropy/astropy/io/fits/diff.py_report_diff_keyword_attr_",
      "distance": 0.901172935962677,
      "file_path": "astropy/io/fits/diff.py",
      "start_line": 1450,
      "end_line": 1470,
      "tokens": 157,
      "context_length": 14289,
      "file_pos": 4
    },
    {
      "position": 29,
      "id": "/tmp/repos/astropy/astropy/io/fits/convenience.py_printdiff_printdiff.has_extensions.1",
      "distance": 0.9242576360702515,
      "file_path": "astropy/io/fits/convenience.py",
      "start_line": 791,
      "end_line": 855,
      "tokens": 683,
      "context_length": 14972
    },
    {
      "position": 30,
      "id": "/tmp/repos/astropy/astropy/io/fits/diff.py_TableDataDiff_TableDataDiff.1",
      "distance": 0.9244004487991333,
      "file_path": "astropy/io/fits/diff.py",
      "start_line": 1140,
      "end_line": 1186,
      "tokens": 545,
      "context_length": 15517,
      "file_pos": 4
    },
    {
      "position": 31,
      "id": "/tmp/repos/astropy/astropy/io/fits/column.py__cmp_recformats__cmp_recformats.2.2.2.1",
      "distance": 0.940934419631958,
      "file_path": "astropy/io/fits/column.py",
      "start_line": 2311,
      "end_line": 2320,
      "tokens": 110,
      "context_length": 15627
    },
    {
      "position": 32,
      "id": "/tmp/repos/astropy/astropy/io/fits/convenience.py_operator___all__.1",
      "distance": 0.9533827304840088,
      "file_path": "astropy/io/fits/convenience.py",
      "start_line": 57,
      "end_line": 77,
      "tokens": 195,
      "context_length": 15822
    },
    {
      "position": 33,
      "id": "/tmp/repos/astropy/astropy/io/fits/diff.py_RawDataDiff_RawDataDiff._diff.4",
      "distance": 0.970884382724762,
      "file_path": "astropy/io/fits/diff.py",
      "start_line": 1062,
      "end_line": 1114,
      "tokens": 455,
      "context_length": 16277,
      "file_pos": 5
    },
    {
      "position": 34,
      "id": "/tmp/repos/astropy/astropy/io/fits/column.py_ASCII_DEFAULT_WIDTHS_91",
      "distance": 0.9729169607162476,
      "file_path": "astropy/io/fits/column.py",
      "start_line": 78,
      "end_line": 128,
      "tokens": 753,
      "context_length": 17030
    },
    {
      "position": 35,
      "id": "/tmp/repos/astropy/astropy/coordinates/transformations.py_FunctionTransformWithFiniteDifference.__call___FunctionTransformWithFiniteDifference.__call__.3.3.1.1",
      "distance": 0.9808292388916016,
      "file_path": "astropy/coordinates/transformations.py",
      "start_line": 997,
      "end_line": 1079,
      "tokens": 860,
      "context_length": 17890
    },
    {
      "position": 36,
      "id": "/tmp/repos/astropy/astropy/io/fits/scripts/fitsdiff.py_setup_logging_setup_logging.8",
      "distance": 0.988693356513977,
      "file_path": "astropy/io/fits/scripts/fitsdiff.py",
      "start_line": 203,
      "end_line": 230,
      "tokens": 196,
      "context_length": 18086
    },
    {
      "position": 37,
      "id": "/tmp/repos/astropy/astropy/io/fits/diff.py_HDUDiff_HDUDiff.1",
      "distance": 0.9929020404815674,
      "file_path": "astropy/io/fits/diff.py",
      "start_line": 422,
      "end_line": 449,
      "tokens": 323,
      "context_length": 18409,
      "file_pos": 6
    },
    {
      "position": 38,
      "id": "/tmp/repos/astropy/astropy/io/fits/scripts/fitscheck.py_setup_logging_verify_checksums.5.1",
      "distance": 0.9966928958892822,
      "file_path": "astropy/io/fits/scripts/fitscheck.py",
      "start_line": 126,
      "end_line": 166,
      "tokens": 301,
      "context_length": 18710
    },
    {
      "position": 39,
      "id": "/tmp/repos/astropy/astropy/io/fits/scripts/fitscheck.py_handle_options_handle_options.14.1",
      "distance": 0.9990301132202148,
      "file_path": "astropy/io/fits/scripts/fitscheck.py",
      "start_line": 66,
      "end_line": 123,
      "tokens": 398,
      "context_length": 19108
    },
    {
      "position": 40,
      "id": "/tmp/repos/astropy/astropy/io/fits/diff.py__BaseDiff.identical__BaseDiff.identical.2.1",
      "distance": 0.9991677403450012,
      "file_path": "astropy/io/fits/diff.py",
      "start_line": 109,
      "end_line": 121,
      "tokens": 117,
      "context_length": 19225,
      "file_pos": 7
    },
    {
      "position": 41,
      "id": "/tmp/repos/astropy/astropy/io/fits/scripts/fitscheck.py_verify_compliance_update.8.2.1",
      "distance": 1.0014663934707642,
      "file_path": "astropy/io/fits/scripts/fitscheck.py",
      "start_line": 169,
      "end_line": 200,
      "tokens": 258,
      "context_length": 19483
    },
    {
      "position": 42,
      "id": "/tmp/repos/astropy/astropy/io/misc/asdf/tags/fits/fits.py_2_FitsType.from_tree.5.1",
      "distance": 1.0237901210784912,
      "file_path": "astropy/io/misc/asdf/tags/fits/fits.py",
      "start_line": 2,
      "end_line": 35,
      "tokens": 250,
      "context_length": 19733
    },
    {
      "position": 43,
      "id": "/tmp/repos/astropy/astropy/coordinates/transformations.py_FunctionTransformWithFiniteDifference.finite_difference_frameattr_name_4_FunctionTransformWithFiniteDifference.finite_difference_frameattr_name_4.self._finite_difference_frameattr_name.1",
      "distance": 1.0369826555252075,
      "file_path": "astropy/coordinates/transformations.py",
      "start_line": 980,
      "end_line": 995,
      "tokens": 184,
      "context_length": 19917
    },
    {
      "position": 44,
      "id": "/tmp/repos/astropy/astropy/io/fits/diff.py__BaseDiff__BaseDiff.__bool__.2.1",
      "distance": 1.0470699071884155,
      "file_path": "astropy/io/fits/diff.py",
      "start_line": 42,
      "end_line": 80,
      "tokens": 321,
      "context_length": 20238,
      "file_pos": 8
    },
    {
      "position": 45,
      "id": "/tmp/repos/astropy/astropy/io/fits/diff.py__BaseDiff.fromdiff__BaseDiff.fromdiff.6.1",
      "distance": 1.0551457405090332,
      "file_path": "astropy/io/fits/diff.py",
      "start_line": 82,
      "end_line": 107,
      "tokens": 230,
      "context_length": 20468,
      "file_pos": 8
    },
    {
      "position": 46,
      "id": "/tmp/repos/astropy/astropy/io/fits/fitstime.py_time_to_fits.19_",
      "distance": 1.060998558998108,
      "file_path": "astropy/io/fits/fitstime.py",
      "start_line": 549,
      "end_line": 605,
      "tokens": 612,
      "context_length": 21080
    },
    {
      "position": 47,
      "id": "/tmp/repos/astropy/astropy/io/fits/scripts/fitscheck.py_sys_DESCRIPTION.1",
      "distance": 1.0718417167663574,
      "file_path": "astropy/io/fits/scripts/fitscheck.py",
      "start_line": 43,
      "end_line": 63,
      "tokens": 124,
      "context_length": 21204
    },
    {
      "position": 48,
      "id": "/tmp/repos/astropy/astropy/io/votable/exceptions.py_W19_W20.default_args.1",
      "distance": 1.0728929042816162,
      "file_path": "astropy/io/votable/exceptions.py",
      "start_line": 608,
      "end_line": 627,
      "tokens": 166,
      "context_length": 21370
    },
    {
      "position": 49,
      "id": "/tmp/repos/astropy/astropy/io/fits/diff.py_HeaderDiff_HeaderDiff.1",
      "distance": 1.0730319023132324,
      "file_path": "astropy/io/fits/diff.py",
      "start_line": 606,
      "end_line": 647,
      "tokens": 426,
      "context_length": 21796,
      "file_pos": 10
    },
    {
      "position": 50,
      "id": "/tmp/repos/astropy/astropy/io/fits/scripts/fitsdiff.py_StoreListAction_StoreListAction.__call__.4.4.1",
      "distance": 1.0791128873825073,
      "file_path": "astropy/io/fits/scripts/fitsdiff.py",
      "start_line": 65,
      "end_line": 89,
      "tokens": 238,
      "context_length": 22034
    },
    {
      "position": 51,
      "id": "/tmp/repos/astropy/examples/io/split-jpeg-to-fits.py_np_",
      "distance": 1.0820024013519287,
      "file_path": "examples/io/split-jpeg-to-fits.py",
      "start_line": 20,
      "end_line": 86,
      "tokens": 484,
      "context_length": 22518
    },
    {
      "position": 52,
      "id": "/tmp/repos/astropy/examples/io/modify-fits-header.py_2_",
      "distance": 1.0821716785430908,
      "file_path": "examples/io/modify-fits-header.py",
      "start_line": 17,
      "end_line": 84,
      "tokens": 509,
      "context_length": 23027
    },
    {
      "position": 53,
      "id": "/tmp/repos/astropy/examples/io/skip_create-large-fits.py_os_shape.1",
      "distance": 1.0826170444488525,
      "file_path": "examples/io/skip_create-large-fits.py",
      "start_line": 19,
      "end_line": 90,
      "tokens": 779,
      "context_length": 23806
    },
    {
      "position": 54,
      "id": "/tmp/repos/astropy/astropy/io/fits/hdu/compressed.py_ctypes_COMPRESSION_KEYWORDS.1",
      "distance": 1.0837923288345337,
      "file_path": "astropy/io/fits/hdu/compressed.py",
      "start_line": 3,
      "end_line": 63,
      "tokens": 524,
      "context_length": 24330
    },
    {
      "position": 55,
      "id": "/tmp/repos/astropy/astropy/io/fits/hdu/base.py__NonstandardHDU._writedata__NonstandardHDU._verify.4.1",
      "distance": 1.0860114097595215,
      "file_path": "astropy/io/fits/hdu/base.py",
      "start_line": 854,
      "end_line": 897,
      "tokens": 279,
      "context_length": 24609
    },
    {
      "position": 56,
      "id": "/tmp/repos/astropy/astropy/units/format/fits.py_Fits._validate_unit_Fits._get_unit_name.3.1",
      "distance": 1.0981154441833496,
      "file_path": "astropy/units/format/fits.py",
      "start_line": 82,
      "end_line": 108,
      "tokens": 201,
      "context_length": 24810
    },
    {
      "position": 57,
      "id": "/tmp/repos/astropy/astropy/visualization/scripts/fits2bitmap.py_main_",
      "distance": 1.100319743156433,
      "file_path": "astropy/visualization/scripts/fits2bitmap.py",
      "start_line": 113,
      "end_line": 165,
      "tokens": 603,
      "context_length": 25413
    },
    {
      "position": 58,
      "id": "/tmp/repos/astropy/astropy/units/format/fits.py_Fits._to_decomposed_alternative_",
      "distance": 1.104402780532837,
      "file_path": "astropy/units/format/fits.py",
      "start_line": 139,
      "end_line": 157,
      "tokens": 139,
      "context_length": 25552
    },
    {
      "position": 59,
      "id": "/tmp/repos/astropy/astropy/io/fits/hdu/table.py__binary_table_byte_swap_",
      "distance": 1.106215238571167,
      "file_path": "astropy/io/fits/hdu/table.py",
      "start_line": 1481,
      "end_line": 1548,
      "tokens": 473,
      "context_length": 26025
    },
    {
      "position": 60,
      "id": "/tmp/repos/astropy/astropy/io/fits/scripts/fitsheader.py_print_headers_as_comparison_print_headers_as_comparison.19",
      "distance": 1.1068824529647827,
      "file_path": "astropy/io/fits/scripts/fitsheader.py",
      "start_line": 331,
      "end_line": 400,
      "tokens": 537,
      "context_length": 26562
    },
    {
      "position": 61,
      "id": "/tmp/repos/astropy/astropy/stats/spatial.py_RipleysKEstimator.evaluate.6_",
      "distance": 1.113605260848999,
      "file_path": "astropy/stats/spatial.py",
      "start_line": 232,
      "end_line": 331,
      "tokens": 1383,
      "context_length": 27945
    },
    {
      "position": 62,
      "id": "/tmp/repos/astropy/astropy/time/formats.py_TimeFITS_TimeFITS.subfmts_7.1",
      "distance": 1.1141960620880127,
      "file_path": "astropy/time/formats.py",
      "start_line": 1644,
      "end_line": 1681,
      "tokens": 580,
      "context_length": 28525
    },
    {
      "position": 63,
      "id": "/tmp/repos/astropy/astropy/io/fits/column.py__convert_record2fits__convert_record2fits.11.1",
      "distance": 1.114926815032959,
      "file_path": "astropy/io/fits/column.py",
      "start_line": 2361,
      "end_line": 2403,
      "tokens": 357,
      "context_length": 28882
    },
    {
      "position": 64,
      "id": "/tmp/repos/astropy/astropy/cosmology/funcs/comparison.py_cosmology_equal.2_cosmology_equal.5.1",
      "distance": 1.1151572465896606,
      "file_path": "astropy/cosmology/funcs/comparison.py",
      "start_line": 304,
      "end_line": 321,
      "tokens": 201,
      "context_length": 29083
    },
    {
      "position": 65,
      "id": "/tmp/repos/astropy/astropy/units/quantity_helper/function_helpers.py_diff_gradient.7.1",
      "distance": 1.1188697814941406,
      "file_path": "astropy/units/quantity_helper/function_helpers.py",
      "start_line": 755,
      "end_line": 790,
      "tokens": 295,
      "context_length": 29378
    },
    {
      "position": 66,
      "id": "/tmp/repos/astropy/astropy/wcs/wcs.py_WCS._read_d2im_old_format_WCS._read_d2im_old_format.12.3.2.1",
      "distance": 1.1220821142196655,
      "file_path": "astropy/wcs/wcs.py",
      "start_line": 866,
      "end_line": 900,
      "tokens": 419,
      "context_length": 29797
    }
  ],
  "files": [
    {
      "file_path": "astropy/io/fits/diff.py",
      "position": 1,
      "tokens": 12859,
      "context_length": 12859
    },
    {
      "file_path": "astropy/io/fits/scripts/fitsdiff.py",
      "position": 2,
      "tokens": 2809,
      "context_length": 15668
    },
    {
      "file_path": "astropy/io/fits/convenience.py",
      "position": 3,
      "tokens": 9805,
      "context_length": 25473
    },
    {
      "file_path": "astropy/utils/diff.py",
      "position": 4,
      "tokens": 1234,
      "context_length": 26707
    },
    {
      "file_path": "astropy/io/fits/column.py",
      "position": 5,
      "tokens": 22340,
      "context_length": 49047
    },
    {
      "file_path": "astropy/coordinates/transformations.py",
      "position": 6,
      "tokens": 13497,
      "context_length": 62544
    },
    {
      "file_path": "astropy/io/fits/scripts/fitscheck.py",
      "position": 7,
      "tokens": 1606,
      "context_length": 64150
    },
    {
      "file_path": "astropy/io/misc/asdf/tags/fits/fits.py",
      "position": 8,
      "tokens": 763,
      "context_length": 64913
    },
    {
      "file_path": "astropy/io/fits/fitstime.py",
      "position": 9,
      "tokens": 5369,
      "context_length": 70282
    },
    {
      "file_path": "astropy/io/votable/exceptions.py",
      "position": 10,
      "tokens": 13324,
      "context_length": 83606
    },
    {
      "file_path": "examples/io/split-jpeg-to-fits.py",
      "position": 11,
      "tokens": 590,
      "context_length": 84196
    },
    {
      "file_path": "examples/io/modify-fits-header.py",
      "position": 12,
      "tokens": 559,
      "context_length": 84755
    },
    {
      "file_path": "examples/io/skip_create-large-fits.py",
      "position": 13,
      "tokens": 1064,
      "context_length": 85819
    },
    {
      "file_path": "astropy/io/fits/hdu/compressed.py",
      "position": 14,
      "tokens": 19053,
      "context_length": 104872
    },
    {
      "file_path": "astropy/io/fits/hdu/base.py",
      "position": 15,
      "tokens": 13294,
      "context_length": 118166
    },
    {
      "file_path": "astropy/units/format/fits.py",
      "position": 16,
      "tokens": 1264,
      "context_length": 119430
    },
    {
      "file_path": "astropy/visualization/scripts/fits2bitmap.py",
      "position": 17,
      "tokens": 1621,
      "context_length": 121051
    },
    {
      "file_path": "astropy/io/fits/hdu/table.py",
      "position": 18,
      "tokens": 13103,
      "context_length": 134154
    },
    {
      "file_path": "astropy/io/fits/scripts/fitsheader.py",
      "position": 19,
      "tokens": 3575,
      "context_length": 137729
    },
    {
      "file_path": "astropy/stats/spatial.py",
      "position": 20,
      "tokens": 3355,
      "context_length": 141084
    },
    {
      "file_path": "astropy/time/formats.py",
      "position": 21,
      "tokens": 19246,
      "context_length": 160330
    },
    {
      "file_path": "astropy/cosmology/funcs/comparison.py",
      "position": 22,
      "tokens": 3503,
      "context_length": 163833
    },
    {
      "file_path": "astropy/units/quantity_helper/function_helpers.py",
      "position": 23,
      "tokens": 9437,
      "context_length": 173270
    },
    {
      "file_path": "astropy/wcs/wcs.py",
      "position": 24,
      "tokens": 30859,
      "context_length": 204129
    }
  ]
}