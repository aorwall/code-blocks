{
  "instance_id": "django__django-15766",
  "model_patch": "diff --git a/django/db/transaction.py b/django/db/transaction.py\nindex b3c7b4bbaa..f8ee615204 100644\n--- a/django/db/transaction.py\n+++ b/django/db/transaction.py\n@@ -1,4 +1,5 @@\n from contextlib import ContextDecorator, contextmanager\n+import logging\n \n from django.db import (\n     DEFAULT_DB_ALIAS,\n@@ -8,6 +9,7 @@ from django.db import (\n     connections,\n )\n \n+logger = logging.getLogger('django.db.transaction')\n \n class TransactionManagementError(ProgrammingError):\n     \"\"\"Transaction management is used improperly.\"\"\"\n@@ -125,12 +127,23 @@ def mark_for_rollback_on_error(using=None):\n         raise\n \n \n-def on_commit(func, using=None):\n+def on_commit(func, using=None, robust=False):\n     \"\"\"\n     Register `func` to be called when the current transaction is committed.\n     If the current transaction is rolled back, `func` will not be called.\n+    If `robust` is True, exceptions in `func` will be suppressed.\n     \"\"\"\n-    get_connection(using).on_commit(func)\n+    connection = get_connection(using)\n+    if robust:\n+        def wrapped_func():\n+            try:\n+                func()\n+            except Exception as e:\n+                # Log the exception and suppress it\n+                logger.error(\"Suppressed exception in robust on_commit handler: %s\", e)\n+        connection.on_commit(wrapped_func)\n+    else:\n+        connection.on_commit(func)\n \n \n #################################\n@@ -221,6 +234,7 @@ class Atomic(ContextDecorator):\n             connection.atomic_blocks.append(self)\n \n     def __exit__(self, exc_type, exc_value, traceback):\n+        sid = None\n         connection = get_connection(self.using)\n \n         if connection.in_atomic_block:\ndiff --git a/django/local_settings.py b/django/local_settings.py\nnew file mode 100644\nindex 0000000000..4b3b4ab5ba\n--- /dev/null\n+++ b/django/local_settings.py\n@@ -0,0 +1,19 @@\n+\n+# local_settings.py\n+SECRET_KEY = 'fake-key-for-testing'\n+\n+INSTALLED_APPS = [\n+    'django.contrib.auth',\n+    'django.contrib.contenttypes',\n+    'django.contrib.sessions',\n+]\n+\n+DATABASES = {\n+    'default': {\n+        'ENGINE': 'django.db.backends.sqlite3',\n+        'NAME': 'mydatabase',\n+    }\n+}\n+\n+# Use console backend for email during testing\n+EMAIL_BACKEND = 'django.core.mail.backends.console.EmailBackend'\n",
  "model_name_or_path": "Devin",
  "pass_or_fail": "fail",
  "model_patch_files": [
    "django/db/transaction.py",
    "django/local_settings.py"
  ],
  "repo": "django/django",
  "base_commit": "be63c78760924e1335603c36babd0ad6cfaea3c4",
  "patch": "diff --git a/django/db/backends/base/base.py b/django/db/backends/base/base.py\n--- a/django/db/backends/base/base.py\n+++ b/django/db/backends/base/base.py\n@@ -1,6 +1,7 @@\n import _thread\n import copy\n import datetime\n+import logging\n import threading\n import time\n import warnings\n@@ -26,6 +27,8 @@\n NO_DB_ALIAS = \"__no_db__\"\n RAN_DB_VERSION_CHECK = set()\n \n+logger = logging.getLogger(\"django.db.backends.base\")\n+\n \n # RemovedInDjango50Warning\n def timezone_constructor(tzname):\n@@ -417,7 +420,9 @@ def savepoint_rollback(self, sid):\n \n         # Remove any callbacks registered while this savepoint was active.\n         self.run_on_commit = [\n-            (sids, func) for (sids, func) in self.run_on_commit if sid not in sids\n+            (sids, func, robust)\n+            for (sids, func, robust) in self.run_on_commit\n+            if sid not in sids\n         ]\n \n     @async_unsafe\n@@ -723,12 +728,12 @@ def schema_editor(self, *args, **kwargs):\n             )\n         return self.SchemaEditorClass(self, *args, **kwargs)\n \n-    def on_commit(self, func):\n+    def on_commit(self, func, robust=False):\n         if not callable(func):\n             raise TypeError(\"on_commit()'s callback must be a callable.\")\n         if self.in_atomic_block:\n             # Transaction in progress; save for execution on commit.\n-            self.run_on_commit.append((set(self.savepoint_ids), func))\n+            self.run_on_commit.append((set(self.savepoint_ids), func, robust))\n         elif not self.get_autocommit():\n             raise TransactionManagementError(\n                 \"on_commit() cannot be used in manual transaction management\"\n@@ -736,15 +741,36 @@ def on_commit(self, func):\n         else:\n             # No transaction in progress and in autocommit mode; execute\n             # immediately.\n-            func()\n+            if robust:\n+                try:\n+                    func()\n+                except Exception as e:\n+                    logger.error(\n+                        f\"Error calling {func.__qualname__} in on_commit() (%s).\",\n+                        e,\n+                        exc_info=True,\n+                    )\n+            else:\n+                func()\n \n     def run_and_clear_commit_hooks(self):\n         self.validate_no_atomic_block()\n         current_run_on_commit = self.run_on_commit\n         self.run_on_commit = []\n         while current_run_on_commit:\n-            sids, func = current_run_on_commit.pop(0)\n-            func()\n+            _, func, robust = current_run_on_commit.pop(0)\n+            if robust:\n+                try:\n+                    func()\n+                except Exception as e:\n+                    logger.error(\n+                        f\"Error calling {func.__qualname__} in on_commit() during \"\n+                        f\"transaction (%s).\",\n+                        e,\n+                        exc_info=True,\n+                    )\n+            else:\n+                func()\n \n     @contextmanager\n     def execute_wrapper(self, wrapper):\ndiff --git a/django/db/transaction.py b/django/db/transaction.py\n--- a/django/db/transaction.py\n+++ b/django/db/transaction.py\n@@ -125,12 +125,12 @@ def mark_for_rollback_on_error(using=None):\n         raise\n \n \n-def on_commit(func, using=None):\n+def on_commit(func, using=None, robust=False):\n     \"\"\"\n     Register `func` to be called when the current transaction is committed.\n     If the current transaction is rolled back, `func` will not be called.\n     \"\"\"\n-    get_connection(using).on_commit(func)\n+    get_connection(using).on_commit(func, robust)\n \n \n #################################\n",
  "test_patch": "diff --git a/django/test/testcases.py b/django/test/testcases.py\n--- a/django/test/testcases.py\n+++ b/django/test/testcases.py\n@@ -59,6 +59,8 @@\n from django.utils.version import PY310\n from django.views.static import serve\n \n+logger = logging.getLogger(\"django.test\")\n+\n __all__ = (\n     \"TestCase\",\n     \"TransactionTestCase\",\n@@ -1510,10 +1512,23 @@ def captureOnCommitCallbacks(cls, *, using=DEFAULT_DB_ALIAS, execute=False):\n         finally:\n             while True:\n                 callback_count = len(connections[using].run_on_commit)\n-                for _, callback in connections[using].run_on_commit[start_count:]:\n+                for _, callback, robust in connections[using].run_on_commit[\n+                    start_count:\n+                ]:\n                     callbacks.append(callback)\n                     if execute:\n-                        callback()\n+                        if robust:\n+                            try:\n+                                callback()\n+                            except Exception as e:\n+                                logger.error(\n+                                    f\"Error calling {callback.__qualname__} in \"\n+                                    f\"on_commit() (%s).\",\n+                                    e,\n+                                    exc_info=True,\n+                                )\n+                        else:\n+                            callback()\n \n                 if callback_count == len(connections[using].run_on_commit):\n                     break\ndiff --git a/tests/test_utils/tests.py b/tests/test_utils/tests.py\n--- a/tests/test_utils/tests.py\n+++ b/tests/test_utils/tests.py\n@@ -2285,6 +2285,32 @@ def branch_2():\n \n         self.assertEqual(callbacks, [branch_1, branch_2, leaf_3, leaf_1, leaf_2])\n \n+    def test_execute_robust(self):\n+        class MyException(Exception):\n+            pass\n+\n+        def hook():\n+            self.callback_called = True\n+            raise MyException(\"robust callback\")\n+\n+        with self.assertLogs(\"django.test\", \"ERROR\") as cm:\n+            with self.captureOnCommitCallbacks(execute=True) as callbacks:\n+                transaction.on_commit(hook, robust=True)\n+\n+        self.assertEqual(len(callbacks), 1)\n+        self.assertIs(self.callback_called, True)\n+\n+        log_record = cm.records[0]\n+        self.assertEqual(\n+            log_record.getMessage(),\n+            \"Error calling CaptureOnCommitCallbacksTests.test_execute_robust.<locals>.\"\n+            \"hook in on_commit() (robust callback).\",\n+        )\n+        self.assertIsNotNone(log_record.exc_info)\n+        raised_exception = log_record.exc_info[1]\n+        self.assertIsInstance(raised_exception, MyException)\n+        self.assertEqual(str(raised_exception), \"robust callback\")\n+\n \n class DisallowedDatabaseQueriesTests(SimpleTestCase):\n     def test_disallowed_database_connections(self):\ndiff --git a/tests/transaction_hooks/tests.py b/tests/transaction_hooks/tests.py\n--- a/tests/transaction_hooks/tests.py\n+++ b/tests/transaction_hooks/tests.py\n@@ -43,6 +43,47 @@ def test_executes_immediately_if_no_transaction(self):\n         self.do(1)\n         self.assertDone([1])\n \n+    def test_robust_if_no_transaction(self):\n+        def robust_callback():\n+            raise ForcedError(\"robust callback\")\n+\n+        with self.assertLogs(\"django.db.backends.base\", \"ERROR\") as cm:\n+            transaction.on_commit(robust_callback, robust=True)\n+            self.do(1)\n+\n+        self.assertDone([1])\n+        log_record = cm.records[0]\n+        self.assertEqual(\n+            log_record.getMessage(),\n+            \"Error calling TestConnectionOnCommit.test_robust_if_no_transaction.\"\n+            \"<locals>.robust_callback in on_commit() (robust callback).\",\n+        )\n+        self.assertIsNotNone(log_record.exc_info)\n+        raised_exception = log_record.exc_info[1]\n+        self.assertIsInstance(raised_exception, ForcedError)\n+        self.assertEqual(str(raised_exception), \"robust callback\")\n+\n+    def test_robust_transaction(self):\n+        def robust_callback():\n+            raise ForcedError(\"robust callback\")\n+\n+        with self.assertLogs(\"django.db.backends\", \"ERROR\") as cm:\n+            with transaction.atomic():\n+                transaction.on_commit(robust_callback, robust=True)\n+                self.do(1)\n+\n+        self.assertDone([1])\n+        log_record = cm.records[0]\n+        self.assertEqual(\n+            log_record.getMessage(),\n+            \"Error calling TestConnectionOnCommit.test_robust_transaction.<locals>.\"\n+            \"robust_callback in on_commit() during transaction (robust callback).\",\n+        )\n+        self.assertIsNotNone(log_record.exc_info)\n+        raised_exception = log_record.exc_info[1]\n+        self.assertIsInstance(raised_exception, ForcedError)\n+        self.assertEqual(str(raised_exception), \"robust callback\")\n+\n     def test_delays_execution_until_after_transaction_commit(self):\n         with transaction.atomic():\n             self.do(1)\n",
  "problem_statement": "Supporting robust on_commit handlers.\nDescription\n\t \n\t\t(last modified by Josh Smeaton)\n\t \nI recently tracked down an issue in my application where some on_commit handlers didn't execute because one of the previous handlers raised an exception. There appears to be no way to execute on_commit handlers *robustly* as you're able to do with signals [0] using send_robust.\nI could sprinkle try/catches around the place, but I'd like to avoid doing so because not all functions that are used as handlers should always swallow exceptions, but could do so when run as on_commit handlers.\nTargeting which handlers can be robust or not would be really useful, for example:\ndef update_search(user):\n\t# if updating search fails, it's fine, we'll bulk update later anyway\n\ttransaction.on_commit(lambda: search.update(user), robust=True)\ndef trigger_background_task_one(user):\n\t# if this task fails, we want to crash\n\ttransaction.on_commit(lambda: mytask.delay(user_id=user.id))\nHere if search fails to update it doesn't prevent the background task from being scheduled.\nI'm proposing to add a robust kwarg that defaults to False, for backward compatibility, but allows a user to tag specific handlers as such.\n[0] \u200bhttps://docs.djangoproject.com/en/4.0/topics/signals/#sending-signals\n",
  "hints_text": "Sounds reasonable. Please take into account that the current behavior is \u200bdocumented.\nJosh, Would you like to prepare a patch?\nI haven't got the time to put a patch together *right now* but I could do so in the near future. Consider tagging this as \"easy pickings\" for a budding contributor?\nI've started an easy pickings thread on -developers ML and would be happy to review and guide someone to make the change: \u200bhttps://groups.google.com/g/django-developers/c/Hyqd1Rz6cFs\nGood feature suggestion. The execution in captureOnCommitCallbacks would need extending too :)\n\u200bPR\nCan this ticket be closed? Seems like the PR was accepted.\nReplying to Shivan Sivakumaran: Can this ticket be closed? Seems like the PR was accepted. Not until the PR is merged, then it'll be closed as fixed",
  "created_at": "2022-06-07T16:12:45Z",
  "version": "4.2",
  "FAIL_TO_PASS": "[\"A visualisation of the callback tree tested. Each node is expected to\", \"test_execute (test_utils.tests.CaptureOnCommitCallbacksTests)\", \"test_execute_recursive (test_utils.tests.CaptureOnCommitCallbacksTests)\", \"test_execute_robust (test_utils.tests.CaptureOnCommitCallbacksTests)\", \"test_no_arguments (test_utils.tests.CaptureOnCommitCallbacksTests)\", \"test_pre_callback (test_utils.tests.CaptureOnCommitCallbacksTests)\", \"test_robust_if_no_transaction (transaction_hooks.tests.TestConnectionOnCommit)\", \"test_robust_transaction (transaction_hooks.tests.TestConnectionOnCommit)\", \"test_using (test_utils.tests.CaptureOnCommitCallbacksTests)\"]",
  "PASS_TO_PASS": "[\"An exception is setUp() is reraised after disable() is called.\", \"If outer transaction fails, no hooks from within it run.\", \"Overriding DATABASE_ROUTERS should update the base router.\", \"Overriding the FILE_UPLOAD_DIRECTORY_PERMISSIONS setting should be\", \"Overriding the FILE_UPLOAD_PERMISSIONS setting should be reflected in\", \"Overriding the MEDIA_ROOT setting should be reflected in the\", \"Overriding the MEDIA_URL setting should be reflected in the\", \"Overriding the STATICFILES_DIRS setting should be reflected in\", \"Overriding the STATICFILES_FINDERS setting should be reflected in\", \"Overriding the STATICFILES_STORAGE setting should be reflected in\", \"Overriding the STATIC_ROOT setting should be reflected in the\", \"Overriding the STATIC_URL setting should be reflected in the\", \"Testing the django.test.skipIfDBFeature decorator.\", \"Testing the django.test.skipUnlessDBFeature decorator.\", \"assertQuerysetEqual checks the number of appearance of each item\", \"assertRaisesMessage shouldn't interpret RE special chars.\", \"test_all (test_utils.tests.DatabaseAliasTests)\", \"test_allowed_database_chunked_cursor_queries (test_utils.tests.AllowedDatabaseQueriesTests)\", \"test_allowed_database_queries (test_utils.tests.AllowedDatabaseQueriesTests)\", \"test_allowed_hosts (test_utils.tests.SetupTestEnvironmentTests)\", \"test_assert_field_output (test_utils.tests.AssertFieldOutputTests)\", \"test_assert_form_error_errors_none (test_utils.tests.AssertFormErrorDeprecationTests)\", \"test_assert_form_error_errors_none_warning (test_utils.tests.AssertFormErrorDeprecationTests)\", \"test_assert_form_error_old_api (test_utils.tests.AssertFormErrorDeprecationTests)\", \"test_assert_form_error_old_api_assertion_error (test_utils.tests.AssertFormErrorDeprecationTests)\", \"test_assert_formset_error_errors_none (test_utils.tests.AssertFormErrorDeprecationTests)\", \"test_assert_formset_error_errors_none_warning (test_utils.tests.AssertFormErrorDeprecationTests)\", \"test_assert_formset_error_old_api (test_utils.tests.AssertFormErrorDeprecationTests)\", \"test_assert_formset_error_old_api_assertion_error (test_utils.tests.AssertFormErrorDeprecationTests)\", \"test_assert_num_queries (test_utils.tests.AssertNumQueriesTests)\", \"test_assert_num_queries_with_client (test_utils.tests.AssertNumQueriesTests)\", \"test_assert_raises_message (test_utils.tests.AssertRaisesMsgTest)\", \"test_assert_used_on_http_response (test_utils.tests.AssertTemplateUsedContextManagerTests)\", \"test_attributes (test_utils.tests.HTMLEqualTests)\", \"test_boolean_attribute (test_utils.tests.HTMLEqualTests)\", \"test_callable (test_utils.tests.AssertWarnsMessageTests)\", \"test_class_attribute (test_utils.tests.HTMLEqualTests)\", \"test_class_decoration (test_utils.tests.IsolatedAppsTests)\", \"test_cleanups_run_after_tearDown (test_utils.tests.TestContextDecoratorTests)\", \"test_close_match (test_utils.tests.DatabaseAliasTests)\", \"test_comment_root (test_utils.tests.XMLEqualTests)\", \"test_complex_examples (test_utils.tests.HTMLEqualTests)\", \"test_contains_html (test_utils.tests.HTMLEqualTests)\", \"test_context_manager (test_utils.tests.AssertWarnsMessageTests)\", \"test_context_manager (test_utils.tests.IsolatedAppsTests)\", \"test_context_manager_failure (test_utils.tests.AssertWarnsMessageTests)\", \"test_count (test_utils.tests.AssertTemplateUsedContextManagerTests)\", \"test_count (test_utils.tests.HTMLEqualTests)\", \"test_custom_required_message (test_utils.tests.AssertFieldOutputTests)\", \"test_db_query_in_hook (transaction_hooks.tests.TestConnectionOnCommit)\", \"test_default_level (test_utils.tests.AssertNoLogsTest)\", \"test_delays_execution_until_after_transaction_commit (transaction_hooks.tests.TestConnectionOnCommit)\", \"test_different_non_field_errors (test_utils.tests.AssertFormErrorTests)\", \"test_different_non_field_errors (test_utils.tests.AssertFormsetErrorTests)\", \"test_different_non_form_errors (test_utils.tests.AssertFormsetErrorTests)\", \"test_different_using (test_utils.tests.CaptureOnCommitCallbacksTests)\", \"test_disallowed_database_chunked_cursor_queries (test_utils.tests.DisallowedDatabaseQueriesTests)\", \"test_disallowed_database_connections (test_utils.tests.DisallowedDatabaseQueriesTests)\", \"test_disallowed_database_queries (test_utils.tests.DisallowedDatabaseQueriesTests)\", \"test_discards_hooks_from_rolled_back_savepoint (transaction_hooks.tests.TestConnectionOnCommit)\", \"test_doctype_root (test_utils.tests.XMLEqualTests)\", \"test_does_not_execute_if_transaction_rolled_back (transaction_hooks.tests.TestConnectionOnCommit)\", \"test_does_not_hide_other_failures (test_utils.tests.AssertNoLogsTest)\", \"test_empty (test_utils.tests.AssertQuerysetEqualTests)\", \"test_empty_errors_invalid_form (test_utils.tests.AssertFormErrorTests)\", \"test_empty_errors_invalid_formset (test_utils.tests.AssertFormsetErrorTests)\", \"test_empty_errors_valid_form (test_utils.tests.AssertFormErrorTests)\", \"test_empty_errors_valid_form_non_field_errors (test_utils.tests.AssertFormErrorTests)\", \"test_empty_errors_valid_formset (test_utils.tests.AssertFormsetErrorTests)\", \"test_equal (test_utils.tests.AssertURLEqualTests)\", \"test_equal_parsing_errors (test_utils.tests.JSONEqualTests)\", \"test_error_in_hook_doesnt_prevent_clearing_hooks (transaction_hooks.tests.TestConnectionOnCommit)\", \"test_error_list (test_utils.tests.AssertFormErrorTests)\", \"test_error_list (test_utils.tests.AssertFormsetErrorTests)\", \"test_error_message (test_utils.tests.AssertTemplateUsedContextManagerTests)\", \"test_escaped_html_errors (test_utils.tests.HTMLEqualTests)\", \"test_executes_immediately_if_no_transaction (transaction_hooks.tests.TestConnectionOnCommit)\", \"test_executes_only_after_final_transaction_committed (transaction_hooks.tests.TestConnectionOnCommit)\", \"test_fails_when_log_emitted (test_utils.tests.AssertNoLogsTest)\", \"test_failure (test_utils.tests.AssertNumQueriesContextManagerTests)\", \"test_failure (test_utils.tests.AssertTemplateUsedContextManagerTests)\", \"test_failure (test_utils.tests.CaptureQueriesContextManagerTests)\", \"test_failure_in_setUpTestData_should_rollback_transaction (test_utils.tests.TestBadSetUpTestData)\", \"test_field_not_in_form (test_utils.tests.AssertFormErrorTests)\", \"test_field_not_in_form (test_utils.tests.AssertFormsetErrorTests)\", \"test_field_with_different_error (test_utils.tests.AssertFormErrorTests)\", \"test_field_with_different_error (test_utils.tests.AssertFormsetErrorTests)\", \"test_field_with_no_errors (test_utils.tests.AssertFormErrorTests)\", \"test_field_with_no_errors (test_utils.tests.AssertFormsetErrorTests)\", \"test_flat_values_list (test_utils.tests.AssertQuerysetEqualTests)\", \"test_form_index_too_big (test_utils.tests.AssertFormsetErrorTests)\", \"test_form_index_too_big_plural (test_utils.tests.AssertFormsetErrorTests)\", \"test_form_not_in_context (test_utils.tests.AssertFormErrorTests)\", \"test_formset_not_in_context (test_utils.tests.AssertFormsetErrorTests)\", \"test_hook_in_hook (transaction_hooks.tests.TestConnectionOnCommit)\", \"test_hooks_cleared_after_rollback (transaction_hooks.tests.TestConnectionOnCommit)\", \"test_hooks_cleared_after_successful_commit (transaction_hooks.tests.TestConnectionOnCommit)\", \"test_html_contain (test_utils.tests.HTMLEqualTests)\", \"test_html_parser (test_utils.tests.HTMLEqualTests)\", \"test_ignore_comments (test_utils.tests.HTMLEqualTests)\", \"test_ignores_connection_configuration_queries (test_utils.tests.AssertNumQueriesUponConnectionTests)\", \"test_inner_savepoint_does_not_affect_outer (transaction_hooks.tests.TestConnectionOnCommit)\", \"test_inner_savepoint_rolled_back_with_outer (transaction_hooks.tests.TestConnectionOnCommit)\", \"test_installed_apps (test_utils.tests.IsolatedAppsTests)\", \"test_int_level (test_utils.tests.AssertNoLogsTest)\", \"test_match (test_utils.tests.DatabaseAliasTests)\", \"test_maxdiff (test_utils.tests.AssertQuerysetEqualTests)\", \"test_message (test_utils.tests.AssertURLEqualTests)\", \"test_method_decoration (test_utils.tests.IsolatedAppsTests)\", \"test_missing_default_databases (test_utils.tests.SkippingClassTestCase)\", \"test_msg_prefix (test_utils.tests.AssertTemplateUsedContextManagerTests)\", \"test_msg_prefix (test_utils.tests.AssertURLEqualTests)\", \"test_multiple_forms (test_utils.tests.AssertFormsetErrorTests)\", \"test_nested (test_utils.tests.CaptureQueriesContextManagerTests)\", \"test_nested (test_utils.tests.IsolatedAppsTests)\", \"test_nested_usage (test_utils.tests.AssertTemplateUsedContextManagerTests)\", \"test_no_close_match (test_utils.tests.DatabaseAliasTests)\", \"test_no_non_field_errors (test_utils.tests.AssertFormsetErrorTests)\", \"test_no_non_form_errors (test_utils.tests.AssertFormsetErrorTests)\", \"test_no_savepoints_atomic_merged_with_outer (transaction_hooks.tests.TestConnectionOnCommit)\", \"test_non_boolean_attibutes (test_utils.tests.HTMLEqualTests)\", \"test_non_client_response (test_utils.tests.AssertFormErrorTests)\", \"test_non_client_response (test_utils.tests.AssertFormsetErrorTests)\", \"test_non_field_errors (test_utils.tests.AssertFormErrorTests)\", \"test_non_field_errors (test_utils.tests.AssertFormsetErrorTests)\", \"test_non_form_errors (test_utils.tests.AssertFormsetErrorTests)\", \"test_non_form_errors_with_field (test_utils.tests.AssertFormsetErrorTests)\", \"test_normalize_refs (test_utils.tests.HTMLEqualTests)\", \"test_not_equal (test_utils.tests.AssertURLEqualTests)\", \"test_not_equal_parsing_errors (test_utils.tests.JSONEqualTests)\", \"test_not_used (test_utils.tests.AssertTemplateUsedContextManagerTests)\", \"test_ordered (test_utils.tests.AssertQuerysetEqualTests)\", \"test_parse_html_in_script (test_utils.tests.HTMLEqualTests)\", \"test_parsing_errors (test_utils.tests.HTMLEqualTests)\", \"test_parsing_errors (test_utils.tests.XMLEqualTests)\", \"test_processing_instruction (test_utils.tests.XMLEqualTests)\", \"test_queryset (test_utils.tests.AssertQuerysetEqualTests)\", \"test_raises_exception_non_autocommit_mode (transaction_hooks.tests.TestConnectionOnCommit)\", \"test_raises_exception_non_callable (transaction_hooks.tests.TestConnectionOnCommit)\", \"test_repr_transform (test_utils.tests.AssertQuerysetEqualTests)\", \"test_response_with_no_context (test_utils.tests.AssertFormErrorTests)\", \"test_response_with_no_context (test_utils.tests.AssertFormsetErrorTests)\", \"test_root_element_escaped_html (test_utils.tests.HTMLEqualTests)\", \"test_runs_hooks_in_order_registered (transaction_hooks.tests.TestConnectionOnCommit)\", \"test_self_closing_tags (test_utils.tests.HTMLEqualTests)\", \"test_setup_test_environment_calling_more_than_once (test_utils.tests.SetupTestEnvironmentTests)\", \"test_simple (test_utils.tests.AssertNumQueriesContextManagerTests)\", \"test_simple (test_utils.tests.CaptureQueriesContextManagerTests)\", \"test_simple_equal (test_utils.tests.JSONEqualTests)\", \"test_simple_equal (test_utils.tests.XMLEqualTests)\", \"test_simple_equal_html (test_utils.tests.HTMLEqualTests)\", \"test_simple_equal_raise (test_utils.tests.JSONEqualTests)\", \"test_simple_equal_raise (test_utils.tests.XMLEqualTests)\", \"test_simple_equal_raises_message (test_utils.tests.XMLEqualTests)\", \"test_simple_equal_unordered (test_utils.tests.JSONEqualTests)\", \"test_simple_equal_unordered (test_utils.tests.XMLEqualTests)\", \"test_simple_equal_with_leading_or_trailing_whitespace (test_utils.tests.XMLEqualTests)\", \"test_simple_not_equal (test_utils.tests.JSONEqualTests)\", \"test_simple_not_equal (test_utils.tests.XMLEqualTests)\", \"test_simple_not_equal_raise (test_utils.tests.JSONEqualTests)\", \"test_simple_not_equal_raise (test_utils.tests.XMLEqualTests)\", \"test_simple_not_equal_with_whitespace_in_the_middle (test_utils.tests.XMLEqualTests)\", \"test_single_error (test_utils.tests.AssertFormErrorTests)\", \"test_single_error (test_utils.tests.AssertFormsetErrorTests)\", \"test_skip_class_unless_db_feature (test_utils.tests.SkippingClassTestCase)\", \"test_special_re_chars (test_utils.tests.AssertWarnsMessageTests)\", \"test_text_level (test_utils.tests.AssertNoLogsTest)\", \"test_transaction_in_hook (transaction_hooks.tests.TestConnectionOnCommit)\", \"test_transform (test_utils.tests.AssertQuerysetEqualTests)\", \"test_unbound_form (test_utils.tests.AssertFormErrorTests)\", \"test_unbound_formset (test_utils.tests.AssertFormsetErrorTests)\", \"test_undefined_order (test_utils.tests.AssertQuerysetEqualTests)\", \"test_unequal_html (test_utils.tests.HTMLEqualTests)\", \"test_unicode_handling (test_utils.tests.HTMLEqualTests)\", \"test_unordered (test_utils.tests.AssertQuerysetEqualTests)\", \"test_urlconf_cache (test_utils.tests.OverrideSettingsTests)\", \"test_urlconf_first (test_utils.tests.OverrideSettingsTests)\", \"test_urlconf_second (test_utils.tests.OverrideSettingsTests)\", \"test_usage (test_utils.tests.AssertTemplateUsedContextManagerTests)\", \"test_with_client (test_utils.tests.AssertNumQueriesContextManagerTests)\", \"test_with_client (test_utils.tests.CaptureQueriesContextManagerTests)\", \"test_with_rolled_back_savepoint (test_utils.tests.CaptureOnCommitCallbacksTests)\", \"test_within (test_utils.tests.CaptureQueriesContextManagerTests)\"]",
  "environment_setup_commit": "0fbdb9784da915fce5dcc1fe82bac9b4785749e5",
  "patch_files": [
    "django/db/backends/base/base.py",
    "django/db/transaction.py"
  ],
  "test_patch_files": [
    "django/test/testcases.py",
    "tests/test_utils/tests.py",
    "tests/transaction_hooks/tests.py"
  ],
  "patch_diff_details": {
    "django/db/backends/base/base.py": {
      "diffs": [
        {
          "start_line_old": 4,
          "end_line_old": 4,
          "file_pos": 4,
          "file_context_length": 12913,
          "closest_snippet_id": "/tmp/repos/django/django/db/backends/base/base.py_BaseDatabaseWrapper.set_autocommit_BaseDatabaseWrapper.set_autocommit.8.self.run_commit_hooks_on_set_autocommit_on.1",
          "closest_snippet_line_distance": 454,
          "pos": 34,
          "context_length": 14219
        },
        {
          "start_line_old": 29,
          "end_line_old": 29,
          "file_pos": 4,
          "file_context_length": 12913,
          "closest_snippet_id": "/tmp/repos/django/django/db/backends/base/base.py_BaseDatabaseWrapper.set_autocommit_BaseDatabaseWrapper.set_autocommit.8.self.run_commit_hooks_on_set_autocommit_on.1",
          "closest_snippet_line_distance": 429,
          "pos": 34,
          "context_length": 14219
        },
        {
          "start_line_old": 420,
          "end_line_old": 420,
          "file_pos": 4,
          "file_context_length": 12913,
          "closest_snippet_id": "/tmp/repos/django/django/db/backends/base/base.py_BaseDatabaseWrapper.77_BaseDatabaseWrapper.validate_thread_sharing.2.1",
          "closest_snippet_line_distance": 197
        },
        {
          "start_line_old": 726,
          "end_line_old": 731,
          "file_pos": 4,
          "file_context_length": 12913,
          "closest_snippet_id": "/tmp/repos/django/django/db/backends/base/base.py_BaseDatabaseWrapper.77_BaseDatabaseWrapper.validate_thread_sharing.2.1",
          "closest_snippet_line_distance": 82
        },
        {
          "start_line_old": 739,
          "end_line_old": 747,
          "file_pos": 4,
          "file_context_length": 12913,
          "closest_snippet_id": "/tmp/repos/django/django/db/backends/base/base.py_BaseDatabaseWrapper.77_BaseDatabaseWrapper.validate_thread_sharing.2.1",
          "closest_snippet_line_distance": 98
        }
      ]
    },
    "django/db/transaction.py": {
      "diffs": [
        {
          "start_line_old": 128,
          "end_line_old": 133,
          "file_pos": 3,
          "file_context_length": 7484,
          "pos": 3,
          "context_length": 766
        }
      ]
    }
  },
  "vectors": 3728,
  "snippets": [
    {
      "position": 1,
      "id": "/tmp/repos/django/django/dispatch/dispatcher.py_Signal.send_robust_Signal._clear_dead_receivers.2.self.receivers.1",
      "distance": 1.0955495834350586,
      "file_path": "django/dispatch/dispatcher.py",
      "start_line": 181,
      "end_line": 232,
      "tokens": 368,
      "context_length": 368
    },
    {
      "position": 2,
      "id": "/tmp/repos/django/django/db/backends/base/features.py_BaseDatabaseFeatures.minimum_database_version.supports_transactions_",
      "distance": 1.1221284866333008,
      "file_path": "django/db/backends/base/features.py",
      "start_line": 359,
      "end_line": 377,
      "tokens": 173,
      "context_length": 541
    },
    {
      "position": 3,
      "id": "/tmp/repos/django/django/db/transaction.py_mark_for_rollback_on_error_on_commit.2",
      "distance": 1.1382898092269897,
      "file_path": "django/db/transaction.py",
      "start_line": 100,
      "end_line": 133,
      "tokens": 225,
      "context_length": 766,
      "file_pos": 3
    },
    {
      "position": 4,
      "id": "/tmp/repos/django/django/db/backends/base/features.py_BaseDatabaseFeatures.1_BaseDatabaseFeatures.minimum_database_version.147",
      "distance": 1.139421820640564,
      "file_path": "django/db/backends/base/features.py",
      "start_line": 6,
      "end_line": 221,
      "tokens": 1745,
      "context_length": 2511
    },
    {
      "position": 5,
      "id": "/tmp/repos/django/django/db/backends/base/base.py_BaseDatabaseWrapper.get_rollback_BaseDatabaseWrapper.close_if_health_check_failed.self.health_check_done.1",
      "distance": 1.1714341640472412,
      "file_path": "django/db/backends/base/base.py",
      "start_line": 493,
      "end_line": 588,
      "tokens": 604,
      "context_length": 3115,
      "file_pos": 4
    },
    {
      "position": 6,
      "id": "/tmp/repos/django/django/db/transaction.py_atomic_",
      "distance": 1.2055671215057373,
      "file_path": "django/db/transaction.py",
      "start_line": 315,
      "end_line": 340,
      "tokens": 181,
      "context_length": 3296,
      "file_pos": 4
    },
    {
      "position": 7,
      "id": "/tmp/repos/django/django/contrib/postgres/signals.py_register_type_handlers_",
      "distance": 1.2077903747558594,
      "file_path": "django/contrib/postgres/signals.py",
      "start_line": 37,
      "end_line": 69,
      "tokens": 264,
      "context_length": 3560
    },
    {
      "position": 8,
      "id": "/tmp/repos/django/django/db/transaction.py_17_Atomic.__init__.self._from_testcase.1",
      "distance": 1.2113312482833862,
      "file_path": "django/db/transaction.py",
      "start_line": 136,
      "end_line": 179,
      "tokens": 367,
      "context_length": 3927,
      "file_pos": 5
    },
    {
      "position": 9,
      "id": "/tmp/repos/django/django/db/backends/base/base.py_BaseDatabaseWrapper.set_autocommit_BaseDatabaseWrapper.set_autocommit.8.self.run_commit_hooks_on_set_autocommit_on.1",
      "distance": 1.215179681777954,
      "file_path": "django/db/backends/base/base.py",
      "start_line": 458,
      "end_line": 491,
      "tokens": 276,
      "context_length": 4203,
      "file_pos": 5
    },
    {
      "position": 10,
      "id": "/tmp/repos/django/django/db/backends/base/features.py_BaseDatabaseFeatures.minimum_database_version.148_BaseDatabaseFeatures.minimum_database_version.supports_explaining_query_execution.2.1",
      "distance": 1.2208467721939087,
      "file_path": "django/db/backends/base/features.py",
      "start_line": 222,
      "end_line": 357,
      "tokens": 1171,
      "context_length": 5374
    },
    {
      "position": 11,
      "id": "/tmp/repos/django/django/db/models/base.py_Model.save.alters_data_Model.save_base.18.1",
      "distance": 1.2318661212921143,
      "file_path": "django/db/models/base.py",
      "start_line": 838,
      "end_line": 904,
      "tokens": 475,
      "context_length": 5849
    },
    {
      "position": 12,
      "id": "/tmp/repos/django/django/db/transaction.py_Atomic.__exit___Atomic.__exit__.4.2.2.3.1.2.connection.in_atomic_block.1",
      "distance": 1.2453267574310303,
      "file_path": "django/db/transaction.py",
      "start_line": 223,
      "end_line": 312,
      "tokens": 635,
      "context_length": 6484,
      "file_pos": 6
    },
    {
      "position": 13,
      "id": "/tmp/repos/django/django/db/models/deletion.py_1_get_candidate_relations_to_delete.3.1",
      "distance": 1.2520164251327515,
      "file_path": "django/db/models/deletion.py",
      "start_line": 1,
      "end_line": 93,
      "tokens": 601,
      "context_length": 7085
    },
    {
      "position": 14,
      "id": "/tmp/repos/django/django/db/backends/sqlite3/features.py_operator_DatabaseFeatures.create_test_table_with_composite_primary_key.1",
      "distance": 1.2520332336425781,
      "file_path": "django/db/backends/sqlite3/features.py",
      "start_line": 1,
      "end_line": 64,
      "tokens": 632,
      "context_length": 7717
    },
    {
      "position": 15,
      "id": "/tmp/repos/django/django/db/__init__.py_1_",
      "distance": 1.2550086975097656,
      "file_path": "django/db/__init__.py",
      "start_line": 1,
      "end_line": 62,
      "tokens": 299,
      "context_length": 8016
    },
    {
      "position": 16,
      "id": "/tmp/repos/django/django/db/backends/oracle/features.py_1_DatabaseFeatures.test_now_utc_template.1",
      "distance": 1.2566642761230469,
      "file_path": "django/db/backends/oracle/features.py",
      "start_line": 1,
      "end_line": 83,
      "tokens": 709,
      "context_length": 8725
    },
    {
      "position": 17,
      "id": "/tmp/repos/django/django/db/transaction.py_Atomic.__enter___Atomic.__enter__.5.1",
      "distance": 1.2625293731689453,
      "file_path": "django/db/transaction.py",
      "start_line": 181,
      "end_line": 221,
      "tokens": 333,
      "context_length": 9058,
      "file_pos": 10
    },
    {
      "position": 18,
      "id": "/tmp/repos/django/django/db/backends/signals.py__",
      "distance": 1.2625586986541748,
      "file_path": "django/db/backends/signals.py",
      "start_line": 1,
      "end_line": 4,
      "tokens": 0,
      "context_length": 9058
    },
    {
      "position": 19,
      "id": "/tmp/repos/django/django/db/transaction.py_1_get_rollback.2.1",
      "distance": 1.267014980316162,
      "file_path": "django/db/transaction.py",
      "start_line": 1,
      "end_line": 82,
      "tokens": 442,
      "context_length": 9500,
      "file_pos": 11
    },
    {
      "position": 20,
      "id": "/tmp/repos/django/django/utils/autoreload.py_WatchmanReloader.request_processed_WatchmanReloader.tick.3.5",
      "distance": 1.2674840688705444,
      "file_path": "django/utils/autoreload.py",
      "start_line": 585,
      "end_line": 608,
      "tokens": 177,
      "context_length": 9677
    },
    {
      "position": 21,
      "id": "/tmp/repos/django/django/db/utils.py_ConnectionHandler_ConnectionHandler.create_connection.3.1",
      "distance": 1.2688796520233154,
      "file_path": "django/db/utils.py",
      "start_line": 138,
      "end_line": 194,
      "tokens": 517,
      "context_length": 10194
    },
    {
      "position": 22,
      "id": "/tmp/repos/django/django/core/management/sql.py_emit_post_migrate_signal_",
      "distance": 1.2690529823303223,
      "file_path": "django/core/management/sql.py",
      "start_line": 42,
      "end_line": 60,
      "tokens": 132,
      "context_length": 10326
    },
    {
      "position": 23,
      "id": "/tmp/repos/django/django/core/checks/model_checks.py__check_lazy_references.signal_connect_error__check_lazy_references.signal_connect_error.8.1",
      "distance": 1.2710044384002686,
      "file_path": "django/core/checks/model_checks.py",
      "start_line": 161,
      "end_line": 185,
      "tokens": 267,
      "context_length": 10593
    },
    {
      "position": 24,
      "id": "/tmp/repos/django/django/db/models/options.py_bisect_DEFAULT_NAMES.1",
      "distance": 1.2792627811431885,
      "file_path": "django/db/models/options.py",
      "start_line": 1,
      "end_line": 57,
      "tokens": 347,
      "context_length": 10940
    },
    {
      "position": 25,
      "id": "/tmp/repos/django/django/core/signals.py__",
      "distance": 1.280271053314209,
      "file_path": "django/core/signals.py",
      "start_line": 1,
      "end_line": 7,
      "tokens": 0,
      "context_length": 10940
    },
    {
      "position": 26,
      "id": "/tmp/repos/django/django/db/models/deletion.py_Collector.add_dependency_Collector._has_signal_listeners.1.1",
      "distance": 1.2810472249984741,
      "file_path": "django/db/models/deletion.py",
      "start_line": 142,
      "end_line": 185,
      "tokens": 327,
      "context_length": 11267
    },
    {
      "position": 27,
      "id": "/tmp/repos/django/django/db/backends/sqlite3/features.py_DatabaseFeatures.supports_atomic_references_rename_",
      "distance": 1.282581090927124,
      "file_path": "django/db/backends/sqlite3/features.py",
      "start_line": 115,
      "end_line": 149,
      "tokens": 245,
      "context_length": 11512
    },
    {
      "position": 28,
      "id": "/tmp/repos/django/django/utils/autoreload.py_ensure_echo_on_ensure_echo_on.4.4.1",
      "distance": 1.282750129699707,
      "file_path": "django/utils/autoreload.py",
      "start_line": 90,
      "end_line": 106,
      "tokens": 161,
      "context_length": 11673
    },
    {
      "position": 29,
      "id": "/tmp/repos/django/django/db/backends/postgresql/features.py_operator_",
      "distance": 1.2848467826843262,
      "file_path": "django/db/backends/postgresql/features.py",
      "start_line": 1,
      "end_line": 103,
      "tokens": 792,
      "context_length": 12465
    },
    {
      "position": 30,
      "id": "/tmp/repos/django/django/dispatch/dispatcher.py_Signal._live_receivers_Signal._remove_receiver.self._dead_receivers.1",
      "distance": 1.2855937480926514,
      "file_path": "django/dispatch/dispatcher.py",
      "start_line": 234,
      "end_line": 280,
      "tokens": 444,
      "context_length": 12909
    },
    {
      "position": 31,
      "id": "/tmp/repos/django/django/utils/autoreload.py_itertools_is_django_path.2.1",
      "distance": 1.2873859405517578,
      "file_path": "django/utils/autoreload.py",
      "start_line": 1,
      "end_line": 56,
      "tokens": 293,
      "context_length": 13202
    },
    {
      "position": 32,
      "id": "/tmp/repos/django/django/db/backends/sqlite3/_functions.py_register_register.sql.1",
      "distance": 1.2884190082550049,
      "file_path": "django/db/backends/sqlite3/_functions.py",
      "start_line": 40,
      "end_line": 84,
      "tokens": 671,
      "context_length": 13873
    },
    {
      "position": 33,
      "id": "/tmp/repos/django/django/db/transaction.py_set_rollback_set_rollback.2.1",
      "distance": 1.289829969406128,
      "file_path": "django/db/transaction.py",
      "start_line": 85,
      "end_line": 97,
      "tokens": 135,
      "context_length": 14008,
      "file_pos": 19
    },
    {
      "position": 34,
      "id": "/tmp/repos/django/django/db/backends/base/base.py__thread_timezone_constructor.2.1",
      "distance": 1.2907474040985107,
      "file_path": "django/db/backends/base/base.py",
      "start_line": 1,
      "end_line": 36,
      "tokens": 211,
      "context_length": 14219,
      "file_pos": 19
    },
    {
      "position": 35,
      "id": "/tmp/repos/django/django/dispatch/dispatcher.py_logging_Signal.__init__.self._dead_receivers.1",
      "distance": 1.292037010192871,
      "file_path": "django/dispatch/dispatcher.py",
      "start_line": 1,
      "end_line": 45,
      "tokens": 268,
      "context_length": 14487
    },
    {
      "position": 36,
      "id": "/tmp/repos/django/django/contrib/auth/backends.py_RemoteUserBackend.authenticate_",
      "distance": 1.2929561138153076,
      "file_path": "django/contrib/auth/backends.py",
      "start_line": 187,
      "end_line": 250,
      "tokens": 486,
      "context_length": 14973
    },
    {
      "position": 37,
      "id": "/tmp/repos/django/django/db/models/fields/related_descriptors.py_create_forward_many_to_many_manager.ManyRelatedManager._get_add_plan_create_forward_many_to_many_manager.ManyRelatedManager._get_add_plan.15.1",
      "distance": 1.2929930686950684,
      "file_path": "django/db/models/fields/related_descriptors.py",
      "start_line": 1293,
      "end_line": 1324,
      "tokens": 344,
      "context_length": 15317
    },
    {
      "position": 38,
      "id": "/tmp/repos/django/django/db/models/options.py_Options.contribute_to_class_Options.contribute_to_class.16.self.db_table_2.1",
      "distance": 1.2935385704040527,
      "file_path": "django/db/models/options.py",
      "start_line": 172,
      "end_line": 241,
      "tokens": 645,
      "context_length": 15962
    },
    {
      "position": 39,
      "id": "/tmp/repos/django/django/core/handlers/asgi.py_logging_logger.1",
      "distance": 1.294187068939209,
      "file_path": "django/core/handlers/asgi.py",
      "start_line": 1,
      "end_line": 24,
      "tokens": 116,
      "context_length": 16078
    },
    {
      "position": 40,
      "id": "/tmp/repos/django/django/db/backends/mysql/base.py_DatabaseWrapper.create_cursor_DatabaseWrapper.enable_constraint_checking.5.2.self.needs_rollback.1",
      "distance": 1.2950550317764282,
      "file_path": "django/db/backends/mysql/base.py",
      "start_line": 276,
      "end_line": 312,
      "tokens": 259,
      "context_length": 16337
    },
    {
      "position": 41,
      "id": "/tmp/repos/django/django/db/models/base.py_copy_DEFERRED.1",
      "distance": 1.295276165008545,
      "file_path": "django/db/models/base.py",
      "start_line": 1,
      "end_line": 64,
      "tokens": 346,
      "context_length": 16683
    },
    {
      "position": 42,
      "id": "/tmp/repos/django/django/db/models/__init__.py_1_",
      "distance": 1.2990052700042725,
      "file_path": "django/db/models/__init__.py",
      "start_line": 1,
      "end_line": 116,
      "tokens": 682,
      "context_length": 17365
    },
    {
      "position": 43,
      "id": "/tmp/repos/django/django/db/backends/mysql/features.py_DatabaseFeatures.supported_explain_formats_",
      "distance": 1.3004974126815796,
      "file_path": "django/db/backends/mysql/features.py",
      "start_line": 271,
      "end_line": 330,
      "tokens": 439,
      "context_length": 17804
    },
    {
      "position": 44,
      "id": "/tmp/repos/django/django/core/handlers/base.py_BaseHandler.13_",
      "distance": 1.301055669784546,
      "file_path": "django/core/handlers/base.py",
      "start_line": 343,
      "end_line": 374,
      "tokens": 214,
      "context_length": 18018
    },
    {
      "position": 45,
      "id": "/tmp/repos/django/django/core/handlers/exception.py_get_exception_response_",
      "distance": 1.304659366607666,
      "file_path": "django/core/handlers/exception.py",
      "start_line": 161,
      "end_line": 186,
      "tokens": 167,
      "context_length": 18185
    },
    {
      "position": 46,
      "id": "/tmp/repos/django/django/contrib/admin/options.py_ModelAdmin.response_action_ModelAdmin.response_action.15.15.3.1",
      "distance": 1.3066325187683105,
      "file_path": "django/contrib/admin/options.py",
      "start_line": 1537,
      "end_line": 1604,
      "tokens": 586,
      "context_length": 18771
    },
    {
      "position": 47,
      "id": "/tmp/repos/django/django/core/management/commands/squashmigrations.py_Command.handle_Command.handle.29.first_migration.1",
      "distance": 1.306673526763916,
      "file_path": "django/core/management/commands/squashmigrations.py",
      "start_line": 62,
      "end_line": 160,
      "tokens": 809,
      "context_length": 19580
    },
    {
      "position": 48,
      "id": "/tmp/repos/django/django/utils/asyncio.py_os_",
      "distance": 1.307572841644287,
      "file_path": "django/utils/asyncio.py",
      "start_line": 1,
      "end_line": 40,
      "tokens": 221,
      "context_length": 19801
    },
    {
      "position": 49,
      "id": "/tmp/repos/django/django/views/debug.py_SafeExceptionReporterFilter.get_traceback_frame_variables_SafeExceptionReporterFilter.get_traceback_frame_variables.10.1",
      "distance": 1.3078689575195312,
      "file_path": "django/views/debug.py",
      "start_line": 225,
      "end_line": 277,
      "tokens": 471,
      "context_length": 20272
    },
    {
      "position": 50,
      "id": "/tmp/repos/django/django/db/backends/sqlite3/base.py_DatabaseWrapper.check_constraints_DatabaseWrapper.is_in_memory_db.1.1",
      "distance": 1.3091778755187988,
      "file_path": "django/db/backends/sqlite3/base.py",
      "start_line": 233,
      "end_line": 352,
      "tokens": 888,
      "context_length": 21160
    },
    {
      "position": 51,
      "id": "/tmp/repos/django/django/contrib/auth/backends.py_warnings_BaseBackend.has_perm.1.1",
      "distance": 1.3098427057266235,
      "file_path": "django/contrib/auth/backends.py",
      "start_line": 1,
      "end_line": 32,
      "tokens": 197,
      "context_length": 21357
    },
    {
      "position": 52,
      "id": "/tmp/repos/django/django/db/backends/sqlite3/features.py_DatabaseFeatures.django_test_skips_DatabaseFeatures.django_test_skips.4.1",
      "distance": 1.3105920553207397,
      "file_path": "django/db/backends/sqlite3/features.py",
      "start_line": 66,
      "end_line": 113,
      "tokens": 383,
      "context_length": 21740
    },
    {
      "position": 53,
      "id": "/tmp/repos/django/django/db/backends/mysql/features.py_DatabaseFeatures._mysql_storage_engine_DatabaseFeatures.supports_explain_analyze.1.1",
      "distance": 1.3111087083816528,
      "file_path": "django/db/backends/mysql/features.py",
      "start_line": 162,
      "end_line": 269,
      "tokens": 728,
      "context_length": 22468
    },
    {
      "position": 54,
      "id": "/tmp/repos/django/django/core/checks/__init__.py_Warning_",
      "distance": 1.3112311363220215,
      "file_path": "django/core/checks/__init__.py",
      "start_line": 1,
      "end_line": 48,
      "tokens": 327,
      "context_length": 22795
    },
    {
      "position": 55,
      "id": "/tmp/repos/django/django/db/models/query.py_QuerySet._merge_known_related_objects_QuerySet._check_ordering_first_last_queryset_aggregation.1.1",
      "distance": 1.3112552165985107,
      "file_path": "django/db/models/query.py",
      "start_line": 1906,
      "end_line": 1971,
      "tokens": 539,
      "context_length": 23334
    },
    {
      "position": 56,
      "id": "/tmp/repos/django/django/db/models/query.py_QuerySet._check_bulk_create_options_QuerySet._check_bulk_create_options.4.1",
      "distance": 1.312289834022522,
      "file_path": "django/db/models/query.py",
      "start_line": 684,
      "end_line": 743,
      "tokens": 479,
      "context_length": 23813
    },
    {
      "position": 57,
      "id": "/tmp/repos/django/django/views/decorators/debug.py_1_sensitive_variables.4.1",
      "distance": 1.3126376867294312,
      "file_path": "django/views/decorators/debug.py",
      "start_line": 1,
      "end_line": 46,
      "tokens": 273,
      "context_length": 24086
    },
    {
      "position": 58,
      "id": "/tmp/repos/django/django/db/models/options.py_Options.managers_Options.managers_map.1.1",
      "distance": 1.3128269910812378,
      "file_path": "django/db/models/options.py",
      "start_line": 440,
      "end_line": 462,
      "tokens": 164,
      "context_length": 24250
    },
    {
      "position": 59,
      "id": "/tmp/repos/django/django/db/backends/mysql/features.py_DatabaseFeatures.django_test_skips_DatabaseFeatures.django_test_skips.6.1",
      "distance": 1.3128706216812134,
      "file_path": "django/db/backends/mysql/features.py",
      "start_line": 86,
      "end_line": 160,
      "tokens": 597,
      "context_length": 24847
    },
    {
      "position": 60,
      "id": "/tmp/repos/django/django/db/backends/sqlite3/operations.py_DatabaseOperations.on_conflict_suffix_sql_",
      "distance": 1.3143377304077148,
      "file_path": "django/db/backends/sqlite3/operations.py",
      "start_line": 417,
      "end_line": 437,
      "tokens": 148,
      "context_length": 24995
    },
    {
      "position": 61,
      "id": "/tmp/repos/django/django/db/backends/postgresql/operations.py_DatabaseOperations.on_conflict_suffix_sql_",
      "distance": 1.315432071685791,
      "file_path": "django/db/backends/postgresql/operations.py",
      "start_line": 338,
      "end_line": 357,
      "tokens": 150,
      "context_length": 25145
    },
    {
      "position": 62,
      "id": "/tmp/repos/django/django/utils/log.py_AdminEmailHandler_AdminEmailHandler.format_subject.2.1",
      "distance": 1.3160148859024048,
      "file_path": "django/utils/log.py",
      "start_line": 79,
      "end_line": 142,
      "tokens": 475,
      "context_length": 25620
    },
    {
      "position": 63,
      "id": "/tmp/repos/django/django/db/backends/oracle/base.py_33__UninitializedOperatorsDescriptor.__get__.4.4.1",
      "distance": 1.3172928094863892,
      "file_path": "django/db/backends/oracle/base.py",
      "start_line": 64,
      "end_line": 102,
      "tokens": 325,
      "context_length": 25945
    },
    {
      "position": 64,
      "id": "/tmp/repos/django/django/db/backends/utils.py_CursorWrapper.execute_CursorWrapper._executemany.2.1.1",
      "distance": 1.317824125289917,
      "file_path": "django/db/backends/utils.py",
      "start_line": 66,
      "end_line": 94,
      "tokens": 255,
      "context_length": 26200
    },
    {
      "position": 65,
      "id": "/tmp/repos/django/django/core/handlers/asgi.py_ASGIHandler.handle_ASGIHandler.handle.17",
      "distance": 1.3179771900177002,
      "file_path": "django/core/handlers/asgi.py",
      "start_line": 161,
      "end_line": 189,
      "tokens": 257,
      "context_length": 26457
    },
    {
      "position": 66,
      "id": "/tmp/repos/django/django/contrib/auth/backends.py_AllowAllUsersModelBackend_RemoteUserBackend.create_unknown_user.1",
      "distance": 1.3187193870544434,
      "file_path": "django/contrib/auth/backends.py",
      "start_line": 167,
      "end_line": 185,
      "tokens": 146,
      "context_length": 26603
    },
    {
      "position": 67,
      "id": "/tmp/repos/django/django/contrib/auth/middleware.py_RemoteUserMiddleware.clean_username_RemoteUserMiddleware._remove_invalid_user.2.3.1.1",
      "distance": 1.31979238986969,
      "file_path": "django/contrib/auth/middleware.py",
      "start_line": 87,
      "end_line": 114,
      "tokens": 195,
      "context_length": 26798
    },
    {
      "position": 68,
      "id": "/tmp/repos/django/django/dispatch/dispatcher.py_receiver_",
      "distance": 1.32007896900177,
      "file_path": "django/dispatch/dispatcher.py",
      "start_line": 283,
      "end_line": 306,
      "tokens": 139,
      "context_length": 26937
    },
    {
      "position": 69,
      "id": "/tmp/repos/django/django/core/checks/model_checks.py__check_lazy_references.default_error_",
      "distance": 1.320231556892395,
      "file_path": "django/core/checks/model_checks.py",
      "start_line": 187,
      "end_line": 228,
      "tokens": 345,
      "context_length": 27282
    },
    {
      "position": 70,
      "id": "/tmp/repos/django/django/db/backends/utils.py_datetime_CursorWrapper.8",
      "distance": 1.3208799362182617,
      "file_path": "django/db/backends/utils.py",
      "start_line": 1,
      "end_line": 46,
      "tokens": 287,
      "context_length": 27569
    },
    {
      "position": 71,
      "id": "/tmp/repos/django/django/core/management/commands/compilemessages.py_codecs_is_writable.3.3.1",
      "distance": 1.3217616081237793,
      "file_path": "django/core/management/commands/compilemessages.py",
      "start_line": 1,
      "end_line": 27,
      "tokens": 162,
      "context_length": 27731
    },
    {
      "position": 72,
      "id": "/tmp/repos/django/django/utils/log.py_CallbackFilter_RequireDebugTrue.filter.1.1",
      "distance": 1.3233959674835205,
      "file_path": "django/utils/log.py",
      "start_line": 145,
      "end_line": 168,
      "tokens": 125,
      "context_length": 27856
    },
    {
      "position": 73,
      "id": "/tmp/repos/django/django/utils/autoreload.py_WatchmanReloader_WatchmanReloader._watch_root.10.6.1",
      "distance": 1.3242310285568237,
      "file_path": "django/utils/autoreload.py",
      "start_line": 431,
      "end_line": 464,
      "tokens": 354,
      "context_length": 28210
    },
    {
      "position": 74,
      "id": "/tmp/repos/django/django/db/backends/base/base.py_BaseDatabaseWrapper.77_BaseDatabaseWrapper.validate_thread_sharing.2.1",
      "distance": 1.3249588012695312,
      "file_path": "django/db/backends/base/base.py",
      "start_line": 617,
      "end_line": 649,
      "tokens": 230,
      "context_length": 28440,
      "file_pos": 42
    },
    {
      "position": 75,
      "id": "/tmp/repos/django/django/core/management/base.py_BaseCommand.check_BaseCommand.check.10.1.2.1",
      "distance": 1.3251614570617676,
      "file_path": "django/core/management/base.py",
      "start_line": 460,
      "end_line": 554,
      "tokens": 665,
      "context_length": 29105
    },
    {
      "position": 76,
      "id": "/tmp/repos/django/django/db/backends/utils.py_CursorDebugWrapper_CursorDebugWrapper.execute.debug_sql.2.2.6",
      "distance": 1.3253173828125,
      "file_path": "django/db/backends/utils.py",
      "start_line": 97,
      "end_line": 144,
      "tokens": 327,
      "context_length": 29432
    },
    {
      "position": 77,
      "id": "/tmp/repos/django/django/core/management/commands/squashmigrations.py_Command.handle.30_Command.handle.43.2.2.1",
      "distance": 1.3255821466445923,
      "file_path": "django/core/management/commands/squashmigrations.py",
      "start_line": 162,
      "end_line": 254,
      "tokens": 766,
      "context_length": 30198
    },
    {
      "position": 78,
      "id": "/tmp/repos/django/django/db/backends/postgresql/base.py_DatabaseWrapper._set_autocommit_DatabaseWrapper.is_usable.1.4.1.1",
      "distance": 1.3256607055664062,
      "file_path": "django/db/backends/postgresql/base.py",
      "start_line": 304,
      "end_line": 325,
      "tokens": 156,
      "context_length": 30354
    },
    {
      "position": 79,
      "id": "/tmp/repos/django/django/utils/autoreload.py_StatReloader_WatchmanUnavailable.1",
      "distance": 1.3260917663574219,
      "file_path": "django/utils/autoreload.py",
      "start_line": 384,
      "end_line": 428,
      "tokens": 273,
      "context_length": 30627
    },
    {
      "position": 80,
      "id": "/tmp/repos/django/django/contrib/auth/signals.py__",
      "distance": 1.3263205289840698,
      "file_path": "django/contrib/auth/signals.py",
      "start_line": 1,
      "end_line": 6,
      "tokens": 0,
      "context_length": 30627
    },
    {
      "position": 81,
      "id": "/tmp/repos/django/django/db/backends/utils.py_CursorWrapper.callproc_CursorWrapper.callproc.3.3.1.3.2.1",
      "distance": 1.3263312578201294,
      "file_path": "django/db/backends/utils.py",
      "start_line": 48,
      "end_line": 64,
      "tokens": 176,
      "context_length": 30803
    },
    {
      "position": 82,
      "id": "/tmp/repos/django/django/db/models/sql/compiler.py_SQLUpdateCompiler.pre_sql_setup_SQLUpdateCompiler.pre_sql_setup.23",
      "distance": 1.3264739513397217,
      "file_path": "django/db/models/sql/compiler.py",
      "start_line": 1911,
      "end_line": 1972,
      "tokens": 588,
      "context_length": 31391
    },
    {
      "position": 83,
      "id": "/tmp/repos/django/django/core/checks/compatibility/django_4_0.py_1_",
      "distance": 1.328345537185669,
      "file_path": "django/core/checks/compatibility/django_4_0.py",
      "start_line": 1,
      "end_line": 21,
      "tokens": 142,
      "context_length": 31533
    },
    {
      "position": 84,
      "id": "/tmp/repos/django/django/db/migrations/autodetector.py_MigrationAutodetector.generate_removed_altered_unique_together_MigrationAutodetector.generate_altered_index_together.1",
      "distance": 1.3296998739242554,
      "file_path": "django/db/migrations/autodetector.py",
      "start_line": 1504,
      "end_line": 1532,
      "tokens": 235,
      "context_length": 31768
    },
    {
      "position": 85,
      "id": "/tmp/repos/django/django/contrib/postgres/operations.py_1_CreateExtension.database_forwards.9",
      "distance": 1.3299962282180786,
      "file_path": "django/contrib/postgres/operations.py",
      "start_line": 1,
      "end_line": 37,
      "tokens": 271,
      "context_length": 32039
    },
    {
      "position": 86,
      "id": "/tmp/repos/django/django/contrib/auth/middleware.py_RemoteUserMiddleware.process_request_RemoteUserMiddleware.process_request.2.10.request.user.2",
      "distance": 1.3302754163742065,
      "file_path": "django/contrib/auth/middleware.py",
      "start_line": 48,
      "end_line": 85,
      "tokens": 362,
      "context_length": 32401
    },
    {
      "position": 87,
      "id": "/tmp/repos/django/django/db/backends/sqlite3/operations.py_DatabaseOperations._quote_params_for_last_executed_query_DatabaseOperations._quote_params_for_last_executed_query.14.2.1",
      "distance": 1.3315495252609253,
      "file_path": "django/db/backends/sqlite3/operations.py",
      "start_line": 142,
      "end_line": 167,
      "tokens": 280,
      "context_length": 32681
    },
    {
      "position": 88,
      "id": "/tmp/repos/django/django/middleware/common.py_BrokenLinkEmailsMiddleware.is_ignorable_request_",
      "distance": 1.3320767879486084,
      "file_path": "django/middleware/common.py",
      "start_line": 153,
      "end_line": 179,
      "tokens": 255,
      "context_length": 32936
    },
    {
      "position": 89,
      "id": "/tmp/repos/django/django/db/backends/oracle/features.py_DatabaseFeatures.django_test_skips_",
      "distance": 1.3322468996047974,
      "file_path": "django/db/backends/oracle/features.py",
      "start_line": 85,
      "end_line": 149,
      "tokens": 604,
      "context_length": 33540
    },
    {
      "position": 90,
      "id": "/tmp/repos/django/django/db/models/options.py_Options.add_manager_Options.add_field.5.12.3.1",
      "distance": 1.3329192399978638,
      "file_path": "django/db/models/options.py",
      "start_line": 330,
      "end_line": 366,
      "tokens": 338,
      "context_length": 33878
    },
    {
      "position": 91,
      "id": "/tmp/repos/django/django/core/management/commands/migrate.py_Command.handle.34_Command.handle.48",
      "distance": 1.3329275846481323,
      "file_path": "django/core/management/commands/migrate.py",
      "start_line": 263,
      "end_line": 361,
      "tokens": 813,
      "context_length": 34691
    }
  ],
  "files": [
    {
      "file_path": "django/dispatch/dispatcher.py",
      "position": 1,
      "tokens": 2105,
      "context_length": 2105
    },
    {
      "file_path": "django/db/backends/base/features.py",
      "position": 2,
      "tokens": 3069,
      "context_length": 5174
    },
    {
      "file_path": "django/db/transaction.py",
      "position": 3,
      "tokens": 2310,
      "context_length": 7484
    },
    {
      "file_path": "django/db/backends/base/base.py",
      "position": 4,
      "tokens": 5429,
      "context_length": 12913
    },
    {
      "file_path": "django/contrib/postgres/signals.py",
      "position": 5,
      "tokens": 508,
      "context_length": 13421
    },
    {
      "file_path": "django/db/models/base.py",
      "position": 6,
      "tokens": 18551,
      "context_length": 31972
    },
    {
      "file_path": "django/db/models/deletion.py",
      "position": 7,
      "tokens": 3982,
      "context_length": 35954
    },
    {
      "file_path": "django/db/backends/sqlite3/features.py",
      "position": 8,
      "tokens": 1247,
      "context_length": 37201
    },
    {
      "file_path": "django/db/__init__.py",
      "position": 9,
      "tokens": 299,
      "context_length": 37500
    },
    {
      "file_path": "django/db/backends/oracle/features.py",
      "position": 10,
      "tokens": 1308,
      "context_length": 38808
    },
    {
      "file_path": "django/db/backends/signals.py",
      "position": 11,
      "tokens": 11,
      "context_length": 38819
    },
    {
      "file_path": "django/utils/autoreload.py",
      "position": 12,
      "tokens": 5126,
      "context_length": 43945
    },
    {
      "file_path": "django/db/utils.py",
      "position": 13,
      "tokens": 1899,
      "context_length": 45844
    },
    {
      "file_path": "django/core/management/sql.py",
      "position": 14,
      "tokens": 367,
      "context_length": 46211
    },
    {
      "file_path": "django/core/checks/model_checks.py",
      "position": 15,
      "tokens": 1810,
      "context_length": 48021
    },
    {
      "file_path": "django/db/models/options.py",
      "position": 16,
      "tokens": 7588,
      "context_length": 55609
    },
    {
      "file_path": "django/core/signals.py",
      "position": 17,
      "tokens": 27,
      "context_length": 55636
    },
    {
      "file_path": "django/db/backends/postgresql/features.py",
      "position": 18,
      "tokens": 792,
      "context_length": 56428
    },
    {
      "file_path": "django/db/backends/sqlite3/_functions.py",
      "position": 19,
      "tokens": 3856,
      "context_length": 60284
    },
    {
      "file_path": "django/contrib/auth/backends.py",
      "position": 20,
      "tokens": 1891,
      "context_length": 62175
    },
    {
      "file_path": "django/db/models/fields/related_descriptors.py",
      "position": 21,
      "tokens": 11296,
      "context_length": 73471
    },
    {
      "file_path": "django/core/handlers/asgi.py",
      "position": 22,
      "tokens": 2384,
      "context_length": 75855
    },
    {
      "file_path": "django/db/backends/mysql/base.py",
      "position": 23,
      "tokens": 3512,
      "context_length": 79367
    },
    {
      "file_path": "django/db/models/__init__.py",
      "position": 24,
      "tokens": 682,
      "context_length": 80049
    },
    {
      "file_path": "django/db/backends/mysql/features.py",
      "position": 25,
      "tokens": 2371,
      "context_length": 82420
    },
    {
      "file_path": "django/core/handlers/base.py",
      "position": 26,
      "tokens": 2650,
      "context_length": 85070
    },
    {
      "file_path": "django/core/handlers/exception.py",
      "position": 27,
      "tokens": 1118,
      "context_length": 86188
    },
    {
      "file_path": "django/contrib/admin/options.py",
      "position": 28,
      "tokens": 19220,
      "context_length": 105408
    },
    {
      "file_path": "django/core/management/commands/squashmigrations.py",
      "position": 29,
      "tokens": 2040,
      "context_length": 107448
    },
    {
      "file_path": "django/utils/asyncio.py",
      "position": 30,
      "tokens": 222,
      "context_length": 107670
    },
    {
      "file_path": "django/views/debug.py",
      "position": 31,
      "tokens": 4746,
      "context_length": 112416
    },
    {
      "file_path": "django/db/backends/sqlite3/base.py",
      "position": 32,
      "tokens": 3090,
      "context_length": 115506
    },
    {
      "file_path": "django/core/checks/__init__.py",
      "position": 33,
      "tokens": 327,
      "context_length": 115833
    },
    {
      "file_path": "django/db/models/query.py",
      "position": 34,
      "tokens": 20450,
      "context_length": 136283
    },
    {
      "file_path": "django/views/decorators/debug.py",
      "position": 35,
      "tokens": 591,
      "context_length": 136874
    },
    {
      "file_path": "django/db/backends/sqlite3/operations.py",
      "position": 36,
      "tokens": 3487,
      "context_length": 140361
    },
    {
      "file_path": "django/db/backends/postgresql/operations.py",
      "position": 37,
      "tokens": 2989,
      "context_length": 143350
    },
    {
      "file_path": "django/utils/log.py",
      "position": 38,
      "tokens": 1674,
      "context_length": 145024
    },
    {
      "file_path": "django/db/backends/oracle/base.py",
      "position": 39,
      "tokens": 5149,
      "context_length": 150173
    },
    {
      "file_path": "django/db/backends/utils.py",
      "position": 40,
      "tokens": 2035,
      "context_length": 152208
    },
    {
      "file_path": "django/contrib/auth/middleware.py",
      "position": 41,
      "tokens": 1010,
      "context_length": 153218
    },
    {
      "file_path": "django/core/management/commands/compilemessages.py",
      "position": 42,
      "tokens": 1359,
      "context_length": 154577
    },
    {
      "file_path": "django/core/management/base.py",
      "position": 43,
      "tokens": 4786,
      "context_length": 159363
    },
    {
      "file_path": "django/db/backends/postgresql/base.py",
      "position": 44,
      "tokens": 3060,
      "context_length": 162423
    },
    {
      "file_path": "django/contrib/auth/signals.py",
      "position": 45,
      "tokens": 24,
      "context_length": 162447
    },
    {
      "file_path": "django/db/models/sql/compiler.py",
      "position": 46,
      "tokens": 16146,
      "context_length": 178593
    },
    {
      "file_path": "django/core/checks/compatibility/django_4_0.py",
      "position": 47,
      "tokens": 143,
      "context_length": 178736
    },
    {
      "file_path": "django/db/migrations/autodetector.py",
      "position": 48,
      "tokens": 13461,
      "context_length": 192197
    },
    {
      "file_path": "django/contrib/postgres/operations.py",
      "position": 49,
      "tokens": 2348,
      "context_length": 194545
    },
    {
      "file_path": "django/middleware/common.py",
      "position": 50,
      "tokens": 1546,
      "context_length": 196091
    },
    {
      "file_path": "django/core/management/commands/migrate.py",
      "position": 51,
      "tokens": 3907,
      "context_length": 199998
    }
  ]
}