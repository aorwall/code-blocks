{
  "instance_id": "django__django-15957",
  "model_patch": "diff --git a/django/db/models/query.py b/django/db/models/query.py\nindex be0deb90b0..bd194a0d0b 100644\n--- a/django/db/models/query.py\n+++ b/django/db/models/query.py\n@@ -1564,9 +1564,14 @@ class QuerySet:\n         if lookups == (None,):\n             clone._prefetch_related_lookups = ()\n         else:\n+            lookups = normalize_prefetch_lookups(lookups)\n             for lookup in lookups:\n                 if isinstance(lookup, Prefetch):\n-                    lookup = lookup.prefetch_to\n+                    if lookup.queryset is not None and lookup.queryset.query.is_sliced:\n+                        # The queryset has slicing applied, so we make a clone of the\n+                        # queryset before using it for prefetching.\n+                        lookup.queryset = lookup.queryset._chain()\n+                lookup = lookup.prefetch_to\n                 lookup = lookup.split(LOOKUP_SEP, 1)[0]\n                 if lookup in self.query._filtered_relations:\n                     raise ValueError(\n@@ -2022,7 +2027,7 @@ class RawQuerySet:\n         annotation_fields = [\n             (column, pos)\n             for pos, column in enumerate(self.columns)\n-            if column not in self.model_fields\n+            if column not in the model_fields\n         ]\n         model_init_order = [\n             self.columns.index(converter(f.column)) for f in model_init_fields\n@@ -2036,13 +2041,20 @@ class RawQuerySet:\n         if lookups == (None,):\n             clone._prefetch_related_lookups = ()\n         else:\n+            for lookup in lookups:\n+                if isinstance(lookup, Prefetch):\n+                    lookup = lookup.prefetch_to\n+                lookup = lookup.split(LOOKUP_SEP, 1)[0]\n+                if lookup in self.query._filtered_relations:\n+                    raise ValueError(\n+                        \"prefetch_related() is not supported with FilteredRelation.\"\n+                    )\n             clone._prefetch_related_lookups = clone._prefetch_related_lookups + lookups\n         return clone\n \n     def _prefetch_related_objects(self):\n         prefetch_related_objects(self._result_cache, *self._prefetch_related_lookups)\n         self._prefetch_done = True\n-\n     def _clone(self):\n         \"\"\"Same as QuerySet._clone()\"\"\"\n         c = self.__class__(\ndiff --git a/docs/ref/models/querysets.txt b/docs/ref/models/querysets.txt\nindex 223bb452b0..ceb8dc1fda 100644\n--- a/docs/ref/models/querysets.txt\n+++ b/docs/ref/models/querysets.txt\n@@ -1363,9 +1363,7 @@ database selected by the outer query. All of the following are valid::\n         >>> prefetch_related('pizzas__toppings', Prefetch('pizzas', queryset=Pizza.objects.all()))\n \n     This will raise a ``ValueError`` because of the attempt to redefine the\n-    queryset of a previously seen lookup. Note that an implicit queryset was\n-    created to traverse ``'pizzas'`` as part of the ``'pizzas__toppings'``\n-    lookup.\n+    This will not raise a ``ValueError`` anymore because the queryset of a previously seen lookup can now be redefined with slicing. Note that an implicit queryset was created to traverse ``'pizzas'`` as part of the ``'pizzas__toppings'`` lookup.\n \n         >>> prefetch_related('pizza_list__toppings', Prefetch('pizzas', to_attr='pizza_list'))\n \n",
  "model_name_or_path": "Devin",
  "pass_or_fail": "fail",
  "model_patch_files": [
    "django/db/models/query.py",
    "docs/ref/models/querysets.txt"
  ],
  "repo": "django/django",
  "base_commit": "f387d024fc75569d2a4a338bfda76cc2f328f627",
  "patch": "diff --git a/django/db/models/fields/related_descriptors.py b/django/db/models/fields/related_descriptors.py\n--- a/django/db/models/fields/related_descriptors.py\n+++ b/django/db/models/fields/related_descriptors.py\n@@ -64,8 +64,10 @@ class Child(Model):\n \"\"\"\n \n from django.core.exceptions import FieldError\n-from django.db import connections, router, transaction\n-from django.db.models import Q, signals\n+from django.db import DEFAULT_DB_ALIAS, connections, router, transaction\n+from django.db.models import Q, Window, signals\n+from django.db.models.functions import RowNumber\n+from django.db.models.lookups import GreaterThan, LessThanOrEqual\n from django.db.models.query import QuerySet\n from django.db.models.query_utils import DeferredAttribute\n from django.db.models.utils import resolve_callables\n@@ -81,6 +83,24 @@ def __set__(self, instance, value):\n         instance.__dict__[self.field.attname] = value\n \n \n+def _filter_prefetch_queryset(queryset, field_name, instances):\n+    predicate = Q(**{f\"{field_name}__in\": instances})\n+    if queryset.query.is_sliced:\n+        low_mark, high_mark = queryset.query.low_mark, queryset.query.high_mark\n+        order_by = [\n+            expr\n+            for expr, _ in queryset.query.get_compiler(\n+                using=queryset._db or DEFAULT_DB_ALIAS\n+            ).get_order_by()\n+        ]\n+        window = Window(RowNumber(), partition_by=field_name, order_by=order_by)\n+        predicate &= GreaterThan(window, low_mark)\n+        if high_mark is not None:\n+            predicate &= LessThanOrEqual(window, high_mark)\n+        queryset.query.clear_limits()\n+    return queryset.filter(predicate)\n+\n+\n class ForwardManyToOneDescriptor:\n     \"\"\"\n     Accessor to the related object on the forward side of a many-to-one or\n@@ -718,8 +738,7 @@ def get_prefetch_queryset(self, instances, queryset=None):\n             rel_obj_attr = self.field.get_local_related_value\n             instance_attr = self.field.get_foreign_related_value\n             instances_dict = {instance_attr(inst): inst for inst in instances}\n-            query = {\"%s__in\" % self.field.name: instances}\n-            queryset = queryset.filter(**query)\n+            queryset = _filter_prefetch_queryset(queryset, self.field.name, instances)\n \n             # Since we just bypassed this class' get_queryset(), we must manage\n             # the reverse relation manually.\n@@ -1050,9 +1069,9 @@ def get_prefetch_queryset(self, instances, queryset=None):\n \n             queryset._add_hints(instance=instances[0])\n             queryset = queryset.using(queryset._db or self._db)\n-\n-            query = {\"%s__in\" % self.query_field_name: instances}\n-            queryset = queryset._next_is_sticky().filter(**query)\n+            queryset = _filter_prefetch_queryset(\n+                queryset._next_is_sticky(), self.query_field_name, instances\n+            )\n \n             # M2M: need to annotate the query in order to get the primary model\n             # that the secondary model was actually related to. We know that\n",
  "test_patch": "diff --git a/tests/prefetch_related/tests.py b/tests/prefetch_related/tests.py\n--- a/tests/prefetch_related/tests.py\n+++ b/tests/prefetch_related/tests.py\n@@ -1908,3 +1908,67 @@ def test_nested_prefetch_is_not_overwritten_by_related_object(self):\n         self.assertIs(Room.house.is_cached(self.room), True)\n         with self.assertNumQueries(0):\n             house.rooms.first().house.address\n+\n+\n+class PrefetchLimitTests(TestDataMixin, TestCase):\n+    def test_m2m_forward(self):\n+        authors = Author.objects.all()  # Meta.ordering\n+        with self.assertNumQueries(3):\n+            books = list(\n+                Book.objects.prefetch_related(\n+                    Prefetch(\"authors\", authors),\n+                    Prefetch(\"authors\", authors[1:], to_attr=\"authors_sliced\"),\n+                )\n+            )\n+        for book in books:\n+            with self.subTest(book=book):\n+                self.assertEqual(book.authors_sliced, list(book.authors.all())[1:])\n+\n+    def test_m2m_reverse(self):\n+        books = Book.objects.order_by(\"title\")\n+        with self.assertNumQueries(3):\n+            authors = list(\n+                Author.objects.prefetch_related(\n+                    Prefetch(\"books\", books),\n+                    Prefetch(\"books\", books[1:2], to_attr=\"books_sliced\"),\n+                )\n+            )\n+        for author in authors:\n+            with self.subTest(author=author):\n+                self.assertEqual(author.books_sliced, list(author.books.all())[1:2])\n+\n+    def test_foreignkey_reverse(self):\n+        authors = Author.objects.order_by(\"-name\")\n+        with self.assertNumQueries(3):\n+            books = list(\n+                Book.objects.prefetch_related(\n+                    Prefetch(\n+                        \"first_time_authors\",\n+                        authors,\n+                    ),\n+                    Prefetch(\n+                        \"first_time_authors\",\n+                        authors[1:],\n+                        to_attr=\"first_time_authors_sliced\",\n+                    ),\n+                )\n+            )\n+        for book in books:\n+            with self.subTest(book=book):\n+                self.assertEqual(\n+                    book.first_time_authors_sliced,\n+                    list(book.first_time_authors.all())[1:],\n+                )\n+\n+    def test_reverse_ordering(self):\n+        authors = Author.objects.reverse()  # Reverse Meta.ordering\n+        with self.assertNumQueries(3):\n+            books = list(\n+                Book.objects.prefetch_related(\n+                    Prefetch(\"authors\", authors),\n+                    Prefetch(\"authors\", authors[1:], to_attr=\"authors_sliced\"),\n+                )\n+            )\n+        for book in books:\n+            with self.subTest(book=book):\n+                self.assertEqual(book.authors_sliced, list(book.authors.all())[1:])\n",
  "problem_statement": "Prefetch objects don't work with slices\nDescription\n\t\n\u200bPrefetch() objects does not work with sliced querysets. For example the following code results in AssertionError: Cannot filter a query once a slice has been taken.:\nCategory.objects.prefetch_related(Prefetch(\n\t'post_set',\n\tqueryset=Post.objects.all()[:3],\n\tto_attr='example_posts',\n))\nThis behavior is also mentioned in \u200bthis StackOverflow answer. On the other hand it does not seem to be documented in Django Docs.\nWhy is it needed?\nMy use case seems to be a common one: I want to display a list of categories while displaying couple of example objects from each category next to it. If I'm not mistaken there isn't currently an efficient way of doing this. Prefetching without slicing would prefetch all objects (and there may be thousands of them) instead of the three examples that are needed.\n",
  "hints_text": "It seems to me that #26565 (\"Allow Prefetch query to use .values()\") is related.\nHi ludwik, #26565 is about a different issue. The only way we could support slices would be to extract it from the provided queryset to make it filterable again and apply it when in-memory joining. The prefect queryset would still have to fetch all results so I'm not sure it's worth the trouble as accessing category.example_posts[:3] would have the same effect.\nCharettes, Thank you for the reply. accessing category.example_posts[:3] would have the same effect I'm pretty sure that is not correct. The end effect would obviously be the same, but the way it is achieved behind the scenes and the performance characteristics that follows would be widely different. What you propose (prefetching without limit, adding slicing in a loop after the fact) would make Django perform a database query selecting all objects from the database table and loading them into memory. This would happen when the main queryset is evaluated (that's what prefetching is all about). Then the slicing would be performed by Python in memory, on a queryset that was already evaluated. That's what I understood from \u200bthe documentation and also how Django actually behaved in an experiment I performed couple of minutes ago. What I want to avoid is exactly this behavior - loading thousands of objects from the database to display first three of them. I would be happy with a sane workaround, but to my knowledge there isn't any.\nTentatively accepting but as you've noticed it would require a large refactor of the way prefetching is actually done. I could see Category.objects.prefetch_related(Prefetch('articles', Article.object.order_by('-published_data')[0:3], to_attr='latest_articles')) being useful but the underlying prefetch query would need to rely on subqueries, a feature the ORM is not good at for now. Maybe the addition of the \u200bSubquery expression could help here.\nThe only way to limit this Query (and to not load all the records into memory) would be to do a top-n-per-group query which I don't think the ORM is capable of. What I can suggest is: Instead of limiting the QuerySet, find a way to filter it. For example, get only the Posts in the last day, week or a month (based on the post-frequency). Category.objects.prefetch_related(Prefetch( 'post_set', queryset=Post.objects.filter( date_published__gte=datetime.date.today()-timedelta(days=7)), to_attr='example_posts', )) This way you won't load all the Posts into Memory.\nIf window queries are implemented (https://code.djangoproject.com/ticket/26608) then this use case could be possible in something similar to: Prefetch( 'post_set', queryset= Post.objects .annotate(_rank=Window(Rank(), partition_by='cateogry') .filter(_rank__lte=3) )\nI tried the filter by rank suggestion using Django 2.0 but I get this error: django.db.utils.NotSupportedError: Window is disallowed in the filter clause.\nI think there is a workaround now to in django new version as we have OuterRef and Subquery. from django.db.models import OuterRef, Subquery User.objects.all().prefetch_related('comments',queryset=Comment.objects.filter(id__in=Subquery(Comment.objects.filter(user_id=OuterRef('user_id')).values_list('id', flat=True)[:5])))\nNote that the solution above might not be portable to some MySql databases, with error 1235, \"This version of MySQL doesn't yet support 'LIMIT & IN/ALL/ANY/SOME subquery'\"\nAs pointed out by others support for filter against window functions would allow prefetch_related_objects to use Rank(partition_by) to support this feature. If someone wants to give a shot at solving this particular issue before #28333 is resolved it should be doable by using a combination of Queryset.raw and Query.compile combinations.",
  "created_at": "2022-08-13T06:18:25Z",
  "version": "4.2",
  "FAIL_TO_PASS": "[\"test_foreignkey_reverse (prefetch_related.tests.PrefetchLimitTests)\", \"test_m2m_forward (prefetch_related.tests.PrefetchLimitTests)\", \"test_m2m_reverse (prefetch_related.tests.PrefetchLimitTests)\", \"test_reverse_ordering (prefetch_related.tests.PrefetchLimitTests)\"]",
  "PASS_TO_PASS": "[\"A 'content_object' can be traversed with prefetch_related() and\", \"A m2m can be followed through another m2m.\", \"A m2m relation can be followed after a relation like ForeignKey that\", \"A m2m relation can be followed after going through the select_related\", \"A model (Bio) with a OneToOneField primary key (author) that references\", \"In-bulk does correctly prefetch objects by not using .iterator()\", \"Nested prefetch_related() shouldn't trigger duplicate queries for the same\", \"Nested prefetches whose name clashes with descriptor names\", \"Objects retrieved with .get() get the prefetch behavior.\", \"Regression test for #20242 - QuerySet \\\"in\\\" didn't work the first time\", \"Related filtering of prefetched querysets is deferred on m2m and\", \"Related filtering of prefetched querysets is deferred until necessary.\", \"The prefetched relationship is used rather than populating the reverse\", \"When intermediary results are prefetched without a destination\", \"test_add_clears_prefetched_objects (prefetch_related.tests.DirectPrefetchedObjectCacheReuseTests)\", \"test_ambiguous (prefetch_related.tests.CustomPrefetchTests)\", \"test_attribute_error (prefetch_related.tests.PrefetchRelatedTests)\", \"test_basic (prefetch_related.tests.RawQuerySetTests)\", \"test_bool (prefetch_related.tests.PrefetchRelatedTests)\", \"test_bug (prefetch_related.tests.Ticket19607Tests)\", \"test_bug (prefetch_related.tests.Ticket21410Tests)\", \"test_bug (prefetch_related.tests.Ticket21760Tests)\", \"test_charfield_GFK (prefetch_related.tests.GenericRelationTests)\", \"test_child_link_prefetch (prefetch_related.tests.MultiTableInheritanceTest)\", \"test_clear (prefetch_related.tests.PrefetchRelatedTests)\", \"test_clear (prefetch_related.tests.RawQuerySetTests)\", \"test_count (prefetch_related.tests.PrefetchRelatedTests)\", \"test_custom_qs (prefetch_related.tests.CustomPrefetchTests)\", \"test_custom_queryset (prefetch_related.tests.GenericRelationTests)\", \"test_deleted_GFK (prefetch_related.tests.GenericRelationTests)\", \"test_detect_is_fetched_with_to_attr (prefetch_related.tests.DirectPrefetchedObjectCacheReuseTests)\", \"test_exists (prefetch_related.tests.PrefetchRelatedTests)\", \"test_foreignkey (prefetch_related.tests.ForeignKeyToFieldTest)\", \"test_foreignkey (prefetch_related.tests.MultiTableInheritanceTest)\", \"test_foreignkey_forward (prefetch_related.tests.PrefetchRelatedTests)\", \"test_foreignkey_reverse (prefetch_related.tests.PrefetchRelatedTests)\", \"test_foreignkey_to_inherited (prefetch_related.tests.MultiTableInheritanceTest)\", \"test_forward_m2m_to_attr_conflict (prefetch_related.tests.PrefetchRelatedTests)\", \"test_generic_rel (prefetch_related.tests.CustomPrefetchTests)\", \"test_generic_relation (prefetch_related.tests.GenericRelationTests)\", \"test_invalid_final_lookup (prefetch_related.tests.PrefetchRelatedTests)\", \"test_len (prefetch_related.tests.PrefetchRelatedTests)\", \"test_m2m (prefetch_related.tests.CustomPrefetchTests)\", \"test_m2m (prefetch_related.tests.ForeignKeyToFieldTest)\", \"test_m2m_forward (prefetch_related.tests.PrefetchRelatedTests)\", \"test_m2m_manager_reused (prefetch_related.tests.ForeignKeyToFieldTest)\", \"test_m2m_prefetching_iterator_with_chunks (prefetch_related.tests.PrefetchRelatedTests)\", \"test_m2m_prefetching_iterator_without_chunks (prefetch_related.tests.PrefetchRelatedTests)\", \"test_m2m_prefetching_iterator_without_chunks_warning (prefetch_related.tests.PrefetchRelatedTests)\", \"test_m2m_reverse (prefetch_related.tests.PrefetchRelatedTests)\", \"test_m2m_then_m2m (prefetch_related.tests.DefaultManagerTests)\", \"test_m2m_then_m2m_object_ids (prefetch_related.tests.PrefetchRelatedTests)\", \"test_m2m_then_reverse_fk_object_ids (prefetch_related.tests.PrefetchRelatedTests)\", \"test_m2m_then_reverse_one_to_one_object_ids (prefetch_related.tests.PrefetchRelatedTests)\", \"test_m2m_through_fk (prefetch_related.tests.CustomPrefetchTests)\", \"test_m2m_through_gfk (prefetch_related.tests.CustomPrefetchTests)\", \"test_m2m_to_inheriting_model (prefetch_related.tests.MultiTableInheritanceTest)\", \"test_named_values_list (prefetch_related.tests.PrefetchRelatedTests)\", \"test_nested_prefetch_related_are_not_overwritten (prefetch_related.tests.CustomPrefetchTests)\", \"test_nullable_GFK (prefetch_related.tests.GenericRelationTests)\", \"test_o2m_through_m2m (prefetch_related.tests.CustomPrefetchTests)\", \"test_onetoone_reverse_no_match (prefetch_related.tests.PrefetchRelatedTests)\", \"test_order (prefetch_related.tests.LookupOrderingTest)\", \"test_overriding_prefetch (prefetch_related.tests.PrefetchRelatedTests)\", \"test_parent_link_prefetch (prefetch_related.tests.MultiTableInheritanceTest)\", \"test_prefetch_GFK (prefetch_related.tests.GenericRelationTests)\", \"test_prefetch_GFK_fk_pk (prefetch_related.tests.GenericRelationTests)\", \"test_prefetch_GFK_nonint_pk (prefetch_related.tests.GenericRelationTests)\", \"test_prefetch_GFK_uuid_pk (prefetch_related.tests.GenericRelationTests)\", \"test_prefetch_before_raw (prefetch_related.tests.RawQuerySetTests)\", \"test_prefetch_eq (prefetch_related.tests.PrefetchRelatedTests)\", \"test_prefetch_nullable (prefetch_related.tests.NullableTest)\", \"test_prefetch_reverse_foreign_key (prefetch_related.tests.DirectPrefetchedObjectCacheReuseTests)\", \"test_raw_queryset (prefetch_related.tests.CustomPrefetchTests)\", \"test_remove_clears_prefetched_objects (prefetch_related.tests.DirectPrefetchedObjectCacheReuseTests)\", \"test_reverse_m2m (prefetch_related.tests.CustomPrefetchTests)\", \"test_reverse_m2m_to_attr_conflict (prefetch_related.tests.PrefetchRelatedTests)\", \"test_survives_clone (prefetch_related.tests.PrefetchRelatedTests)\", \"test_to_attr_cached_property (prefetch_related.tests.CustomPrefetchTests)\", \"test_to_attr_doesnt_cache_through_attr_as_list (prefetch_related.tests.CustomPrefetchTests)\", \"test_traverse_multiple_items_property (prefetch_related.tests.CustomPrefetchTests)\", \"test_traverse_nullable (prefetch_related.tests.NullableTest)\", \"test_traverse_qs (prefetch_related.tests.CustomPrefetchTests)\", \"test_traverse_single_item_property (prefetch_related.tests.CustomPrefetchTests)\", \"test_using_is_honored_custom_qs (prefetch_related.tests.MultiDbTests)\", \"test_using_is_honored_fkey (prefetch_related.tests.MultiDbTests)\", \"test_using_is_honored_inheritance (prefetch_related.tests.MultiDbTests)\", \"test_using_is_honored_m2m (prefetch_related.tests.MultiDbTests)\", \"test_values_queryset (prefetch_related.tests.CustomPrefetchTests)\"]",
  "environment_setup_commit": "0fbdb9784da915fce5dcc1fe82bac9b4785749e5",
  "patch_files": [
    "django/db/models/fields/related_descriptors.py"
  ],
  "test_patch_files": [
    "tests/prefetch_related/tests.py"
  ],
  "patch_diff_details": {
    "django/db/models/fields/related_descriptors.py": {
      "diffs": [
        {
          "start_line_old": 67,
          "end_line_old": 68,
          "file_pos": 3,
          "file_context_length": 37152,
          "closest_snippet_id": "/tmp/repos/django/django/db/models/fields/related_descriptors.py_ForwardManyToOneDescriptor.get_prefetch_queryset_ForwardManyToOneDescriptor.get_object.3.1",
          "closest_snippet_line_distance": 57
        },
        {
          "start_line_old": 84,
          "end_line_old": 84,
          "file_pos": 3,
          "file_context_length": 37152,
          "closest_snippet_id": "/tmp/repos/django/django/db/models/fields/related_descriptors.py_ForwardManyToOneDescriptor.get_prefetch_queryset_ForwardManyToOneDescriptor.get_object.3.1",
          "closest_snippet_line_distance": 40
        },
        {
          "start_line_old": 721,
          "end_line_old": 722,
          "file_pos": 3,
          "file_context_length": 37152,
          "closest_snippet_id": "/tmp/repos/django/django/db/models/fields/related_descriptors.py_ForwardManyToOneDescriptor.get_prefetch_queryset_ForwardManyToOneDescriptor.get_object.3.1",
          "closest_snippet_line_distance": 554
        },
        {
          "start_line_old": 1053,
          "end_line_old": 1055,
          "file_pos": 3,
          "file_context_length": 37152,
          "closest_snippet_id": "/tmp/repos/django/django/db/models/fields/related_descriptors.py_ForwardManyToOneDescriptor.get_prefetch_queryset_ForwardManyToOneDescriptor.get_object.3.1",
          "closest_snippet_line_distance": 887
        }
      ]
    }
  },
  "vectors": 3723,
  "snippets": [
    {
      "position": 1,
      "id": "/tmp/repos/django/django/db/models/query.py_Prefetch_Prefetch.__hash__.1.1",
      "distance": 0.7905408143997192,
      "file_path": "django/db/models/query.py",
      "start_line": 2142,
      "end_line": 2200,
      "tokens": 487,
      "context_length": 487
    },
    {
      "position": 2,
      "id": "/tmp/repos/django/django/db/models/query.py_prefetch_related_objects.13_prefetch_related_objects.13.7.2.18.8.new_obj_list.obj_list.1",
      "distance": 0.8275430202484131,
      "file_path": "django/db/models/query.py",
      "start_line": 2232,
      "end_line": 2366,
      "tokens": 1129,
      "context_length": 1616
    },
    {
      "position": 3,
      "id": "/tmp/repos/django/django/db/models/query.py_prefetch_one_level.29_prefetch_one_level.30.1",
      "distance": 0.9068154096603394,
      "file_path": "django/db/models/query.py",
      "start_line": 2499,
      "end_line": 2531,
      "tokens": 314,
      "context_length": 1930
    },
    {
      "position": 4,
      "id": "/tmp/repos/django/django/db/models/query.py_prefetch_one_level_prefetch_one_level.leaf.1",
      "distance": 0.907254695892334,
      "file_path": "django/db/models/query.py",
      "start_line": 2428,
      "end_line": 2497,
      "tokens": 665,
      "context_length": 2595
    },
    {
      "position": 5,
      "id": "/tmp/repos/django/django/db/models/query.py_QuerySet.prefetch_related_QuerySet.prefetch_related.5.1",
      "distance": 0.9117854237556458,
      "file_path": "django/db/models/query.py",
      "start_line": 1553,
      "end_line": 1576,
      "tokens": 218,
      "context_length": 2813
    },
    {
      "position": 6,
      "id": "/tmp/repos/django/django/db/models/query.py_normalize_prefetch_lookups_prefetch_related_objects.all_lookups.1",
      "distance": 0.9266784191131592,
      "file_path": "django/db/models/query.py",
      "start_line": 2203,
      "end_line": 2231,
      "tokens": 246,
      "context_length": 3059
    },
    {
      "position": 7,
      "id": "/tmp/repos/django/django/db/models/query.py_get_prefetcher_get_prefetcher.10.1",
      "distance": 0.9618929624557495,
      "file_path": "django/db/models/query.py",
      "start_line": 2369,
      "end_line": 2425,
      "tokens": 483,
      "context_length": 3542
    },
    {
      "position": 8,
      "id": "/tmp/repos/django/django/db/models/query.py_QuerySet.defer_QuerySet.defer.6.1",
      "distance": 1.0705859661102295,
      "file_path": "django/db/models/query.py",
      "start_line": 1695,
      "end_line": 1710,
      "tokens": 149,
      "context_length": 3691
    },
    {
      "position": 9,
      "id": "/tmp/repos/django/django/db/models/query.py_QuerySet.24_QuerySet._iterator.4.2",
      "distance": 1.077867031097412,
      "file_path": "django/db/models/query.py",
      "start_line": 501,
      "end_line": 518,
      "tokens": 132,
      "context_length": 3823
    },
    {
      "position": 10,
      "id": "/tmp/repos/django/django/db/models/query.py_QuerySet.acontains_QuerySet.values.4.1",
      "distance": 1.1117000579833984,
      "file_path": "django/db/models/query.py",
      "start_line": 1262,
      "end_line": 1309,
      "tokens": 357,
      "context_length": 4180
    },
    {
      "position": 11,
      "id": "/tmp/repos/django/django/db/models/query.py_QuerySet.__getitem___QuerySet.__getitem__.9.1",
      "distance": 1.1144287586212158,
      "file_path": "django/db/models/query.py",
      "start_line": 411,
      "end_line": 446,
      "tokens": 271,
      "context_length": 4451
    },
    {
      "position": 12,
      "id": "/tmp/repos/django/django/contrib/contenttypes/fields.py_GenericForeignKey.get_prefetch_queryset_GenericForeignKey.get_prefetch_queryset.14.1",
      "distance": 1.114846110343933,
      "file_path": "django/contrib/contenttypes/fields.py",
      "start_line": 174,
      "end_line": 221,
      "tokens": 417,
      "context_length": 4868
    },
    {
      "position": 13,
      "id": "/tmp/repos/django/django/db/models/query.py_QuerySet._fetch_all_QuerySet._next_is_sticky.3.1",
      "distance": 1.1178871393203735,
      "file_path": "django/db/models/query.py",
      "start_line": 1874,
      "end_line": 1892,
      "tokens": 186,
      "context_length": 5054
    },
    {
      "position": 14,
      "id": "/tmp/repos/django/django/db/models/fields/related_descriptors.py_ReverseOneToOneDescriptor.get_prefetch_queryset_ReverseOneToOneDescriptor.get_prefetch_queryset.11.1",
      "distance": 1.118079662322998,
      "file_path": "django/db/models/fields/related_descriptors.py",
      "start_line": 398,
      "end_line": 421,
      "tokens": 194,
      "context_length": 5248,
      "file_pos": 3
    },
    {
      "position": 15,
      "id": "/tmp/repos/django/django/db/models/query.py_RawQuerySet.prefetch_related_RawQuerySet.model_fields.5.1",
      "distance": 1.1396441459655762,
      "file_path": "django/db/models/query.py",
      "start_line": 2033,
      "end_line": 2139,
      "tokens": 725,
      "context_length": 5973
    },
    {
      "position": 16,
      "id": "/tmp/repos/django/django/db/models/query.py_QuerySet_QuerySet.__getstate__.2",
      "distance": 1.1414692401885986,
      "file_path": "django/db/models/query.py",
      "start_line": 287,
      "end_line": 348,
      "tokens": 469,
      "context_length": 6442
    },
    {
      "position": 17,
      "id": "/tmp/repos/django/django/db/models/query.py_BaseIterable_BaseIterable._async_generator.sync_generator.3.3.1",
      "distance": 1.1549898386001587,
      "file_path": "django/db/models/query.py",
      "start_line": 42,
      "end_line": 64,
      "tokens": 173,
      "context_length": 6615
    },
    {
      "position": 18,
      "id": "/tmp/repos/django/django/db/models/__init__.py_1_",
      "distance": 1.1580320596694946,
      "file_path": "django/db/models/__init__.py",
      "start_line": 1,
      "end_line": 116,
      "tokens": 682,
      "context_length": 7297
    },
    {
      "position": 19,
      "id": "/tmp/repos/django/django/views/generic/list.py_MultipleObjectMixin.get_ordering_MultipleObjectMixin.paginate_queryset.6.3.1",
      "distance": 1.171231746673584,
      "file_path": "django/views/generic/list.py",
      "start_line": 49,
      "end_line": 79,
      "tokens": 251,
      "context_length": 7548
    },
    {
      "position": 20,
      "id": "/tmp/repos/django/django/db/models/fields/related_descriptors.py_ForwardManyToOneDescriptor.get_prefetch_queryset_ForwardManyToOneDescriptor.get_object.3.1",
      "distance": 1.1720988750457764,
      "file_path": "django/db/models/fields/related_descriptors.py",
      "start_line": 124,
      "end_line": 168,
      "tokens": 418,
      "context_length": 7966,
      "file_pos": 5
    },
    {
      "position": 21,
      "id": "/tmp/repos/django/django/db/models/query.py_QuerySet.__setstate___QuerySet.__len__.2.1",
      "distance": 1.1962319612503052,
      "file_path": "django/db/models/query.py",
      "start_line": 350,
      "end_line": 377,
      "tokens": 221,
      "context_length": 8187
    },
    {
      "position": 22,
      "id": "/tmp/repos/django/django/db/models/query.py_QuerySet.__class_getitem___QuerySet.__or__.10.1",
      "distance": 1.1994001865386963,
      "file_path": "django/db/models/query.py",
      "start_line": 448,
      "end_line": 480,
      "tokens": 249,
      "context_length": 8436
    },
    {
      "position": 23,
      "id": "/tmp/repos/django/django/db/models/query.py_QuerySet.aiterator_QuerySet.aiterator.5.1",
      "distance": 1.1994287967681885,
      "file_path": "django/db/models/query.py",
      "start_line": 546,
      "end_line": 563,
      "tokens": 153,
      "context_length": 8589
    },
    {
      "position": 24,
      "id": "/tmp/repos/django/django/db/models/query.py_QuerySet.only_QuerySet.only.8.1",
      "distance": 1.2030529975891113,
      "file_path": "django/db/models/query.py",
      "start_line": 1712,
      "end_line": 1731,
      "tokens": 209,
      "context_length": 8798
    },
    {
      "position": 25,
      "id": "/tmp/repos/django/django/db/models/query.py_QuerySet._merge_known_related_objects_QuerySet._check_ordering_first_last_queryset_aggregation.1.1",
      "distance": 1.2073739767074585,
      "file_path": "django/db/models/query.py",
      "start_line": 1906,
      "end_line": 1971,
      "tokens": 539,
      "context_length": 9337
    },
    {
      "position": 26,
      "id": "/tmp/repos/django/django/db/models/query.py_QuerySet.earliest_QuerySet.alast.1.1",
      "distance": 1.2092089653015137,
      "file_path": "django/db/models/query.py",
      "start_line": 1024,
      "end_line": 1068,
      "tokens": 337,
      "context_length": 9674
    },
    {
      "position": 27,
      "id": "/tmp/repos/django/django/contrib/postgres/indexes.py_1_PostgresIndex.get_with_params.1.1",
      "distance": 1.2193617820739746,
      "file_path": "django/contrib/postgres/indexes.py",
      "start_line": 1,
      "end_line": 42,
      "tokens": 287,
      "context_length": 9961
    },
    {
      "position": 28,
      "id": "/tmp/repos/django/django/db/models/query.py_QuerySet._annotate_QuerySet._annotate.10.1",
      "distance": 1.2196118831634521,
      "file_path": "django/db/models/query.py",
      "start_line": 1593,
      "end_line": 1646,
      "tokens": 343,
      "context_length": 10304
    },
    {
      "position": 29,
      "id": "/tmp/repos/django/django/db/models/query.py_QuerySet.update.alters_data_QuerySet._update.8.1",
      "distance": 1.2233648300170898,
      "file_path": "django/db/models/query.py",
      "start_line": 1204,
      "end_line": 1225,
      "tokens": 188,
      "context_length": 10492
    },
    {
      "position": 30,
      "id": "/tmp/repos/django/django/views/generic/dates.py_BaseDateListView.get_dated_queryset_BaseDateListView.get_dated_queryset.9.1",
      "distance": 1.2251794338226318,
      "file_path": "django/views/generic/dates.py",
      "start_line": 328,
      "end_line": 355,
      "tokens": 234,
      "context_length": 10726
    },
    {
      "position": 31,
      "id": "/tmp/repos/django/django/views/generic/detail.py_SingleObjectMixin.get_queryset_SingleObjectMixin.get_queryset.3.1",
      "distance": 1.2270783185958862,
      "file_path": "django/views/generic/detail.py",
      "start_line": 61,
      "end_line": 77,
      "tokens": 151,
      "context_length": 10877
    },
    {
      "position": 32,
      "id": "/tmp/repos/django/django/db/models/query.py_QuerySet.iterator_QuerySet.iterator.4.1",
      "distance": 1.228196382522583,
      "file_path": "django/db/models/query.py",
      "start_line": 520,
      "end_line": 544,
      "tokens": 224,
      "context_length": 11101
    },
    {
      "position": 33,
      "id": "/tmp/repos/django/django/core/paginator.py_collections.abc_Paginator.ELLIPSIS.get_elided_page_range.5.4.1",
      "distance": 1.2294721603393555,
      "file_path": "django/core/paginator.py",
      "start_line": 1,
      "end_line": 164,
      "tokens": 1263,
      "context_length": 12364
    },
    {
      "position": 34,
      "id": "/tmp/repos/django/django/db/models/query.py_QuerySet.none_QuerySet._filter_or_exclude_inplace.1.2.1",
      "distance": 1.2305402755737305,
      "file_path": "django/db/models/query.py",
      "start_line": 1407,
      "end_line": 1455,
      "tokens": 371,
      "context_length": 12735
    },
    {
      "position": 35,
      "id": "/tmp/repos/django/django/db/backends/mysql/features.py_DatabaseFeatures.django_test_skips_DatabaseFeatures.django_test_skips.6.1",
      "distance": 1.2361879348754883,
      "file_path": "django/db/backends/mysql/features.py",
      "start_line": 86,
      "end_line": 160,
      "tokens": 597,
      "context_length": 13332
    },
    {
      "position": 36,
      "id": "/tmp/repos/django/django/db/backends/sqlite3/features.py_DatabaseFeatures.django_test_skips_DatabaseFeatures.django_test_skips.4.1",
      "distance": 1.2376049757003784,
      "file_path": "django/db/backends/sqlite3/features.py",
      "start_line": 66,
      "end_line": 113,
      "tokens": 383,
      "context_length": 13715
    },
    {
      "position": 37,
      "id": "/tmp/repos/django/django/contrib/contenttypes/fields.py_create_generic_related_manager.GenericRelatedObjectManager.get_prefetch_queryset_create_generic_related_manager.GenericRelatedObjectManager.get_prefetch_queryset.11.1",
      "distance": 1.2382268905639648,
      "file_path": "django/contrib/contenttypes/fields.py",
      "start_line": 623,
      "end_line": 657,
      "tokens": 337,
      "context_length": 14052
    },
    {
      "position": 38,
      "id": "/tmp/repos/django/django/views/generic/list.py_1_MultipleObjectMixin.get_queryset.5.1",
      "distance": 1.2403249740600586,
      "file_path": "django/views/generic/list.py",
      "start_line": 1,
      "end_line": 47,
      "tokens": 333,
      "context_length": 14385
    },
    {
      "position": 39,
      "id": "/tmp/repos/django/django/db/models/query.py_QuerySet._chain_QuerySet._clone.9.1",
      "distance": 1.2438164949417114,
      "file_path": "django/db/models/query.py",
      "start_line": 1844,
      "end_line": 1872,
      "tokens": 205,
      "context_length": 14590
    },
    {
      "position": 40,
      "id": "/tmp/repos/django/django/db/models/query.py_QuerySet._combinator_query_QuerySet._combinator_query.clone.8.1",
      "distance": 1.2466421127319336,
      "file_path": "django/db/models/query.py",
      "start_line": 1474,
      "end_line": 1485,
      "tokens": 120,
      "context_length": 14710
    },
    {
      "position": 41,
      "id": "/tmp/repos/django/django/contrib/admin/utils.py_NestedObjects.related_objects_NestedObjects.can_fast_delete.2.1",
      "distance": 1.250349521636963,
      "file_path": "django/contrib/admin/utils.py",
      "start_line": 192,
      "end_line": 228,
      "tokens": 251,
      "context_length": 14961
    },
    {
      "position": 42,
      "id": "/tmp/repos/django/django/db/models/query.py_QuerySet.select_related_QuerySet.select_related.6.1",
      "distance": 1.256103754043579,
      "file_path": "django/db/models/query.py",
      "start_line": 1529,
      "end_line": 1551,
      "tokens": 158,
      "context_length": 15119
    },
    {
      "position": 43,
      "id": "/tmp/repos/django/django/views/generic/list.py_MultipleObjectMixin.get_paginate_by_MultipleObjectMixin.get_context_object_name.2.3.1.1",
      "distance": 1.2565577030181885,
      "file_path": "django/views/generic/list.py",
      "start_line": 81,
      "end_line": 120,
      "tokens": 278,
      "context_length": 15397
    },
    {
      "position": 44,
      "id": "/tmp/repos/django/django/db/models/query.py_QuerySet.order_by_QuerySet.reverse.5.1",
      "distance": 1.2569626569747925,
      "file_path": "django/db/models/query.py",
      "start_line": 1648,
      "end_line": 1693,
      "tokens": 340,
      "context_length": 15737
    },
    {
      "position": 45,
      "id": "/tmp/repos/django/django/db/models/query.py_QuerySet.annotate_QuerySet.alias.3.1",
      "distance": 1.2610419988632202,
      "file_path": "django/db/models/query.py",
      "start_line": 1578,
      "end_line": 1591,
      "tokens": 115,
      "context_length": 15852
    },
    {
      "position": 46,
      "id": "/tmp/repos/django/django/contrib/contenttypes/management/commands/remove_stale_contenttypes.py_Command.handle_",
      "distance": 1.2628307342529297,
      "file_path": "django/contrib/contenttypes/management/commands/remove_stale_contenttypes.py",
      "start_line": 34,
      "end_line": 111,
      "tokens": 598,
      "context_length": 16450
    },
    {
      "position": 47,
      "id": "/tmp/repos/django/django/db/models/query.py_QuerySet.__iter___QuerySet.__bool__.2.1",
      "distance": 1.2633473873138428,
      "file_path": "django/db/models/query.py",
      "start_line": 379,
      "end_line": 409,
      "tokens": 246,
      "context_length": 16696
    },
    {
      "position": 48,
      "id": "/tmp/repos/django/django/contrib/postgres/indexes.py_GistIndex_GistIndex.get_with_params.4.1",
      "distance": 1.2652928829193115,
      "file_path": "django/contrib/postgres/indexes.py",
      "start_line": 166,
      "end_line": 188,
      "tokens": 200,
      "context_length": 16896
    },
    {
      "position": 49,
      "id": "/tmp/repos/django/django/db/backends/postgresql/features.py_operator_",
      "distance": 1.267503023147583,
      "file_path": "django/db/backends/postgresql/features.py",
      "start_line": 1,
      "end_line": 103,
      "tokens": 792,
      "context_length": 17688
    },
    {
      "position": 50,
      "id": "/tmp/repos/django/django/db/models/deletion.py_Collector.related_objects_Collector.instances_with_model.1.1.1",
      "distance": 1.272999882698059,
      "file_path": "django/db/models/deletion.py",
      "start_line": 398,
      "end_line": 411,
      "tokens": 117,
      "context_length": 17805
    },
    {
      "position": 51,
      "id": "/tmp/repos/django/django/contrib/postgres/aggregates/general.py_ArrayAgg_ArrayAgg.output_field.1.1",
      "distance": 1.273322582244873,
      "file_path": "django/contrib/postgres/aggregates/general.py",
      "start_line": 41,
      "end_line": 57,
      "tokens": 164,
      "context_length": 17969
    },
    {
      "position": 52,
      "id": "/tmp/repos/django/django/db/models/query.py_RelatedPopulator.populate_",
      "distance": 1.2740886211395264,
      "file_path": "django/db/models/query.py",
      "start_line": 2604,
      "end_line": 2627,
      "tokens": 201,
      "context_length": 18170
    },
    {
      "position": 53,
      "id": "/tmp/repos/django/django/core/paginator.py_Page_",
      "distance": 1.2750627994537354,
      "file_path": "django/core/paginator.py",
      "start_line": 167,
      "end_line": 225,
      "tokens": 428,
      "context_length": 18598
    },
    {
      "position": 54,
      "id": "/tmp/repos/django/django/contrib/postgres/indexes.py_SpGistIndex_",
      "distance": 1.2763952016830444,
      "file_path": "django/contrib/postgres/indexes.py",
      "start_line": 211,
      "end_line": 243,
      "tokens": 233,
      "context_length": 18831
    },
    {
      "position": 55,
      "id": "/tmp/repos/django/django/db/models/base.py_Model._get_next_or_previous_in_order_Model._get_next_or_previous_in_order.3.1",
      "distance": 1.2782418727874756,
      "file_path": "django/db/models/base.py",
      "start_line": 1170,
      "end_line": 1191,
      "tokens": 196,
      "context_length": 19027
    },
    {
      "position": 56,
      "id": "/tmp/repos/django/django/contrib/gis/geos/mutable_list.py_ListMixin._checkindex_ListMixin._set_slice.8.2.1",
      "distance": 1.279438853263855,
      "file_path": "django/contrib/gis/geos/mutable_list.py",
      "start_line": 231,
      "end_line": 261,
      "tokens": 248,
      "context_length": 19275
    },
    {
      "position": 57,
      "id": "/tmp/repos/django/django/db/models/query.py_QuerySet.aget_QuerySet._prepare_for_bulk_create.1.2",
      "distance": 1.2794464826583862,
      "file_path": "django/db/models/query.py",
      "start_line": 661,
      "end_line": 682,
      "tokens": 179,
      "context_length": 19454
    },
    {
      "position": 58,
      "id": "/tmp/repos/django/django/db/models/base.py_36_",
      "distance": 1.2819896936416626,
      "file_path": "django/db/models/base.py",
      "start_line": 2450,
      "end_line": 2502,
      "tokens": 341,
      "context_length": 19795
    },
    {
      "position": 59,
      "id": "/tmp/repos/django/django/db/models/sql/query.py_Query.names_to_path.3_Query.names_to_path.4.1",
      "distance": 1.2829649448394775,
      "file_path": "django/db/models/sql/query.py",
      "start_line": 1656,
      "end_line": 1754,
      "tokens": 846,
      "context_length": 20641
    },
    {
      "position": 60,
      "id": "/tmp/repos/django/django/db/models/query.py_BaseIterable.3_BaseIterable.__aiter__.1.1",
      "distance": 1.2881373167037964,
      "file_path": "django/db/models/query.py",
      "start_line": 66,
      "end_line": 75,
      "tokens": 135,
      "context_length": 20776
    },
    {
      "position": 61,
      "id": "/tmp/repos/django/django/db/models/query.py_QuerySet.delete.alters_data_QuerySet._raw_delete.alters_data.1",
      "distance": 1.2884852886199951,
      "file_path": "django/db/models/query.py",
      "start_line": 1148,
      "end_line": 1170,
      "tokens": 156,
      "context_length": 20932
    },
    {
      "position": 62,
      "id": "/tmp/repos/django/django/db/models/query.py_QuerySet._check_bulk_create_options_QuerySet._check_bulk_create_options.4.1",
      "distance": 1.2885277271270752,
      "file_path": "django/db/models/query.py",
      "start_line": 684,
      "end_line": 743,
      "tokens": 479,
      "context_length": 21411
    },
    {
      "position": 63,
      "id": "/tmp/repos/django/django/utils/functional.py_lazy.__proxy__.__promise___lazy.4.1",
      "distance": 1.2907586097717285,
      "file_path": "django/utils/functional.py",
      "start_line": 143,
      "end_line": 212,
      "tokens": 520,
      "context_length": 21931
    },
    {
      "position": 64,
      "id": "/tmp/repos/django/django/db/models/query.py_QuerySet.bulk_create.27_QuerySet.abulk_create.1.1",
      "distance": 1.291025161743164,
      "file_path": "django/db/models/query.py",
      "start_line": 795,
      "end_line": 853,
      "tokens": 499,
      "context_length": 22430
    },
    {
      "position": 65,
      "id": "/tmp/repos/django/django/db/models/sql/subqueries.py_1_DeleteQuery.delete_batch.6.1",
      "distance": 1.292797565460205,
      "file_path": "django/db/models/sql/subqueries.py",
      "start_line": 1,
      "end_line": 45,
      "tokens": 311,
      "context_length": 22741
    },
    {
      "position": 66,
      "id": "/tmp/repos/django/django/db/models/query.py_QuerySet.ain_bulk_QuerySet.delete.20.1",
      "distance": 1.2930738925933838,
      "file_path": "django/db/models/query.py",
      "start_line": 1112,
      "end_line": 1146,
      "tokens": 306,
      "context_length": 23047
    },
    {
      "position": 67,
      "id": "/tmp/repos/django/django/contrib/gis/geos/mutable_list.py_ListMixin._assign_simple_slice_",
      "distance": 1.293816089630127,
      "file_path": "django/contrib/gis/geos/mutable_list.py",
      "start_line": 299,
      "end_line": 315,
      "tokens": 133,
      "context_length": 23180
    },
    {
      "position": 68,
      "id": "/tmp/repos/django/django/contrib/gis/geos/mutable_list.py_ListMixin._assign_extended_slice_ListMixin._assign_extended_slice.5.1",
      "distance": 1.2943214178085327,
      "file_path": "django/contrib/gis/geos/mutable_list.py",
      "start_line": 286,
      "end_line": 297,
      "tokens": 134,
      "context_length": 23314
    },
    {
      "position": 69,
      "id": "/tmp/repos/django/django/contrib/gis/geos/mutable_list.py_ListMixin._assign_extended_slice_rebuild_ListMixin._assign_extended_slice_rebuild.9",
      "distance": 1.295508861541748,
      "file_path": "django/contrib/gis/geos/mutable_list.py",
      "start_line": 263,
      "end_line": 284,
      "tokens": 191,
      "context_length": 23505
    },
    {
      "position": 70,
      "id": "/tmp/repos/django/django/db/models/query.py_QuerySet.select_for_update_QuerySet.select_for_update.10.1",
      "distance": 1.2955210208892822,
      "file_path": "django/db/models/query.py",
      "start_line": 1513,
      "end_line": 1527,
      "tokens": 145,
      "context_length": 23650
    },
    {
      "position": 71,
      "id": "/tmp/repos/django/django/db/models/query.py_QuerySet.dates_QuerySet.93",
      "distance": 1.3003400564193726,
      "file_path": "django/db/models/query.py",
      "start_line": 1349,
      "end_line": 1370,
      "tokens": 219,
      "context_length": 23869
    },
    {
      "position": 72,
      "id": "/tmp/repos/django/django/db/models/sql/query.py_Query.bump_prefix.3_Query.bump_prefix.13",
      "distance": 1.3004392385482788,
      "file_path": "django/db/models/sql/query.py",
      "start_line": 976,
      "end_line": 1003,
      "tokens": 272,
      "context_length": 24141
    },
    {
      "position": 73,
      "id": "/tmp/repos/django/django/db/models/query.py_QuerySet.get_QuerySet.get.10",
      "distance": 1.3015762567520142,
      "file_path": "django/db/models/query.py",
      "start_line": 626,
      "end_line": 659,
      "tokens": 293,
      "context_length": 24434
    },
    {
      "position": 74,
      "id": "/tmp/repos/django/django/db/models/query.py_1_REPR_OUTPUT_SIZE.1",
      "distance": 1.302228331565857,
      "file_path": "django/db/models/query.py",
      "start_line": 1,
      "end_line": 39,
      "tokens": 274,
      "context_length": 24708
    },
    {
      "position": 75,
      "id": "/tmp/repos/django/django/db/models/query.py_QuerySet.__xor___QuerySet.__xor__.10.1",
      "distance": 1.302994966506958,
      "file_path": "django/db/models/query.py",
      "start_line": 482,
      "end_line": 499,
      "tokens": 146,
      "context_length": 24854
    },
    {
      "position": 76,
      "id": "/tmp/repos/django/django/contrib/postgres/aggregates/mixins.py_1_",
      "distance": 1.3043475151062012,
      "file_path": "django/contrib/postgres/aggregates/mixins.py",
      "start_line": 1,
      "end_line": 27,
      "tokens": 238,
      "context_length": 25092
    },
    {
      "position": 77,
      "id": "/tmp/repos/django/django/db/models/query.py_QuerySet.aget_or_create_QuerySet.update_or_create.5.1",
      "distance": 1.3044559955596924,
      "file_path": "django/db/models/query.py",
      "start_line": 943,
      "end_line": 967,
      "tokens": 215,
      "context_length": 25307
    },
    {
      "position": 78,
      "id": "/tmp/repos/django/django/core/cache/backends/base.py_BaseCache.get_many_BaseCache.aget_many.4.1",
      "distance": 1.3045893907546997,
      "file_path": "django/core/cache/backends/base.py",
      "start_line": 192,
      "end_line": 214,
      "tokens": 199,
      "context_length": 25506
    },
    {
      "position": 79,
      "id": "/tmp/repos/django/django/contrib/postgres/indexes.py_HashIndex_HashIndex.get_with_params.3.1",
      "distance": 1.3050563335418701,
      "file_path": "django/contrib/postgres/indexes.py",
      "start_line": 191,
      "end_line": 208,
      "tokens": 137,
      "context_length": 25643
    },
    {
      "position": 80,
      "id": "/tmp/repos/django/django/db/models/sql/query.py_Query.has_results_Query.explain.5.1",
      "distance": 1.3061339855194092,
      "file_path": "django/db/models/sql/query.py",
      "start_line": 589,
      "end_line": 604,
      "tokens": 136,
      "context_length": 25779
    },
    {
      "position": 81,
      "id": "/tmp/repos/django/django/db/models/query.py_QuerySet.aaggregate_QuerySet.acount.1.1",
      "distance": 1.308018684387207,
      "file_path": "django/db/models/query.py",
      "start_line": 607,
      "end_line": 624,
      "tokens": 131,
      "context_length": 25910
    },
    {
      "position": 82,
      "id": "/tmp/repos/django/django/db/models/sql/query.py_Query.deferred_to_data_Query.deferred_to_data.8.6.6.1",
      "distance": 1.3083947896957397,
      "file_path": "django/db/models/sql/query.py",
      "start_line": 721,
      "end_line": 803,
      "tokens": 845,
      "context_length": 26755
    },
    {
      "position": 83,
      "id": "/tmp/repos/django/django/db/models/sql/query.py_Query.add_filtered_relation_Query.add_filtered_relation.6",
      "distance": 1.309011697769165,
      "file_path": "django/db/models/sql/query.py",
      "start_line": 1609,
      "end_line": 1638,
      "tokens": 287,
      "context_length": 27042
    },
    {
      "position": 84,
      "id": "/tmp/repos/django/django/http/request.py_QueryDict.setlist_QueryDict.copy.2.1",
      "distance": 1.3102411031723022,
      "file_path": "django/http/request.py",
      "start_line": 548,
      "end_line": 584,
      "tokens": 285,
      "context_length": 27327
    },
    {
      "position": 85,
      "id": "/tmp/repos/django/django/middleware/cache.py_FetchFromCacheMiddleware_FetchFromCacheMiddleware.cache.1.1",
      "distance": 1.3121196031570435,
      "file_path": "django/middleware/cache.py",
      "start_line": 130,
      "end_line": 146,
      "tokens": 132,
      "context_length": 27459
    },
    {
      "position": 86,
      "id": "/tmp/repos/django/django/middleware/cache.py_FetchFromCacheMiddleware.process_request_FetchFromCacheMiddleware.process_request.12.1",
      "distance": 1.3123888969421387,
      "file_path": "django/middleware/cache.py",
      "start_line": 148,
      "end_line": 176,
      "tokens": 256,
      "context_length": 27715
    },
    {
      "position": 87,
      "id": "/tmp/repos/django/django/db/models/sql/query.py_Query.check_related_objects_Query.check_filterable.3.1.1",
      "distance": 1.312434434890747,
      "file_path": "django/db/models/sql/query.py",
      "start_line": 1241,
      "end_line": 1275,
      "tokens": 339,
      "context_length": 28054
    },
    {
      "position": 88,
      "id": "/tmp/repos/django/django/contrib/postgres/fields/array.py_ArrayContains_",
      "distance": 1.3154778480529785,
      "file_path": "django/contrib/postgres/fields/array.py",
      "start_line": 260,
      "end_line": 353,
      "tokens": 599,
      "context_length": 28653
    },
    {
      "position": 89,
      "id": "/tmp/repos/django/django/db/backends/postgresql/operations.py_DatabaseOperations.explain_query_prefix_DatabaseOperations.explain_query_prefix.7.1",
      "distance": 1.3163871765136719,
      "file_path": "django/db/backends/postgresql/operations.py",
      "start_line": 319,
      "end_line": 336,
      "tokens": 153,
      "context_length": 28806
    },
    {
      "position": 90,
      "id": "/tmp/repos/django/django/db/models/sql/compiler.py_SQLCompiler.ordering_parts.get_related_selections.13_SQLCompiler.ordering_parts.get_related_selections.14.1",
      "distance": 1.3175616264343262,
      "file_path": "django/db/models/sql/compiler.py",
      "start_line": 1167,
      "end_line": 1272,
      "tokens": 871,
      "context_length": 29677
    },
    {
      "position": 91,
      "id": "/tmp/repos/django/django/db/models/query_utils.py_DeferredAttribute_DeferredAttribute._check_parent_chain.5.1",
      "distance": 1.3189542293548584,
      "file_path": "django/db/models/query_utils.py",
      "start_line": 150,
      "end_line": 188,
      "tokens": 300,
      "context_length": 29977
    },
    {
      "position": 92,
      "id": "/tmp/repos/django/django/db/models/deletion.py_Collector.can_fast_delete_Collector.can_fast_delete.8.1",
      "distance": 1.319429636001587,
      "file_path": "django/db/models/deletion.py",
      "start_line": 183,
      "end_line": 225,
      "tokens": 337,
      "context_length": 30314
    },
    {
      "position": 93,
      "id": "/tmp/repos/django/django/db/models/manager.py_Manager_",
      "distance": 1.3198251724243164,
      "file_path": "django/db/models/manager.py",
      "start_line": 176,
      "end_line": 214,
      "tokens": 207,
      "context_length": 30521
    },
    {
      "position": 94,
      "id": "/tmp/repos/django/django/db/models/sql/query.py_Query.add_filter_Query.clear_where.self.where.1",
      "distance": 1.320940613746643,
      "file_path": "django/db/models/sql/query.py",
      "start_line": 1518,
      "end_line": 1544,
      "tokens": 263,
      "context_length": 30784
    },
    {
      "position": 95,
      "id": "/tmp/repos/django/django/db/models/query.py_QuerySet.complex_filter_QuerySet.complex_filter.2.4.1.1",
      "distance": 1.321498155593872,
      "file_path": "django/db/models/query.py",
      "start_line": 1457,
      "end_line": 1472,
      "tokens": 124,
      "context_length": 30908
    },
    {
      "position": 96,
      "id": "/tmp/repos/django/django/contrib/postgres/aggregates/general.py_BitAnd_JSONBAgg.deprecation_msg.1",
      "distance": 1.321779489517212,
      "file_path": "django/contrib/postgres/aggregates/general.py",
      "start_line": 60,
      "end_line": 95,
      "tokens": 233,
      "context_length": 31141
    },
    {
      "position": 97,
      "id": "/tmp/repos/django/django/db/models/sql/compiler.py_SQLCompiler.ordering_parts.get_related_selections_SQLCompiler.ordering_parts.get_related_selections.12.14",
      "distance": 1.3221304416656494,
      "file_path": "django/db/models/sql/compiler.py",
      "start_line": 1063,
      "end_line": 1165,
      "tokens": 747,
      "context_length": 31888
    },
    {
      "position": 98,
      "id": "/tmp/repos/django/django/utils/cache.py_get_conditional_response_get_conditional_response.2.19.1",
      "distance": 1.3221876621246338,
      "file_path": "django/utils/cache.py",
      "start_line": 165,
      "end_line": 210,
      "tokens": 459,
      "context_length": 32347
    },
    {
      "position": 99,
      "id": "/tmp/repos/django/django/views/generic/list.py_BaseListView_BaseListView.get.5.1",
      "distance": 1.3238754272460938,
      "file_path": "django/views/generic/list.py",
      "start_line": 150,
      "end_line": 175,
      "tokens": 205,
      "context_length": 32552
    },
    {
      "position": 100,
      "id": "/tmp/repos/django/django/views/generic/dates.py_YearArchiveView_MonthArchiveView.template_name_suffix.1",
      "distance": 1.3246954679489136,
      "file_path": "django/views/generic/dates.py",
      "start_line": 459,
      "end_line": 504,
      "tokens": 304,
      "context_length": 32856
    },
    {
      "position": 101,
      "id": "/tmp/repos/django/django/db/models/sql/subqueries.py_InsertQuery_",
      "distance": 1.3258111476898193,
      "file_path": "django/db/models/sql/subqueries.py",
      "start_line": 142,
      "end_line": 172,
      "tokens": 190,
      "context_length": 33046
    },
    {
      "position": 102,
      "id": "/tmp/repos/django/django/db/models/sql/query.py_Query.build_filter.18_Query.build_filter.30.1",
      "distance": 1.3260637521743774,
      "file_path": "django/db/models/sql/query.py",
      "start_line": 1435,
      "end_line": 1516,
      "tokens": 813,
      "context_length": 33859
    },
    {
      "position": 103,
      "id": "/tmp/repos/django/django/contrib/gis/geos/mutable_list.py_ListMixin.__delitem___ListMixin.__delitem__.8",
      "distance": 1.3264484405517578,
      "file_path": "django/contrib/gis/geos/mutable_list.py",
      "start_line": 82,
      "end_line": 100,
      "tokens": 161,
      "context_length": 34020
    },
    {
      "position": 104,
      "id": "/tmp/repos/django/django/db/models/sql/query.py_Query.set_group_by_Query.add_select_related.self.select_related.1",
      "distance": 1.3271909952163696,
      "file_path": "django/db/models/sql/query.py",
      "start_line": 2236,
      "end_line": 2280,
      "tokens": 355,
      "context_length": 34375
    },
    {
      "position": 105,
      "id": "/tmp/repos/django/django/db/models/fields/related.py_RelatedField._check_related_query_name_is_valid_RelatedField._check_related_query_name_is_valid.6.1",
      "distance": 1.327394962310791,
      "file_path": "django/db/models/fields/related.py",
      "start_line": 154,
      "end_line": 185,
      "tokens": 209,
      "context_length": 34584
    },
    {
      "position": 106,
      "id": "/tmp/repos/django/django/contrib/postgres/search.py_SearchQuery_SearchQuery.__str__.2.1",
      "distance": 1.328904628753662,
      "file_path": "django/contrib/postgres/search.py",
      "start_line": 182,
      "end_line": 225,
      "tokens": 322,
      "context_length": 34906
    },
    {
      "position": 107,
      "id": "/tmp/repos/django/django/utils/functional.py_lazy.__proxy__.__prepare_class___lazy.__proxy__.__prepare_class__.5.2.cls.__bytes__.1",
      "distance": 1.329148530960083,
      "file_path": "django/utils/functional.py",
      "start_line": 121,
      "end_line": 141,
      "tokens": 211,
      "context_length": 35117
    },
    {
      "position": 108,
      "id": "/tmp/repos/django/django/contrib/admin/options.py_ModelAdmin._get_list_editable_queryset_ModelAdmin._get_list_editable_queryset.6.1",
      "distance": 1.3308420181274414,
      "file_path": "django/contrib/admin/options.py",
      "start_line": 1897,
      "end_line": 1911,
      "tokens": 132,
      "context_length": 35249
    },
    {
      "position": 109,
      "id": "/tmp/repos/django/django/views/generic/dates.py_BaseWeekArchiveView_BaseWeekArchiveView.get_dated_items.15.1",
      "distance": 1.3332500457763672,
      "file_path": "django/views/generic/dates.py",
      "start_line": 507,
      "end_line": 556,
      "tokens": 370,
      "context_length": 35619
    },
    {
      "position": 110,
      "id": "/tmp/repos/django/django/db/models/sql/query.py_Query.get_count_Query.exists.7.1",
      "distance": 1.3336265087127686,
      "file_path": "django/db/models/sql/query.py",
      "start_line": 553,
      "end_line": 587,
      "tokens": 286,
      "context_length": 35905
    },
    {
      "position": 111,
      "id": "/tmp/repos/django/django/db/models/sql/query.py_Query.clear_limits_Query.add_distinct_fields.self.distinct.1",
      "distance": 1.333901286125183,
      "file_path": "django/db/models/sql/query.py",
      "start_line": 2081,
      "end_line": 2130,
      "tokens": 332,
      "context_length": 36237
    },
    {
      "position": 112,
      "id": "/tmp/repos/django/django/db/models/query.py_QuerySet._update.alters_data_QuerySet.contains.7.1",
      "distance": 1.3345754146575928,
      "file_path": "django/db/models/query.py",
      "start_line": 1227,
      "end_line": 1260,
      "tokens": 252,
      "context_length": 36489
    },
    {
      "position": 113,
      "id": "/tmp/repos/django/django/db/backends/postgresql/base.py_DatabaseWrapper.chunked_cursor_DatabaseWrapper.chunked_cursor.11.1",
      "distance": 1.3350088596343994,
      "file_path": "django/db/backends/postgresql/base.py",
      "start_line": 276,
      "end_line": 302,
      "tokens": 228,
      "context_length": 36717
    },
    {
      "position": 114,
      "id": "/tmp/repos/django/django/db/models/query.py_QuerySet.bulk_update.alters_data_QuerySet.get_or_create.5.2.3.2.2",
      "distance": 1.3360393047332764,
      "file_path": "django/db/models/query.py",
      "start_line": 907,
      "end_line": 941,
      "tokens": 256,
      "context_length": 36973
    },
    {
      "position": 115,
      "id": "/tmp/repos/django/django/db/models/deletion.py_Collector.collect.15_Collector.collect.15.3.3.3.1",
      "distance": 1.3366196155548096,
      "file_path": "django/db/models/deletion.py",
      "start_line": 372,
      "end_line": 396,
      "tokens": 273,
      "context_length": 37246
    },
    {
      "position": 116,
      "id": "/tmp/repos/django/django/db/models/query.py_QuerySet._earliest_QuerySet._earliest.8.1",
      "distance": 1.3369011878967285,
      "file_path": "django/db/models/query.py",
      "start_line": 1002,
      "end_line": 1022,
      "tokens": 175,
      "context_length": 37421
    },
    {
      "position": 117,
      "id": "/tmp/repos/django/django/db/models/fields/related_lookups.py_RelatedLookupMixin.as_sql_",
      "distance": 1.3376781940460205,
      "file_path": "django/db/models/fields/related_lookups.py",
      "start_line": 171,
      "end_line": 211,
      "tokens": 250,
      "context_length": 37671
    },
    {
      "position": 118,
      "id": "/tmp/repos/django/django/db/models/base.py_Model._get_next_or_previous_by_FIELD_Model._get_next_or_previous_by_FIELD.8.2.1",
      "distance": 1.3376975059509277,
      "file_path": "django/db/models/base.py",
      "start_line": 1149,
      "end_line": 1168,
      "tokens": 228,
      "context_length": 37899
    },
    {
      "position": 119,
      "id": "/tmp/repos/django/django/db/models/fields/reverse_related.py_ForeignObjectRel.get_choices_ForeignObjectRel.get_choices.5.1",
      "distance": 1.3377448320388794,
      "file_path": "django/db/models/fields/reverse_related.py",
      "start_line": 165,
      "end_line": 183,
      "tokens": 160,
      "context_length": 38059
    },
    {
      "position": 120,
      "id": "/tmp/repos/django/django/db/models/query.py_QuerySet.intersection_QuerySet.difference.2.2.1",
      "distance": 1.3381023406982422,
      "file_path": "django/db/models/query.py",
      "start_line": 1498,
      "end_line": 1511,
      "tokens": 126,
      "context_length": 38185
    },
    {
      "position": 121,
      "id": "/tmp/repos/django/django/db/models/sql/where.py_SubqueryConstraint_",
      "distance": 1.3382837772369385,
      "file_path": "django/db/models/sql/where.py",
      "start_line": 325,
      "end_line": 343,
      "tokens": 149,
      "context_length": 38334
    },
    {
      "position": 122,
      "id": "/tmp/repos/django/django/db/models/query.py_QuerySet.union_QuerySet.union.2.5.1",
      "distance": 1.3383820056915283,
      "file_path": "django/db/models/query.py",
      "start_line": 1487,
      "end_line": 1496,
      "tokens": 126,
      "context_length": 38460
    },
    {
      "position": 123,
      "id": "/tmp/repos/django/django/contrib/admin/views/main.py_ChangeList.apply_select_related_",
      "distance": 1.339247465133667,
      "file_path": "django/contrib/admin/views/main.py",
      "start_line": 554,
      "end_line": 586,
      "tokens": 227,
      "context_length": 38687
    }
  ],
  "files": [
    {
      "file_path": "django/db/models/query.py",
      "position": 1,
      "tokens": 20450,
      "context_length": 20450
    },
    {
      "file_path": "django/contrib/contenttypes/fields.py",
      "position": 2,
      "tokens": 5631,
      "context_length": 26081
    },
    {
      "file_path": "django/db/models/fields/related_descriptors.py",
      "position": 3,
      "tokens": 11071,
      "context_length": 37152
    },
    {
      "file_path": "django/db/models/__init__.py",
      "position": 4,
      "tokens": 682,
      "context_length": 37834
    },
    {
      "file_path": "django/views/generic/list.py",
      "position": 5,
      "tokens": 1602,
      "context_length": 39436
    },
    {
      "file_path": "django/contrib/postgres/indexes.py",
      "position": 6,
      "tokens": 1856,
      "context_length": 41292
    },
    {
      "file_path": "django/views/generic/dates.py",
      "position": 7,
      "tokens": 5510,
      "context_length": 46802
    },
    {
      "file_path": "django/views/generic/detail.py",
      "position": 8,
      "tokens": 1330,
      "context_length": 48132
    },
    {
      "file_path": "django/core/paginator.py",
      "position": 9,
      "tokens": 1692,
      "context_length": 49824
    },
    {
      "file_path": "django/db/backends/mysql/features.py",
      "position": 10,
      "tokens": 2371,
      "context_length": 52195
    },
    {
      "file_path": "django/db/backends/sqlite3/features.py",
      "position": 11,
      "tokens": 1247,
      "context_length": 53442
    },
    {
      "file_path": "django/contrib/admin/utils.py",
      "position": 12,
      "tokens": 4206,
      "context_length": 57648
    },
    {
      "file_path": "django/contrib/contenttypes/management/commands/remove_stale_contenttypes.py",
      "position": 13,
      "tokens": 788,
      "context_length": 58436
    },
    {
      "file_path": "django/db/backends/postgresql/features.py",
      "position": 14,
      "tokens": 792,
      "context_length": 59228
    },
    {
      "file_path": "django/db/models/deletion.py",
      "position": 15,
      "tokens": 3932,
      "context_length": 63160
    },
    {
      "file_path": "django/contrib/postgres/aggregates/general.py",
      "position": 16,
      "tokens": 820,
      "context_length": 63980
    },
    {
      "file_path": "django/db/models/base.py",
      "position": 17,
      "tokens": 18551,
      "context_length": 82531
    },
    {
      "file_path": "django/contrib/gis/geos/mutable_list.py",
      "position": 18,
      "tokens": 2263,
      "context_length": 84794
    },
    {
      "file_path": "django/db/models/sql/query.py",
      "position": 19,
      "tokens": 23171,
      "context_length": 107965
    },
    {
      "file_path": "django/utils/functional.py",
      "position": 20,
      "tokens": 3283,
      "context_length": 111248
    },
    {
      "file_path": "django/db/models/sql/subqueries.py",
      "position": 21,
      "tokens": 1228,
      "context_length": 112476
    },
    {
      "file_path": "django/contrib/postgres/aggregates/mixins.py",
      "position": 22,
      "tokens": 238,
      "context_length": 112714
    },
    {
      "file_path": "django/core/cache/backends/base.py",
      "position": 23,
      "tokens": 3108,
      "context_length": 115822
    },
    {
      "file_path": "django/http/request.py",
      "position": 24,
      "tokens": 5299,
      "context_length": 121121
    },
    {
      "file_path": "django/middleware/cache.py",
      "position": 25,
      "tokens": 1612,
      "context_length": 122733
    },
    {
      "file_path": "django/contrib/postgres/fields/array.py",
      "position": 26,
      "tokens": 2373,
      "context_length": 125106
    },
    {
      "file_path": "django/db/backends/postgresql/operations.py",
      "position": 27,
      "tokens": 2989,
      "context_length": 128095
    },
    {
      "file_path": "django/db/models/sql/compiler.py",
      "position": 28,
      "tokens": 16153,
      "context_length": 144248
    },
    {
      "file_path": "django/db/models/query_utils.py",
      "position": 29,
      "tokens": 2793,
      "context_length": 147041
    },
    {
      "file_path": "django/db/models/manager.py",
      "position": 30,
      "tokens": 1448,
      "context_length": 148489
    },
    {
      "file_path": "django/utils/cache.py",
      "position": 31,
      "tokens": 3793,
      "context_length": 152282
    },
    {
      "file_path": "django/db/models/fields/related.py",
      "position": 32,
      "tokens": 14609,
      "context_length": 166891
    },
    {
      "file_path": "django/contrib/postgres/search.py",
      "position": 33,
      "tokens": 2469,
      "context_length": 169360
    },
    {
      "file_path": "django/contrib/admin/options.py",
      "position": 34,
      "tokens": 19220,
      "context_length": 188580
    },
    {
      "file_path": "django/db/backends/postgresql/base.py",
      "position": 35,
      "tokens": 3060,
      "context_length": 191640
    },
    {
      "file_path": "django/db/models/fields/related_lookups.py",
      "position": 36,
      "tokens": 1610,
      "context_length": 193250
    },
    {
      "file_path": "django/db/models/fields/reverse_related.py",
      "position": 37,
      "tokens": 2532,
      "context_length": 195782
    },
    {
      "file_path": "django/db/models/sql/where.py",
      "position": 38,
      "tokens": 2511,
      "context_length": 198293
    },
    {
      "file_path": "django/contrib/admin/views/main.py",
      "position": 39,
      "tokens": 4531,
      "context_length": 202824
    }
  ]
}