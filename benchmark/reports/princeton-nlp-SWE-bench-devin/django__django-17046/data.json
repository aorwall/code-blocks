{
  "instance_id": "django__django-17046",
  "model_patch": "diff --git a/django/contrib/admin/options.py b/django/contrib/admin/options.py\nindex b0635669e9..562af21f52 100644\n--- a/django/contrib/admin/options.py\n+++ b/django/contrib/admin/options.py\n@@ -1178,6 +1178,12 @@ class ModelAdmin(BaseModelAdmin):\n                 lookup_spawns_duplicates(self.opts, search_spec)\n                 for search_spec in orm_lookups\n             )\n+\n+            # Check if the 'action' parameter is 'delete_selected' in the request POST data\n+            if 'action' in request.POST and request.POST['action'] == 'delete_selected':\n+                # Remove 'distinct()' if it has been applied\n+                queryset = queryset.distinct(False)\n+\n         return queryset, may_have_duplicates\n \n     def get_preserved_filters(self, request):\n",
  "model_name_or_path": "Devin",
  "pass_or_fail": "fail",
  "model_patch_files": [
    "django/contrib/admin/options.py"
  ],
  "repo": "django/django",
  "base_commit": "95cdf9dc6627135f3893095892816eb3f2785e2e",
  "patch": "diff --git a/django/contrib/admin/views/main.py b/django/contrib/admin/views/main.py\n--- a/django/contrib/admin/views/main.py\n+++ b/django/contrib/admin/views/main.py\n@@ -29,7 +29,7 @@\n     SuspiciousOperation,\n )\n from django.core.paginator import InvalidPage\n-from django.db.models import Exists, F, Field, ManyToOneRel, OrderBy, OuterRef\n+from django.db.models import F, Field, ManyToOneRel, OrderBy\n from django.db.models.expressions import Combinable\n from django.urls import reverse\n from django.utils.deprecation import RemovedInDjango60Warning\n@@ -566,6 +566,13 @@ def get_queryset(self, request, exclude_parameters=None):\n             # ValueError, ValidationError, or ?.\n             raise IncorrectLookupParameters(e)\n \n+        if not qs.query.select_related:\n+            qs = self.apply_select_related(qs)\n+\n+        # Set ordering.\n+        ordering = self.get_ordering(request, qs)\n+        qs = qs.order_by(*ordering)\n+\n         # Apply search results\n         qs, search_may_have_duplicates = self.model_admin.get_search_results(\n             request,\n@@ -580,17 +587,9 @@ def get_queryset(self, request, exclude_parameters=None):\n         )\n         # Remove duplicates from results, if necessary\n         if filters_may_have_duplicates | search_may_have_duplicates:\n-            qs = qs.filter(pk=OuterRef(\"pk\"))\n-            qs = self.root_queryset.filter(Exists(qs))\n-\n-        # Set ordering.\n-        ordering = self.get_ordering(request, qs)\n-        qs = qs.order_by(*ordering)\n-\n-        if not qs.query.select_related:\n-            qs = self.apply_select_related(qs)\n-\n-        return qs\n+            return qs.distinct()\n+        else:\n+            return qs\n \n     def apply_select_related(self, qs):\n         if self.list_select_related is True:\ndiff --git a/django/db/models/query.py b/django/db/models/query.py\n--- a/django/db/models/query.py\n+++ b/django/db/models/query.py\n@@ -1135,8 +1135,8 @@ def delete(self):\n         self._not_support_combined_queries(\"delete\")\n         if self.query.is_sliced:\n             raise TypeError(\"Cannot use 'limit' or 'offset' with delete().\")\n-        if self.query.distinct or self.query.distinct_fields:\n-            raise TypeError(\"Cannot call delete() after .distinct().\")\n+        if self.query.distinct_fields:\n+            raise TypeError(\"Cannot call delete() after .distinct(*fields).\")\n         if self._fields is not None:\n             raise TypeError(\"Cannot call delete() after .values() or .values_list()\")\n \n",
  "test_patch": "diff --git a/tests/admin_changelist/tests.py b/tests/admin_changelist/tests.py\n--- a/tests/admin_changelist/tests.py\n+++ b/tests/admin_changelist/tests.py\n@@ -467,7 +467,7 @@ def test_custom_paginator(self):\n         cl.get_results(request)\n         self.assertIsInstance(cl.paginator, CustomPaginator)\n \n-    def test_no_duplicates_for_m2m_in_list_filter(self):\n+    def test_distinct_for_m2m_in_list_filter(self):\n         \"\"\"\n         Regression test for #13902: When using a ManyToMany in list_filter,\n         results shouldn't appear more than once. Basic ManyToMany.\n@@ -488,11 +488,10 @@ def test_no_duplicates_for_m2m_in_list_filter(self):\n         # There's only one Group instance\n         self.assertEqual(cl.result_count, 1)\n         # Queryset must be deletable.\n-        self.assertIs(cl.queryset.query.distinct, False)\n         cl.queryset.delete()\n         self.assertEqual(cl.queryset.count(), 0)\n \n-    def test_no_duplicates_for_through_m2m_in_list_filter(self):\n+    def test_distinct_for_through_m2m_in_list_filter(self):\n         \"\"\"\n         Regression test for #13902: When using a ManyToMany in list_filter,\n         results shouldn't appear more than once. With an intermediate model.\n@@ -512,14 +511,14 @@ def test_no_duplicates_for_through_m2m_in_list_filter(self):\n         # There's only one Group instance\n         self.assertEqual(cl.result_count, 1)\n         # Queryset must be deletable.\n-        self.assertIs(cl.queryset.query.distinct, False)\n         cl.queryset.delete()\n         self.assertEqual(cl.queryset.count(), 0)\n \n-    def test_no_duplicates_for_through_m2m_at_second_level_in_list_filter(self):\n+    def test_distinct_for_through_m2m_at_second_level_in_list_filter(self):\n         \"\"\"\n         When using a ManyToMany in list_filter at the second level behind a\n-        ForeignKey, results shouldn't appear more than once.\n+        ForeignKey, distinct() must be called and results shouldn't appear more\n+        than once.\n         \"\"\"\n         lead = Musician.objects.create(name=\"Vox\")\n         band = Group.objects.create(name=\"The Hype\")\n@@ -537,11 +536,10 @@ def test_no_duplicates_for_through_m2m_at_second_level_in_list_filter(self):\n         # There's only one Concert instance\n         self.assertEqual(cl.result_count, 1)\n         # Queryset must be deletable.\n-        self.assertIs(cl.queryset.query.distinct, False)\n         cl.queryset.delete()\n         self.assertEqual(cl.queryset.count(), 0)\n \n-    def test_no_duplicates_for_inherited_m2m_in_list_filter(self):\n+    def test_distinct_for_inherited_m2m_in_list_filter(self):\n         \"\"\"\n         Regression test for #13902: When using a ManyToMany in list_filter,\n         results shouldn't appear more than once. Model managed in the\n@@ -562,11 +560,10 @@ def test_no_duplicates_for_inherited_m2m_in_list_filter(self):\n         # There's only one Quartet instance\n         self.assertEqual(cl.result_count, 1)\n         # Queryset must be deletable.\n-        self.assertIs(cl.queryset.query.distinct, False)\n         cl.queryset.delete()\n         self.assertEqual(cl.queryset.count(), 0)\n \n-    def test_no_duplicates_for_m2m_to_inherited_in_list_filter(self):\n+    def test_distinct_for_m2m_to_inherited_in_list_filter(self):\n         \"\"\"\n         Regression test for #13902: When using a ManyToMany in list_filter,\n         results shouldn't appear more than once. Target of the relationship\n@@ -586,15 +583,11 @@ def test_no_duplicates_for_m2m_to_inherited_in_list_filter(self):\n \n         # There's only one ChordsBand instance\n         self.assertEqual(cl.result_count, 1)\n-        # Queryset must be deletable.\n-        self.assertIs(cl.queryset.query.distinct, False)\n-        cl.queryset.delete()\n-        self.assertEqual(cl.queryset.count(), 0)\n \n-    def test_no_duplicates_for_non_unique_related_object_in_list_filter(self):\n+    def test_distinct_for_non_unique_related_object_in_list_filter(self):\n         \"\"\"\n-        Regressions tests for #15819: If a field listed in list_filters is a\n-        non-unique related object, results shouldn't appear more than once.\n+        Regressions tests for #15819: If a field listed in list_filters\n+        is a non-unique related object, distinct() must be called.\n         \"\"\"\n         parent = Parent.objects.create(name=\"Mary\")\n         # Two children with the same name\n@@ -606,10 +599,9 @@ def test_no_duplicates_for_non_unique_related_object_in_list_filter(self):\n         request.user = self.superuser\n \n         cl = m.get_changelist_instance(request)\n-        # Exists() is applied.\n+        # Make sure distinct() was called\n         self.assertEqual(cl.queryset.count(), 1)\n         # Queryset must be deletable.\n-        self.assertIs(cl.queryset.query.distinct, False)\n         cl.queryset.delete()\n         self.assertEqual(cl.queryset.count(), 0)\n \n@@ -629,10 +621,10 @@ def test_changelist_search_form_validation(self):\n                 self.assertEqual(1, len(messages))\n                 self.assertEqual(error, messages[0])\n \n-    def test_no_duplicates_for_non_unique_related_object_in_search_fields(self):\n+    def test_distinct_for_non_unique_related_object_in_search_fields(self):\n         \"\"\"\n         Regressions tests for #15819: If a field listed in search_fields\n-        is a non-unique related object, Exists() must be applied.\n+        is a non-unique related object, distinct() must be called.\n         \"\"\"\n         parent = Parent.objects.create(name=\"Mary\")\n         Child.objects.create(parent=parent, name=\"Danielle\")\n@@ -643,17 +635,16 @@ def test_no_duplicates_for_non_unique_related_object_in_search_fields(self):\n         request.user = self.superuser\n \n         cl = m.get_changelist_instance(request)\n-        # Exists() is applied.\n+        # Make sure distinct() was called\n         self.assertEqual(cl.queryset.count(), 1)\n         # Queryset must be deletable.\n-        self.assertIs(cl.queryset.query.distinct, False)\n         cl.queryset.delete()\n         self.assertEqual(cl.queryset.count(), 0)\n \n-    def test_no_duplicates_for_many_to_many_at_second_level_in_search_fields(self):\n+    def test_distinct_for_many_to_many_at_second_level_in_search_fields(self):\n         \"\"\"\n         When using a ManyToMany in search_fields at the second level behind a\n-        ForeignKey, Exists() must be applied and results shouldn't appear more\n+        ForeignKey, distinct() must be called and results shouldn't appear more\n         than once.\n         \"\"\"\n         lead = Musician.objects.create(name=\"Vox\")\n@@ -670,7 +661,6 @@ def test_no_duplicates_for_many_to_many_at_second_level_in_search_fields(self):\n         # There's only one Concert instance\n         self.assertEqual(cl.queryset.count(), 1)\n         # Queryset must be deletable.\n-        self.assertIs(cl.queryset.query.distinct, False)\n         cl.queryset.delete()\n         self.assertEqual(cl.queryset.count(), 0)\n \n@@ -820,23 +810,23 @@ def test_custom_lookup_with_pk_shortcut(self):\n         cl = m.get_changelist_instance(request)\n         self.assertCountEqual(cl.queryset, [abcd])\n \n-    def test_no_exists_for_m2m_in_list_filter_without_params(self):\n+    def test_no_distinct_for_m2m_in_list_filter_without_params(self):\n         \"\"\"\n         If a ManyToManyField is in list_filter but isn't in any lookup params,\n-        the changelist's query shouldn't have Exists().\n+        the changelist's query shouldn't have distinct.\n         \"\"\"\n         m = BandAdmin(Band, custom_site)\n         for lookup_params in ({}, {\"name\": \"test\"}):\n             request = self.factory.get(\"/band/\", lookup_params)\n             request.user = self.superuser\n             cl = m.get_changelist_instance(request)\n-            self.assertNotIn(\" EXISTS\", str(cl.queryset.query))\n+            self.assertIs(cl.queryset.query.distinct, False)\n \n-        # A ManyToManyField in params does have Exists() applied.\n+        # A ManyToManyField in params does have distinct applied.\n         request = self.factory.get(\"/band/\", {\"genres\": \"0\"})\n         request.user = self.superuser\n         cl = m.get_changelist_instance(request)\n-        self.assertIn(\" EXISTS\", str(cl.queryset.query))\n+        self.assertIs(cl.queryset.query.distinct, True)\n \n     def test_pagination(self):\n         \"\"\"\ndiff --git a/tests/delete_regress/tests.py b/tests/delete_regress/tests.py\n--- a/tests/delete_regress/tests.py\n+++ b/tests/delete_regress/tests.py\n@@ -396,10 +396,8 @@ def test_self_reference_with_through_m2m_at_second_level(self):\n \n \n class DeleteDistinct(SimpleTestCase):\n-    def test_disallowed_delete_distinct(self):\n-        msg = \"Cannot call delete() after .distinct().\"\n-        with self.assertRaisesMessage(TypeError, msg):\n-            Book.objects.distinct().delete()\n+    def test_disallowed_delete_distinct_on(self):\n+        msg = \"Cannot call delete() after .distinct(*fields).\"\n         with self.assertRaisesMessage(TypeError, msg):\n             Book.objects.distinct(\"id\").delete()\n \n",
  "problem_statement": "Deleting objects after searching related many to many field crashes the admin page\nDescription\n\t\nMinimal reproduction:\n# models.py\nclass Post(models.Model):\n title = models.String(...)\n authors = models.ManyToMany(\"User\", ...)\nclass User(models.Model):\n email = models.String(...)\n# admin.py\nclass PostAdmin(admin.ModelAdmin):\n search_fields = (\"title\", \"authors__email\")\nthen opening the admin site, opening the post page that contains only one post (any title and author assigned) and entering a search term (e.g the first 2 characters of the title), selecting the post and then using the delete action results in an Internal Sever Error 500 with an error/stack-trace:\nInternal Server Error: /admin/post/post/\nTraceback (most recent call last):\n File \"...lib/python3.7/site-packages/django/core/handlers/exception.py\", line 47, in inner\n\tresponse = get_response(request)\n File \"...lib/python3.7/site-packages/django/core/handlers/base.py\", line 181, in _get_response\n\tresponse = wrapped_callback(request, *callback_args, **callback_kwargs)\n File \"...lib/python3.7/site-packages/django/contrib/admin/options.py\", line 616, in wrapper\n\treturn self.admin_site.admin_view(view)(*args, **kwargs)\n File \"...lib/python3.7/site-packages/django/utils/decorators.py\", line 130, in _wrapped_view\n\tresponse = view_func(request, *args, **kwargs)\n File \"...lib/python3.7/site-packages/django/views/decorators/cache.py\", line 44, in _wrapped_view_func\n\tresponse = view_func(request, *args, **kwargs)\n File \"...lib/python3.7/site-packages/django/contrib/admin/sites.py\", line 241, in inner\n\treturn view(request, *args, **kwargs)\n File \"...lib/python3.7/site-packages/django/utils/decorators.py\", line 43, in _wrapper\n\treturn bound_method(*args, **kwargs)\n File \"...lib/python3.7/site-packages/django/utils/decorators.py\", line 130, in _wrapped_view\n\tresponse = view_func(request, *args, **kwargs)\n File \"...lib/python3.7/site-packages/django/contrib/admin/options.py\", line 1737, in changelist_view\n\tresponse = self.response_action(request, queryset=cl.get_queryset(request))\n File \"...lib/python3.7/site-packages/django/contrib/admin/options.py\", line 1406, in response_action\n\tresponse = func(self, request, queryset)\n File \"...lib/python3.7/site-packages/django/contrib/admin/actions.py\", line 45, in delete_selected\n\tmodeladmin.delete_queryset(request, queryset)\n File \"...lib/python3.7/site-packages/django/contrib/admin/options.py\", line 1107, in delete_queryset\n\tqueryset.delete()\n File \"...lib/python3.7/site-packages/django/db/models/query.py\", line 728, in delete\n\traise TypeError('Cannot call delete() after .distinct().')\nTypeError: Cannot call delete() after .distinct().\n\"POST /admin/post/post/?q=my HTTP/1.1\" 500 137654\nI can confirm that pip install django==3.1.8 fixes the error, and after having a look at the diff between stable/3.2.x and 3.1.8, I suspect the \"regression\" comes about from the work done on preserving the filters on delete or something along those lines - I haven't done a thorough investigation yet. Presumably .distinct() is being called because of the search involving the many to many field.\nI am using a Postgres database.\n",
  "hints_text": "This exception was introduce in 6307c3f1a123f5975c73b231e8ac4f115fd72c0d and revealed a possible data loss issue in the admin. IMO we should use Exists() instead of distinct(), e.g. diff --git a/django/contrib/admin/views/main.py b/django/contrib/admin/views/main.py index fefed29933..e9816ddd15 100644 --- a/django/contrib/admin/views/main.py +++ b/django/contrib/admin/views/main.py @@ -475,9 +475,8 @@ class ChangeList: if not qs.query.select_related: qs = self.apply_select_related(qs) - # Set ordering. + # Get ordering. ordering = self.get_ordering(request, qs) - qs = qs.order_by(*ordering) # Apply search results qs, search_use_distinct = self.model_admin.get_search_results(request, qs, self.query) @@ -487,11 +486,14 @@ class ChangeList: new_params=remaining_lookup_params, remove=self.get_filters_params(), ) + # Remove duplicates from results, if necessary if filters_use_distinct | search_use_distinct: - return qs.distinct() + from django.db.models import Exists, OuterRef + qs = qs.filter(pk=OuterRef('pk')) + return self.root_queryset.filter(Exists(qs)).order_by(*ordering) else: - return qs + return qs.order_by(*ordering) def apply_select_related(self, qs): if self.list_select_related is True:\n\u200bPR\nIn 4074f38e: Refs #32682 -- Fixed QuerySet.delete() crash on querysets with self-referential subqueries on MySQL.\nIn cd74aad: Refs #32682 -- Renamed use_distinct variable to may_have_duplicates. QuerySet.distinct() is not the only way to avoid duplicate, it's also not preferred.\nIn 18711820: Fixed #32682 -- Made admin changelist use Exists() instead of distinct() for preventing duplicates. Thanks Zain Patel for the report and Simon Charette for reviews. The exception introduced in 6307c3f1a123f5975c73b231e8ac4f115fd72c0d revealed a possible data loss issue in the admin.\nIn 7ad70340: [3.2.x] Refs #32682 -- Fixed QuerySet.delete() crash on querysets with self-referential subqueries on MySQL. Backport of 4074f38e1dcc93b859bbbfd6abd8441c3bca36b3 from main\nIn fbea64b: [3.2.x] Refs #32682 -- Renamed use_distinct variable to may_have_duplicates. QuerySet.distinct() is not the only way to avoid duplicate, it's also not preferred. Backport of cd74aad90e09865ae6cd8ca0377ef0a5008d14e9 from main\nIn 34981f39: [3.2.x] Fixed #32682 -- Made admin changelist use Exists() instead of distinct() for preventing duplicates. Thanks Zain Patel for the report and Simon Charette for reviews. The exception introduced in 6307c3f1a123f5975c73b231e8ac4f115fd72c0d revealed a possible data loss issue in the admin. Backport of 187118203197801c6cb72dc8b06b714b23b6dd3d from main\nIn baba733d: Refs #32682 -- Renamed lookup_needs_distinct() to lookup_spawns_duplicates(). Follow up to 187118203197801c6cb72dc8b06b714b23b6dd3d.",
  "created_at": "2023-07-04T21:49:35Z",
  "version": "5.0",
  "FAIL_TO_PASS": "[\"If a ManyToManyField is in list_filter but isn't in any lookup params,\", \"test_disallowed_delete_distinct_on (delete_regress.tests.DeleteDistinct.test_disallowed_delete_distinct_on)\"]",
  "PASS_TO_PASS": "[\"#15185 -- Allow no links from the 'change list' view grid.\", \"All rows containing each of the searched words are returned, where each\", \"Auto-created many-to-many through tables referencing a parent model are\", \"Cascade deletion works with ForeignKey.to_field set to non-PK.\", \"Deleting a proxy-of-proxy instance should bubble through to its proxy\", \"Deleting an instance of a concrete model should also delete objects\", \"Deleting the *proxy* instance bubbles through to its non-proxy and\", \"Django cascades deletes through generic-related objects to their\", \"Empty value display can be set in ModelAdmin or individual fields.\", \"Empty value display can be set on AdminSite.\", \"If a pair of proxy models are linked by an FK from one concrete parent\", \"If an M2M relationship has an explicitly-specified through model, and\", \"If the number of objects > chunk size, deletion still occurs.\", \"Inclusion tag result_list generates a table when with default\", \"Regression test for #10348: ChangeList.get_queryset() shouldn't\", \"Regression test for #13196: output of functions should be  localized\", \"Regression test for #13902: When using a ManyToMany in list_filter,\", \"Regression test for #14312: list_editable with pagination\", \"Regression test for #14982: EMPTY_CHANGELIST_VALUE should be honored\", \"Regression tests for #11791: Inclusion tag result_list generates a\", \"Regression tests for #12893: Pagination in admins changelist doesn't\", \"Regression tests for #14206: dynamic list_display support.\", \"Regression tests for #16257: dynamic list_display_links support.\", \"Regression tests for ticket #15653: ensure the number of pages\", \"Regression tests for ticket #17646: dynamic list_filter support.\", \"Regressions tests for #15819: If a field listed in list_filters\", \"Regressions tests for #15819: If a field listed in search_fields\", \"Searches over multi-valued relationships return rows from related\", \"Simultaneous edits of list_editable fields on the changelist by\", \"The primary key is used in the ordering of the changelist's results to\", \"When ModelAdmin.has_add_permission() returns False, the object-tools\", \"When using a ManyToMany in list_filter at the second level behind a\", \"When using a ManyToMany in search_fields at the second level behind a\", \"With a model (Researcher) that has two foreign keys pointing to the\", \"list_editable edits use a filtered queryset to limit memory usage.\", \"test_15776 (delete_regress.tests.DeleteCascadeTests.test_15776)\", \"test_19187_values (delete_regress.tests.ProxyDeleteTest.test_19187_values)\", \"test_builtin_lookup_in_search_fields (admin_changelist.tests.ChangeListTests.test_builtin_lookup_in_search_fields)\", \"test_changelist_search_form_validation (admin_changelist.tests.ChangeListTests.test_changelist_search_form_validation)\", \"test_clear_all_filters_link (admin_changelist.tests.ChangeListTests.test_clear_all_filters_link)\", \"test_clear_all_filters_link_callable_filter (admin_changelist.tests.ChangeListTests.test_clear_all_filters_link_callable_filter)\", \"test_custom_lookup_in_search_fields (admin_changelist.tests.ChangeListTests.test_custom_lookup_in_search_fields)\", \"test_custom_lookup_with_pk_shortcut (admin_changelist.tests.ChangeListTests.test_custom_lookup_with_pk_shortcut)\", \"test_custom_paginator (admin_changelist.tests.ChangeListTests.test_custom_paginator)\", \"test_dynamic_search_fields (admin_changelist.tests.ChangeListTests.test_dynamic_search_fields)\", \"test_get_edited_object_ids (admin_changelist.tests.ChangeListTests.test_get_edited_object_ids)\", \"test_get_list_editable_queryset (admin_changelist.tests.ChangeListTests.test_get_list_editable_queryset)\", \"test_get_list_editable_queryset_with_regex_chars_in_prefix (admin_changelist.tests.ChangeListTests.test_get_list_editable_queryset_with_regex_chars_in_prefix)\", \"test_get_select_related_custom_method (admin_changelist.tests.ChangeListTests.test_get_select_related_custom_method)\", \"test_list_editable_atomicity (admin_changelist.tests.ChangeListTests.test_list_editable_atomicity)\", \"test_many_search_terms (admin_changelist.tests.ChangeListTests.test_many_search_terms)\", \"test_meta_ordered_delete (delete_regress.tests.DeleteTests.test_meta_ordered_delete)\", \"test_missing_args (admin_changelist.tests.GetAdminLogTests.test_missing_args)\", \"test_no_clear_all_filters_link (admin_changelist.tests.ChangeListTests.test_no_clear_all_filters_link)\", \"test_non_integer_limit (admin_changelist.tests.GetAdminLogTests.test_non_integer_limit)\", \"test_pk_in_search_fields (admin_changelist.tests.ChangeListTests.test_pk_in_search_fields)\", \"test_repr (admin_changelist.tests.ChangeListTests.test_repr)\", \"test_search_bar_total_link_preserves_options (admin_changelist.tests.ChangeListTests.test_search_bar_total_link_preserves_options)\", \"test_search_help_text (admin_changelist.tests.ChangeListTests.test_search_help_text)\", \"test_select_related_as_empty_tuple (admin_changelist.tests.ChangeListTests.test_select_related_as_empty_tuple)\", \"test_select_related_as_tuple (admin_changelist.tests.ChangeListTests.test_select_related_as_tuple)\", \"test_select_related_preserved_when_multi_valued_in_search_fields (admin_changelist.tests.ChangeListTests.test_select_related_preserved_when_multi_valued_in_search_fields)\", \"test_self_reference_with_through_m2m_at_second_level (delete_regress.tests.DeleteTests.test_self_reference_with_through_m2m_at_second_level)\", \"test_set_querycount (delete_regress.tests.SetQueryCountTests.test_set_querycount)\", \"test_show_all (admin_changelist.tests.ChangeListTests.test_show_all)\", \"test_spanning_relations_with_custom_lookup_in_search_fields (admin_changelist.tests.ChangeListTests.test_spanning_relations_with_custom_lookup_in_search_fields)\", \"test_specified_ordering_by_f_expression (admin_changelist.tests.ChangeListTests.test_specified_ordering_by_f_expression)\", \"test_specified_ordering_by_f_expression_without_asc_desc (admin_changelist.tests.ChangeListTests.test_specified_ordering_by_f_expression_without_asc_desc)\", \"test_ticket_19102_annotate (delete_regress.tests.Ticket19102Tests.test_ticket_19102_annotate)\", \"test_ticket_19102_defer (delete_regress.tests.Ticket19102Tests.test_ticket_19102_defer)\", \"test_ticket_19102_extra (delete_regress.tests.Ticket19102Tests.test_ticket_19102_extra)\", \"test_ticket_19102_select_related (delete_regress.tests.Ticket19102Tests.test_ticket_19102_select_related)\", \"test_total_ordering_optimization (admin_changelist.tests.ChangeListTests.test_total_ordering_optimization)\", \"test_total_ordering_optimization_meta_constraints (admin_changelist.tests.ChangeListTests.test_total_ordering_optimization_meta_constraints)\", \"test_tuple_list_display (admin_changelist.tests.ChangeListTests.test_tuple_list_display)\", \"test_without_as (admin_changelist.tests.GetAdminLogTests.test_without_as)\", \"test_without_for_user (admin_changelist.tests.GetAdminLogTests.test_without_for_user)\", \"{% get_admin_log %} works if the user model's primary key isn't named\", \"{% get_admin_log %} works without specifying a user.\"]",
  "environment_setup_commit": "4a72da71001f154ea60906a2f74898d32b7322a7",
  "patch_files": [
    "django/contrib/admin/views/main.py",
    "django/db/models/query.py"
  ],
  "test_patch_files": [
    "tests/admin_changelist/tests.py",
    "tests/delete_regress/tests.py"
  ],
  "patch_diff_details": {
    "django/contrib/admin/views/main.py": {
      "diffs": [
        {
          "start_line_old": 32,
          "end_line_old": 32,
          "file_pos": 6,
          "file_context_length": 66485,
          "pos": 13,
          "context_length": 5939
        },
        {
          "start_line_old": 569,
          "end_line_old": 569,
          "file_pos": 6,
          "file_context_length": 66485,
          "closest_snippet_id": "/tmp/repos/django/django/contrib/admin/views/main.py_warnings_ChangeListSearchForm.__init__.self.fields.1",
          "closest_snippet_line_distance": 505,
          "pos": 26,
          "context_length": 10174
        },
        {
          "start_line_old": 583,
          "end_line_old": 593,
          "file_pos": 6,
          "file_context_length": 66485,
          "closest_snippet_id": "/tmp/repos/django/django/contrib/admin/views/main.py_warnings_ChangeListSearchForm.__init__.self.fields.1",
          "closest_snippet_line_distance": 529,
          "pos": 26,
          "context_length": 10174
        }
      ]
    },
    "django/db/models/query.py": {
      "diffs": [
        {
          "start_line_old": 1138,
          "end_line_old": 1139,
          "file_pos": 9,
          "file_context_length": 101183,
          "closest_snippet_id": "/tmp/repos/django/django/db/models/query.py_QuerySet._check_bulk_create_options_QuerySet._check_bulk_create_options.4.1",
          "closest_snippet_line_distance": 415,
          "pos": 42,
          "context_length": 16755
        }
      ]
    }
  },
  "vectors": 3771,
  "snippets": [
    {
      "position": 1,
      "id": "/tmp/repos/django/django/contrib/admin/options.py_ModelAdmin.get_search_results.may_have_duplicates_ModelAdmin.get_search_results.7.1",
      "distance": 0.932219922542572,
      "file_path": "django/contrib/admin/options.py",
      "start_line": 1161,
      "end_line": 1181,
      "tokens": 201,
      "context_length": 201
    },
    {
      "position": 2,
      "id": "/tmp/repos/django/django/db/models/deletion.py_Collector.collect.15_Collector.collect.15.3.3.3.1",
      "distance": 0.9423515200614929,
      "file_path": "django/db/models/deletion.py",
      "start_line": 377,
      "end_line": 401,
      "tokens": 273,
      "context_length": 474
    },
    {
      "position": 3,
      "id": "/tmp/repos/django/django/contrib/admin/options.py_ModelAdmin.get_deleted_objects_ModelAdmin._delete_view.15.1",
      "distance": 0.9462346434593201,
      "file_path": "django/contrib/admin/options.py",
      "start_line": 2117,
      "end_line": 2192,
      "tokens": 599,
      "context_length": 1073
    },
    {
      "position": 4,
      "id": "/tmp/repos/django/django/db/models/deletion.py_Collector.delete_",
      "distance": 0.9584547281265259,
      "file_path": "django/db/models/deletion.py",
      "start_line": 436,
      "end_line": 523,
      "tokens": 630,
      "context_length": 1703
    },
    {
      "position": 5,
      "id": "/tmp/repos/django/django/db/models/deletion.py_Collector.collect.11_Collector.collect.14.1.sub_objs.2",
      "distance": 0.9643930792808533,
      "file_path": "django/db/models/deletion.py",
      "start_line": 314,
      "end_line": 375,
      "tokens": 632,
      "context_length": 2335
    },
    {
      "position": 6,
      "id": "/tmp/repos/django/django/contrib/admin/options.py_ModelAdmin.get_formset_kwargs_ModelAdmin._create_formsets.8.1",
      "distance": 0.9658126831054688,
      "file_path": "django/contrib/admin/options.py",
      "start_line": 2254,
      "end_line": 2303,
      "tokens": 450,
      "context_length": 2785
    },
    {
      "position": 7,
      "id": "/tmp/repos/django/django/db/models/base.py_Model.delete_Model._get_FIELD_display.4.1",
      "distance": 0.9793347120285034,
      "file_path": "django/db/models/base.py",
      "start_line": 1161,
      "end_line": 1188,
      "tokens": 238,
      "context_length": 3023
    },
    {
      "position": 8,
      "id": "/tmp/repos/django/django/db/models/base.py_Model._perform_unique_checks_Model._perform_unique_checks.3.1",
      "distance": 0.9802337884902954,
      "file_path": "django/db/models/base.py",
      "start_line": 1339,
      "end_line": 1386,
      "tokens": 413,
      "context_length": 3436
    },
    {
      "position": 9,
      "id": "/tmp/repos/django/django/db/models/deletion.py_1_get_candidate_relations_to_delete.3.1",
      "distance": 0.9815353155136108,
      "file_path": "django/db/models/deletion.py",
      "start_line": 1,
      "end_line": 93,
      "tokens": 601,
      "context_length": 4037
    },
    {
      "position": 10,
      "id": "/tmp/repos/django/django/contrib/admin/options.py_ModelAdmin._response_post_save_ModelAdmin.response_post_save_change.2.1",
      "distance": 0.9870411157608032,
      "file_path": "django/contrib/admin/options.py",
      "start_line": 1531,
      "end_line": 1557,
      "tokens": 233,
      "context_length": 4270
    },
    {
      "position": 11,
      "id": "/tmp/repos/django/django/contrib/admin/utils.py_get_deleted_objects.format_callback_get_deleted_objects.10.1",
      "distance": 0.9906956553459167,
      "file_path": "django/contrib/admin/utils.py",
      "start_line": 140,
      "end_line": 177,
      "tokens": 302,
      "context_length": 4572
    },
    {
      "position": 12,
      "id": "/tmp/repos/django/django/db/models/fields/related.py_ManyToManyField._check_relationship_model_ManyToManyField._check_relationship_model.3.3.9.3.seen_from.5.1",
      "distance": 0.9933383464813232,
      "file_path": "django/db/models/fields/related.py",
      "start_line": 1463,
      "end_line": 1592,
      "tokens": 984,
      "context_length": 5556
    },
    {
      "position": 13,
      "id": "/tmp/repos/django/django/contrib/admin/views/main.py_warnings_ChangeListSearchForm.__init__.self.fields.1",
      "distance": 1.0056791305541992,
      "file_path": "django/contrib/admin/views/main.py",
      "start_line": 1,
      "end_line": 64,
      "tokens": 383,
      "context_length": 5939,
      "file_pos": 6
    },
    {
      "position": 14,
      "id": "/tmp/repos/django/django/contrib/admin/options.py_BaseModelAdmin.lookup_allowed_BaseModelAdmin.lookup_allowed.17.1",
      "distance": 1.0073552131652832,
      "file_path": "django/contrib/admin/options.py",
      "start_line": 441,
      "end_line": 506,
      "tokens": 550,
      "context_length": 6489
    },
    {
      "position": 15,
      "id": "/tmp/repos/django/django/db/models/base.py_Model._check_property_name_related_field_accessor_clashes_Model.63",
      "distance": 1.011130928993225,
      "file_path": "django/db/models/base.py",
      "start_line": 1892,
      "end_line": 1927,
      "tokens": 246,
      "context_length": 6735
    },
    {
      "position": 16,
      "id": "/tmp/repos/django/django/contrib/postgres/search.py_SearchQuery_SearchQuery.__str__.2.1",
      "distance": 1.0146963596343994,
      "file_path": "django/contrib/postgres/search.py",
      "start_line": 186,
      "end_line": 229,
      "tokens": 322,
      "context_length": 7057
    },
    {
      "position": 17,
      "id": "/tmp/repos/django/django/db/models/fields/related_descriptors.py_create_reverse_many_to_one_manager.RelatedManager.add.alters_data_create_reverse_many_to_one_manager.RelatedManager.27._clear.alters_data.1",
      "distance": 1.015761375427246,
      "file_path": "django/db/models/fields/related_descriptors.py",
      "start_line": 788,
      "end_line": 893,
      "tokens": 808,
      "context_length": 7865
    },
    {
      "position": 18,
      "id": "/tmp/repos/django/django/db/models/query.py_QuerySet.delete.alters_data_QuerySet._raw_delete.alters_data.1",
      "distance": 1.017897129058838,
      "file_path": "django/db/models/query.py",
      "start_line": 1163,
      "end_line": 1185,
      "tokens": 160,
      "context_length": 8025,
      "file_pos": 9
    },
    {
      "position": 19,
      "id": "/tmp/repos/django/django/db/backends/sqlite3/schema.py_DatabaseSchemaEditor.delete_model_DatabaseSchemaEditor.delete_model.1.2.2",
      "distance": 1.0184924602508545,
      "file_path": "django/db/backends/sqlite3/schema.py",
      "start_line": 372,
      "end_line": 388,
      "tokens": 132,
      "context_length": 8157
    },
    {
      "position": 20,
      "id": "/tmp/repos/django/django/contrib/admin/checks.py_ModelAdminChecks._check_search_fields_ModelAdminChecks._check_date_hierarchy.2.2.1.3.1.2.1.1",
      "distance": 1.0192747116088867,
      "file_path": "django/contrib/admin/checks.py",
      "start_line": 1159,
      "end_line": 1195,
      "tokens": 252,
      "context_length": 8409
    },
    {
      "position": 21,
      "id": "/tmp/repos/django/django/db/models/deletion.py_Collector_Collector.__init__.19",
      "distance": 1.0209664106369019,
      "file_path": "django/db/models/deletion.py",
      "start_line": 96,
      "end_line": 116,
      "tokens": 210,
      "context_length": 8619
    },
    {
      "position": 22,
      "id": "/tmp/repos/django/django/db/models/base.py_Model._check_model_name_db_lookup_clashes_Model._check_model_name_db_lookup_clashes.4.1",
      "distance": 1.0217289924621582,
      "file_path": "django/db/models/base.py",
      "start_line": 1868,
      "end_line": 1890,
      "tokens": 175,
      "context_length": 8794
    },
    {
      "position": 23,
      "id": "/tmp/repos/django/django/db/models/base.py_Model.check_Model.check.3.1",
      "distance": 1.023226261138916,
      "file_path": "django/db/models/base.py",
      "start_line": 1567,
      "end_line": 1603,
      "tokens": 288,
      "context_length": 9082
    },
    {
      "position": 24,
      "id": "/tmp/repos/django/django/contrib/admin/options.py_InlineModelAdmin.get_formset.DeleteProtectedModelForm_InlineModelAdmin.get_formset.18.1",
      "distance": 1.0243351459503174,
      "file_path": "django/contrib/admin/options.py",
      "start_line": 2400,
      "end_line": 2457,
      "tokens": 465,
      "context_length": 9547
    },
    {
      "position": 25,
      "id": "/tmp/repos/django/django/contrib/admin/options.py_ModelAdmin.log_deletion_ModelAdmin.log_deletion.3.1",
      "distance": 1.0243432521820068,
      "file_path": "django/contrib/admin/options.py",
      "start_line": 965,
      "end_line": 980,
      "tokens": 123,
      "context_length": 9670
    },
    {
      "position": 26,
      "id": "/tmp/repos/django/django/contrib/admin/views/main.py_ChangeList.get_queryset_ChangeList.get_queryset.2",
      "distance": 1.0251673460006714,
      "file_path": "django/contrib/admin/views/main.py",
      "start_line": 531,
      "end_line": 593,
      "tokens": 504,
      "context_length": 10174,
      "file_pos": 11
    },
    {
      "position": 27,
      "id": "/tmp/repos/django/django/contrib/admin/options.py_ModelAdmin._get_list_editable_queryset_ModelAdmin._get_list_editable_queryset.6.1",
      "distance": 1.0262129306793213,
      "file_path": "django/contrib/admin/options.py",
      "start_line": 1919,
      "end_line": 1933,
      "tokens": 132,
      "context_length": 10306
    },
    {
      "position": 28,
      "id": "/tmp/repos/django/django/db/migrations/autodetector.py_MigrationAutodetector.generate_deleted_models_MigrationAutodetector.generate_deleted_models.6.26",
      "distance": 1.02745521068573,
      "file_path": "django/db/migrations/autodetector.py",
      "start_line": 807,
      "end_line": 902,
      "tokens": 712,
      "context_length": 11018
    },
    {
      "position": 29,
      "id": "/tmp/repos/django/django/db/models/deletion.py_Collector.sort_Collector.sort.self.data.1",
      "distance": 1.0322678089141846,
      "file_path": "django/db/models/deletion.py",
      "start_line": 418,
      "end_line": 434,
      "tokens": 130,
      "context_length": 11148
    },
    {
      "position": 30,
      "id": "/tmp/repos/django/django/db/models/__init__.py_1_",
      "distance": 1.0363306999206543,
      "file_path": "django/db/models/__init__.py",
      "start_line": 1,
      "end_line": 116,
      "tokens": 682,
      "context_length": 11830
    },
    {
      "position": 31,
      "id": "/tmp/repos/django/django/contrib/admin/checks.py_ModelAdminChecks_ModelAdminChecks.check.1.1",
      "distance": 1.0379530191421509,
      "file_path": "django/contrib/admin/checks.py",
      "start_line": 800,
      "end_line": 818,
      "tokens": 183,
      "context_length": 12013
    },
    {
      "position": 32,
      "id": "/tmp/repos/django/django/contrib/admin/utils.py_get_deleted_objects_get_deleted_objects.perms_needed.1",
      "distance": 1.0391699075698853,
      "file_path": "django/contrib/admin/utils.py",
      "start_line": 122,
      "end_line": 138,
      "tokens": 139,
      "context_length": 12152
    },
    {
      "position": 33,
      "id": "/tmp/repos/django/django/contrib/admin/options.py_ModelAdmin.changelist_view.23_ModelAdmin.changelist_view.31.1",
      "distance": 1.0401880741119385,
      "file_path": "django/contrib/admin/options.py",
      "start_line": 2024,
      "end_line": 2115,
      "tokens": 784,
      "context_length": 12936
    },
    {
      "position": 34,
      "id": "/tmp/repos/django/django/contrib/admin/options.py_ModelAdmin.add_view_ModelAdmin._get_edited_object_pks.3.1",
      "distance": 1.0423667430877686,
      "file_path": "django/contrib/admin/options.py",
      "start_line": 1906,
      "end_line": 1917,
      "tokens": 149,
      "context_length": 13085
    },
    {
      "position": 35,
      "id": "/tmp/repos/django/django/db/models/base.py_Model_Model.__init__.cls.20",
      "distance": 1.0426993370056152,
      "file_path": "django/db/models/base.py",
      "start_line": 459,
      "end_line": 572,
      "tokens": 957,
      "context_length": 14042
    },
    {
      "position": 36,
      "id": "/tmp/repos/django/django/contrib/contenttypes/management/commands/remove_stale_contenttypes.py_Command.handle_",
      "distance": 1.043055772781372,
      "file_path": "django/contrib/contenttypes/management/commands/remove_stale_contenttypes.py",
      "start_line": 36,
      "end_line": 113,
      "tokens": 598,
      "context_length": 14640
    },
    {
      "position": 37,
      "id": "/tmp/repos/django/django/db/models/query.py_QuerySet.24_QuerySet._iterator.4.2",
      "distance": 1.0446267127990723,
      "file_path": "django/db/models/query.py",
      "start_line": 504,
      "end_line": 521,
      "tokens": 136,
      "context_length": 14776,
      "file_pos": 14
    },
    {
      "position": 38,
      "id": "/tmp/repos/django/django/db/models/query.py_QuerySet._check_bulk_create_options_QuerySet._check_bulk_create_options.4.1",
      "distance": 1.0452378988265991,
      "file_path": "django/db/models/query.py",
      "start_line": 672,
      "end_line": 724,
      "tokens": 424,
      "context_length": 15200,
      "file_pos": 14
    },
    {
      "position": 39,
      "id": "/tmp/repos/django/django/contrib/admin/options.py_ModelAdmin._changeform_view_ModelAdmin._changeform_view.14.3.title.1",
      "distance": 1.046057105064392,
      "file_path": "django/contrib/admin/options.py",
      "start_line": 1770,
      "end_line": 1872,
      "tokens": 780,
      "context_length": 15980
    },
    {
      "position": 40,
      "id": "/tmp/repos/django/django/db/models/sql/query.py_Query.clear_limits_Query.add_distinct_fields.self.distinct.1",
      "distance": 1.0477745532989502,
      "file_path": "django/db/models/sql/query.py",
      "start_line": 2076,
      "end_line": 2125,
      "tokens": 332,
      "context_length": 16312
    },
    {
      "position": 41,
      "id": "/tmp/repos/django/django/contrib/admin/options.py_ModelAdmin.render_delete_form_ModelAdmin.render_delete_form.4.1",
      "distance": 1.0486711263656616,
      "file_path": "django/contrib/admin/options.py",
      "start_line": 1676,
      "end_line": 1697,
      "tokens": 133,
      "context_length": 16445
    },
    {
      "position": 42,
      "id": "/tmp/repos/django/django/db/models/query.py_QuerySet.ain_bulk_QuerySet.delete.20.1",
      "distance": 1.0506155490875244,
      "file_path": "django/db/models/query.py",
      "start_line": 1127,
      "end_line": 1161,
      "tokens": 310,
      "context_length": 16755,
      "file_pos": 15
    },
    {
      "position": 43,
      "id": "/tmp/repos/django/django/contrib/admin/options.py_ModelAdmin.changelist_view_ModelAdmin.changelist_view.22",
      "distance": 1.0511313676834106,
      "file_path": "django/contrib/admin/options.py",
      "start_line": 1935,
      "end_line": 2023,
      "tokens": 676,
      "context_length": 17431
    },
    {
      "position": 44,
      "id": "/tmp/repos/django/django/db/models/base.py_Model.unique_error_message_Model.unique_error_message.4.5.3.1",
      "distance": 1.0514612197875977,
      "file_path": "django/db/models/base.py",
      "start_line": 1436,
      "end_line": 1466,
      "tokens": 220,
      "context_length": 17651
    },
    {
      "position": 45,
      "id": "/tmp/repos/django/django/contrib/admin/migrations/0001_initial.py_django.contrib.admin.models_",
      "distance": 1.0533638000488281,
      "file_path": "django/contrib/admin/migrations/0001_initial.py",
      "start_line": 1,
      "end_line": 76,
      "tokens": 363,
      "context_length": 18014
    },
    {
      "position": 46,
      "id": "/tmp/repos/django/django/contrib/sites/models.py_Site_",
      "distance": 1.0545084476470947,
      "file_path": "django/contrib/sites/models.py",
      "start_line": 79,
      "end_line": 121,
      "tokens": 236,
      "context_length": 18250
    },
    {
      "position": 47,
      "id": "/tmp/repos/django/django/db/models/fields/related.py_RelatedField._check_clashes.39_RelatedField._check_clashes.40.1",
      "distance": 1.054611086845398,
      "file_path": "django/db/models/fields/related.py",
      "start_line": 304,
      "end_line": 341,
      "tokens": 296,
      "context_length": 18546
    },
    {
      "position": 48,
      "id": "/tmp/repos/django/django/contrib/admin/options.py_ModelAdmin.history_view_ModelAdmin.history_view.18.1",
      "distance": 1.055060625076294,
      "file_path": "django/contrib/admin/options.py",
      "start_line": 2194,
      "end_line": 2252,
      "tokens": 444,
      "context_length": 18990
    },
    {
      "position": 49,
      "id": "/tmp/repos/django/django/contrib/admin/views/main.py_ChangeList.get_results_ChangeList.get_results.self.paginator.1",
      "distance": 1.0555795431137085,
      "file_path": "django/contrib/admin/views/main.py",
      "start_line": 307,
      "end_line": 345,
      "tokens": 356,
      "context_length": 19346,
      "file_pos": 17
    },
    {
      "position": 50,
      "id": "/tmp/repos/django/django/contrib/admin/views/main.py_ChangeList.apply_select_related_",
      "distance": 1.056469440460205,
      "file_path": "django/contrib/admin/views/main.py",
      "start_line": 595,
      "end_line": 627,
      "tokens": 227,
      "context_length": 19573,
      "file_pos": 17
    },
    {
      "position": 51,
      "id": "/tmp/repos/django/django/contrib/admin/options.py_InlineModelAdmin.has_add_permission_",
      "distance": 1.058388352394104,
      "file_path": "django/contrib/admin/options.py",
      "start_line": 2488,
      "end_line": 2523,
      "tokens": 315,
      "context_length": 19888
    },
    {
      "position": 52,
      "id": "/tmp/repos/django/django/contrib/admin/options.py_BaseModelAdmin.get_field_queryset_BaseModelAdmin.get_field_queryset.4.1",
      "distance": 1.065118670463562,
      "file_path": "django/contrib/admin/options.py",
      "start_line": 243,
      "end_line": 256,
      "tokens": 139,
      "context_length": 20027
    },
    {
      "position": 53,
      "id": "/tmp/repos/django/django/db/models/deletion.py_Collector.related_objects_Collector.instances_with_model.1.1.1",
      "distance": 1.0657871961593628,
      "file_path": "django/db/models/deletion.py",
      "start_line": 403,
      "end_line": 416,
      "tokens": 117,
      "context_length": 20144
    },
    {
      "position": 54,
      "id": "/tmp/repos/django/django/contrib/admin/options.py_BaseModelAdmin.has_delete_permission_BaseModelAdmin.has_delete_permission.4.1",
      "distance": 1.0660831928253174,
      "file_path": "django/contrib/admin/options.py",
      "start_line": 578,
      "end_line": 591,
      "tokens": 165,
      "context_length": 20309
    },
    {
      "position": 55,
      "id": "/tmp/repos/django/django/contrib/admin/checks.py_BaseModelAdminChecks_BaseModelAdminChecks.check.1.1",
      "distance": 1.069507122039795,
      "file_path": "django/contrib/admin/checks.py",
      "start_line": 176,
      "end_line": 192,
      "tokens": 155,
      "context_length": 20464
    },
    {
      "position": 56,
      "id": "/tmp/repos/django/django/db/backends/postgresql/features.py_operator_DatabaseFeatures.uses_server_side_binding.2.1",
      "distance": 1.0695303678512573,
      "file_path": "django/db/backends/postgresql/features.py",
      "start_line": 1,
      "end_line": 109,
      "tokens": 867,
      "context_length": 21331
    },
    {
      "position": 57,
      "id": "/tmp/repos/django/django/db/models/query.py_QuerySet.__class_getitem___QuerySet.__or__.10.1",
      "distance": 1.070023775100708,
      "file_path": "django/db/models/query.py",
      "start_line": 451,
      "end_line": 483,
      "tokens": 253,
      "context_length": 21584,
      "file_pos": 18
    },
    {
      "position": 58,
      "id": "/tmp/repos/django/django/db/backends/postgresql/operations.py_DatabaseOperations.on_conflict_suffix_sql_",
      "distance": 1.0705106258392334,
      "file_path": "django/db/backends/postgresql/operations.py",
      "start_line": 398,
      "end_line": 427,
      "tokens": 234,
      "context_length": 21818
    },
    {
      "position": 59,
      "id": "/tmp/repos/django/django/db/models/base.py_Model._perform_date_checks_Model._perform_date_checks.3.1",
      "distance": 1.0707826614379883,
      "file_path": "django/db/models/base.py",
      "start_line": 1388,
      "end_line": 1417,
      "tokens": 294,
      "context_length": 22112
    },
    {
      "position": 60,
      "id": "/tmp/repos/django/django/contrib/admin/options.py_BaseModelAdmin.get_empty_value_display_BaseModelAdmin.39",
      "distance": 1.070931077003479,
      "file_path": "django/contrib/admin/options.py",
      "start_line": 364,
      "end_line": 440,
      "tokens": 531,
      "context_length": 22643
    },
    {
      "position": 61,
      "id": "/tmp/repos/django/django/contrib/admin/checks.py_BaseModelAdminChecks._check_autocomplete_fields_item_BaseModelAdminChecks._check_autocomplete_fields_item.2.3.4.1",
      "distance": 1.0712695121765137,
      "file_path": "django/contrib/admin/checks.py",
      "start_line": 217,
      "end_line": 264,
      "tokens": 333,
      "context_length": 22976
    },
    {
      "position": 62,
      "id": "/tmp/repos/django/django/db/models/fields/related.py_ManyToManyField._check_table_uniqueness_ManyToManyField._check_table_uniqueness.8.1",
      "distance": 1.071749210357666,
      "file_path": "django/db/models/fields/related.py",
      "start_line": 1693,
      "end_line": 1743,
      "tokens": 431,
      "context_length": 23407
    },
    {
      "position": 63,
      "id": "/tmp/repos/django/django/core/management/commands/flush.py_Command.handle_",
      "distance": 1.0726549625396729,
      "file_path": "django/core/management/commands/flush.py",
      "start_line": 31,
      "end_line": 93,
      "tokens": 498,
      "context_length": 23905
    },
    {
      "position": 64,
      "id": "/tmp/repos/django/django/contrib/admin/checks.py_ModelAdminChecks._check_list_select_related_ModelAdminChecks._check_list_max_show_all.2.2.1.1",
      "distance": 1.0739493370056152,
      "file_path": "django/contrib/admin/checks.py",
      "start_line": 1054,
      "end_line": 1085,
      "tokens": 229,
      "context_length": 24134
    },
    {
      "position": 65,
      "id": "/tmp/repos/django/django/db/models/fields/related.py_ForeignKey._check_unique_ForeignKey.deconstruct.10.1",
      "distance": 1.0743408203125,
      "file_path": "django/db/models/fields/related.py",
      "start_line": 1036,
      "end_line": 1072,
      "tokens": 261,
      "context_length": 24395
    },
    {
      "position": 66,
      "id": "/tmp/repos/django/django/db/backends/oracle/schema.py_DatabaseSchemaEditor.delete_model_DatabaseSchemaEditor.delete_model.2",
      "distance": 1.0775971412658691,
      "file_path": "django/db/backends/oracle/schema.py",
      "start_line": 50,
      "end_line": 71,
      "tokens": 146,
      "context_length": 24541
    },
    {
      "position": 67,
      "id": "/tmp/repos/django/django/db/backends/base/schema.py_BaseDatabaseSchemaEditor._delete_composed_index_BaseDatabaseSchemaEditor._delete_composed_index.7",
      "distance": 1.0777618885040283,
      "file_path": "django/db/backends/base/schema.py",
      "start_line": 608,
      "end_line": 640,
      "tokens": 268,
      "context_length": 24809
    },
    {
      "position": 68,
      "id": "/tmp/repos/django/django/db/backends/oracle/creation.py_DatabaseCreation._handle_objects_preventing_db_destruction_DatabaseCreation._handle_objects_preventing_db_destruction.3",
      "distance": 1.0787962675094604,
      "file_path": "django/db/backends/oracle/creation.py",
      "start_line": 159,
      "end_line": 201,
      "tokens": 411,
      "context_length": 25220
    },
    {
      "position": 69,
      "id": "/tmp/repos/django/django/contrib/gis/db/backends/spatialite/schema.py_SpatialiteSchemaEditor.delete_model_SpatialiteSchemaEditor.delete_model.6",
      "distance": 1.0789680480957031,
      "file_path": "django/contrib/gis/db/backends/spatialite/schema.py",
      "start_line": 91,
      "end_line": 110,
      "tokens": 155,
      "context_length": 25375
    },
    {
      "position": 70,
      "id": "/tmp/repos/django/django/db/models/fields/related.py_RelatedField._check_related_query_name_is_valid_RelatedField._check_related_query_name_is_valid.6.1",
      "distance": 1.0794432163238525,
      "file_path": "django/db/models/fields/related.py",
      "start_line": 156,
      "end_line": 187,
      "tokens": 209,
      "context_length": 25584
    },
    {
      "position": 71,
      "id": "/tmp/repos/django/django/db/backends/postgresql/features.py_DatabaseFeatures.prohibits_null_characters_in_text_exception_",
      "distance": 1.0795413255691528,
      "file_path": "django/db/backends/postgresql/features.py",
      "start_line": 111,
      "end_line": 138,
      "tokens": 221,
      "context_length": 25805
    },
    {
      "position": 72,
      "id": "/tmp/repos/django/django/db/models/query.py_QuerySet._merge_known_related_objects_QuerySet._check_ordering_first_last_queryset_aggregation.1.1",
      "distance": 1.080445647239685,
      "file_path": "django/db/models/query.py",
      "start_line": 1922,
      "end_line": 1987,
      "tokens": 543,
      "context_length": 26348,
      "file_pos": 24
    },
    {
      "position": 73,
      "id": "/tmp/repos/django/django/contrib/admin/__init__.py_1_",
      "distance": 1.0804636478424072,
      "file_path": "django/contrib/admin/__init__.py",
      "start_line": 1,
      "end_line": 53,
      "tokens": 292,
      "context_length": 26640
    },
    {
      "position": 74,
      "id": "/tmp/repos/django/django/contrib/admin/filters.py_RelatedFieldListFilter_RelatedFieldListFilter.get_facet_counts.3.1",
      "distance": 1.0805480480194092,
      "file_path": "django/contrib/admin/filters.py",
      "start_line": 220,
      "end_line": 280,
      "tokens": 541,
      "context_length": 27181
    },
    {
      "position": 75,
      "id": "/tmp/repos/django/django/db/backends/postgresql/schema.py_DatabaseSchemaEditor.sql_update_with_default._index_columns_DatabaseSchemaEditor.sql_update_with_default._delete_index_sql.2.1",
      "distance": 1.0814770460128784,
      "file_path": "django/db/backends/postgresql/schema.py",
      "start_line": 312,
      "end_line": 337,
      "tokens": 235,
      "context_length": 27416
    },
    {
      "position": 76,
      "id": "/tmp/repos/django/django/contrib/admin/checks.py_InlineModelAdminChecks._check_exclude_of_parent_model_InlineModelAdminChecks._check_exclude_of_parent_model.errors.7.2.1.1",
      "distance": 1.0818390846252441,
      "file_path": "django/contrib/admin/checks.py",
      "start_line": 1258,
      "end_line": 1287,
      "tokens": 196,
      "context_length": 27612
    },
    {
      "position": 77,
      "id": "/tmp/repos/django/django/contrib/postgres/search.py_SearchHeadline.as_sql_SearchHeadline.as_sql.5.1",
      "distance": 1.0822677612304688,
      "file_path": "django/contrib/postgres/search.py",
      "start_line": 315,
      "end_line": 333,
      "tokens": 124,
      "context_length": 27736
    },
    {
      "position": 78,
      "id": "/tmp/repos/django/django/db/backends/base/schema.py_BaseDatabaseSchemaEditor.delete_model_BaseDatabaseSchemaEditor.delete_model.7.1.1",
      "distance": 1.0827367305755615,
      "file_path": "django/db/backends/base/schema.py",
      "start_line": 501,
      "end_line": 520,
      "tokens": 151,
      "context_length": 27887
    },
    {
      "position": 79,
      "id": "/tmp/repos/django/django/db/models/fields/related.py_ManyToManyField._check_ignored_options_ManyToManyField._check_ignored_options.6.1",
      "distance": 1.083136796951294,
      "file_path": "django/db/models/fields/related.py",
      "start_line": 1423,
      "end_line": 1461,
      "tokens": 213,
      "context_length": 28100
    },
    {
      "position": 80,
      "id": "/tmp/repos/django/django/db/models/fields/related_descriptors.py_ReverseOneToOneDescriptor.RelatedObjectDoesNotExist_ReverseOneToOneDescriptor.get_queryset.1.1",
      "distance": 1.0833817720413208,
      "file_path": "django/db/models/fields/related_descriptors.py",
      "start_line": 406,
      "end_line": 427,
      "tokens": 158,
      "context_length": 28258
    },
    {
      "position": 81,
      "id": "/tmp/repos/django/django/db/models/fields/related_lookups.py_RelatedLookupMixin.as_sql_",
      "distance": 1.0840719938278198,
      "file_path": "django/db/models/fields/related_lookups.py",
      "start_line": 160,
      "end_line": 200,
      "tokens": 250,
      "context_length": 28508
    },
    {
      "position": 82,
      "id": "/tmp/repos/django/django/db/models/fields/related_lookups.py_RelatedLookupMixin_RelatedLookupMixin.get_prep_lookup.2.1",
      "distance": 1.0852155685424805,
      "file_path": "django/db/models/fields/related_lookups.py",
      "start_line": 141,
      "end_line": 158,
      "tokens": 216,
      "context_length": 28724
    },
    {
      "position": 83,
      "id": "/tmp/repos/django/django/contrib/auth/admin.py_GroupAdmin_GroupAdmin.formfield_for_manytomany.2.1",
      "distance": 1.085693359375,
      "file_path": "django/contrib/auth/admin.py",
      "start_line": 28,
      "end_line": 40,
      "tokens": 130,
      "context_length": 28854
    },
    {
      "position": 84,
      "id": "/tmp/repos/django/django/db/models/options.py_bisect_DEFAULT_NAMES.1",
      "distance": 1.086439609527588,
      "file_path": "django/db/models/options.py",
      "start_line": 1,
      "end_line": 57,
      "tokens": 350,
      "context_length": 29204
    }
  ],
  "files": [
    {
      "file_path": "django/contrib/admin/options.py",
      "position": 1,
      "tokens": 19382,
      "context_length": 19382
    },
    {
      "file_path": "django/db/models/deletion.py",
      "position": 2,
      "tokens": 3982,
      "context_length": 23364
    },
    {
      "file_path": "django/db/models/base.py",
      "position": 3,
      "tokens": 19118,
      "context_length": 42482
    },
    {
      "file_path": "django/contrib/admin/utils.py",
      "position": 4,
      "tokens": 4382,
      "context_length": 46864
    },
    {
      "file_path": "django/db/models/fields/related.py",
      "position": 5,
      "tokens": 14704,
      "context_length": 61568
    },
    {
      "file_path": "django/contrib/admin/views/main.py",
      "position": 6,
      "tokens": 4917,
      "context_length": 66485
    },
    {
      "file_path": "django/contrib/postgres/search.py",
      "position": 7,
      "tokens": 2480,
      "context_length": 68965
    },
    {
      "file_path": "django/db/models/fields/related_descriptors.py",
      "position": 8,
      "tokens": 11658,
      "context_length": 80623
    },
    {
      "file_path": "django/db/models/query.py",
      "position": 9,
      "tokens": 20560,
      "context_length": 101183
    },
    {
      "file_path": "django/db/backends/sqlite3/schema.py",
      "position": 10,
      "tokens": 4848,
      "context_length": 106031
    },
    {
      "file_path": "django/contrib/admin/checks.py",
      "position": 11,
      "tokens": 9655,
      "context_length": 115686
    },
    {
      "file_path": "django/db/migrations/autodetector.py",
      "position": 12,
      "tokens": 13775,
      "context_length": 129461
    },
    {
      "file_path": "django/db/models/__init__.py",
      "position": 13,
      "tokens": 682,
      "context_length": 130143
    },
    {
      "file_path": "django/contrib/contenttypes/management/commands/remove_stale_contenttypes.py",
      "position": 14,
      "tokens": 800,
      "context_length": 130943
    },
    {
      "file_path": "django/db/models/sql/query.py",
      "position": 15,
      "tokens": 22927,
      "context_length": 153870
    },
    {
      "file_path": "django/contrib/admin/migrations/0001_initial.py",
      "position": 16,
      "tokens": 363,
      "context_length": 154233
    },
    {
      "file_path": "django/contrib/sites/models.py",
      "position": 17,
      "tokens": 789,
      "context_length": 155022
    },
    {
      "file_path": "django/db/backends/postgresql/features.py",
      "position": 18,
      "tokens": 1083,
      "context_length": 156105
    },
    {
      "file_path": "django/db/backends/postgresql/operations.py",
      "position": 19,
      "tokens": 3478,
      "context_length": 159583
    },
    {
      "file_path": "django/core/management/commands/flush.py",
      "position": 20,
      "tokens": 703,
      "context_length": 160286
    },
    {
      "file_path": "django/db/backends/oracle/schema.py",
      "position": 21,
      "tokens": 2355,
      "context_length": 162641
    },
    {
      "file_path": "django/db/backends/base/schema.py",
      "position": 22,
      "tokens": 15147,
      "context_length": 177788
    },
    {
      "file_path": "django/db/backends/oracle/creation.py",
      "position": 23,
      "tokens": 4015,
      "context_length": 181803
    },
    {
      "file_path": "django/contrib/gis/db/backends/spatialite/schema.py",
      "position": 24,
      "tokens": 1394,
      "context_length": 183197
    },
    {
      "file_path": "django/contrib/admin/__init__.py",
      "position": 25,
      "tokens": 292,
      "context_length": 183489
    },
    {
      "file_path": "django/contrib/admin/filters.py",
      "position": 26,
      "tokens": 5726,
      "context_length": 189215
    },
    {
      "file_path": "django/db/backends/postgresql/schema.py",
      "position": 27,
      "tokens": 2841,
      "context_length": 192056
    },
    {
      "file_path": "django/db/models/fields/related_lookups.py",
      "position": 28,
      "tokens": 1537,
      "context_length": 193593
    },
    {
      "file_path": "django/contrib/auth/admin.py",
      "position": 29,
      "tokens": 1807,
      "context_length": 195400
    },
    {
      "file_path": "django/db/models/options.py",
      "position": 30,
      "tokens": 7643,
      "context_length": 203043
    }
  ]
}