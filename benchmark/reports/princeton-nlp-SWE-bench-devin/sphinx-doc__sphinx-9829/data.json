{
  "instance_id": "sphinx-doc__sphinx-9829",
  "model_patch": "diff --git a/CHANGES b/CHANGES\nindex 33d20a45b..40b3a1d6e 100644\n--- a/CHANGES\n+++ b/CHANGES\n@@ -37,6 +37,9 @@ Deprecated\n Features added\n --------------\n \n+* #9829: Add 'defer' attribute to MathJax script loading to ensure compatibility with MathJax version 3.\n+\n+\n * #9639: autodoc: Support asynchronous generator functions\n * #9664: autodoc: ``autodoc-process-bases`` supports to inject reST snippet as a\n   base class\ndiff --git a/sphinx/ext/mathjax.py b/sphinx/ext/mathjax.py\nindex 46ca3b332..b9ed74d26 100644\n--- a/sphinx/ext/mathjax.py\n+++ b/sphinx/ext/mathjax.py\n@@ -22,12 +22,14 @@ from sphinx.errors import ExtensionError\n from sphinx.locale import _\n from sphinx.util.math import get_node_equation_number\n from sphinx.writers.html import HTMLTranslator\n+from sphinx.environment import BuildEnvironment\n \n # more information for mathjax secure url is here:\n # https://docs.mathjax.org/en/latest/start.html#secure-access-to-the-cdn\n MATHJAX_URL = 'https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js'\n \n-logger = sphinx.util.logging.getLogger(__name__)\n+from sphinx.util import logging\n+logger = logging.getLogger(__name__)\n \n \n def html_visit_math(self: HTMLTranslator, node: nodes.math) -> None:\n@@ -78,10 +80,11 @@ def install_mathjax(app: Sphinx, pagename: str, templatename: str, context: Dict\n         raise ExtensionError('mathjax_path config value must be set for the '\n                              'mathjax extension to work')\n \n-    domain = cast(MathDomain, app.env.get_domain('math'))\n+    env = cast(BuildEnvironment, app.env)  # Corrected type hint\n+    domain = cast(MathDomain, env.get_domain('math'))  # Moved cast for get_domain\n     if app.registry.html_assets_policy == 'always' or domain.has_equations(pagename):\n         # Enable mathjax only if equations exists\n-        options = {'async': 'async'}\n+        options = {'defer': 'defer'}\n         if app.config.mathjax_options:\n             options.update(app.config.mathjax_options)\n         app.add_js_file(app.config.mathjax_path, **options)  # type: ignore\n@@ -92,16 +95,18 @@ def install_mathjax(app: Sphinx, pagename: str, templatename: str, context: Dict\n                     'mathjax_config/mathjax2_config does not work '\n                     'for the current MathJax version, use mathjax3_config instead')\n             body = 'MathJax.Hub.Config(%s)' % json.dumps(app.config.mathjax2_config)\n-            app.add_js_file(None, type='text/x-mathjax-config', body=body)\n+            app.add_js_file('', type='text/x-mathjax-config', body=body)\n         if app.config.mathjax3_config:\n             body = 'window.MathJax = %s' % json.dumps(app.config.mathjax3_config)\n-            app.add_js_file(None, body=body)\n+            app.add_js_file('', body=body)\n \n+def noop_renderer(self, node):\n+    pass\n \n def setup(app: Sphinx) -> Dict[str, Any]:\n     app.add_html_math_renderer('mathjax',\n-                               (html_visit_math, None),\n-                               (html_visit_displaymath, None))\n+                               (html_visit_math, noop_renderer),\n+                               (html_visit_displaymath, noop_renderer))\n \n     app.add_config_value('mathjax_path', MATHJAX_URL, 'html')\n     app.add_config_value('mathjax_options', {}, 'html')\ndiff --git a/tox.ini b/tox.ini\nindex e703cd646..c6fcbc20a 100644\n--- a/tox.ini\n+++ b/tox.ini\n@@ -28,7 +28,7 @@ setenv =\n     PYTHONWARNINGS = all,ignore::ImportWarning:importlib._bootstrap_external,ignore::DeprecationWarning:site,ignore::DeprecationWarning:distutils,ignore::DeprecationWarning:pip._vendor.packaging.version\n     PYTEST_ADDOPTS = {env:PYTEST_ADDOPTS:} --color yes\n commands=\n-    python -X dev -m pytest --durations 25 {posargs}\n+    python -X dev -m pytest -rA --durations 25 {posargs}\n \n [testenv:du-latest]\n commands =\n",
  "model_name_or_path": "Devin",
  "pass_or_fail": "fail",
  "model_patch_files": [
    "CHANGES",
    "sphinx/ext/mathjax.py",
    "tox.ini"
  ],
  "repo": "sphinx-doc/sphinx",
  "base_commit": "6c6cc8a6f50b18331cb818160d168d7bb9c03e55",
  "patch": "diff --git a/sphinx/ext/mathjax.py b/sphinx/ext/mathjax.py\n--- a/sphinx/ext/mathjax.py\n+++ b/sphinx/ext/mathjax.py\n@@ -81,7 +81,7 @@ def install_mathjax(app: Sphinx, pagename: str, templatename: str, context: Dict\n     domain = cast(MathDomain, app.env.get_domain('math'))\n     if app.registry.html_assets_policy == 'always' or domain.has_equations(pagename):\n         # Enable mathjax only if equations exists\n-        options = {'async': 'async'}\n+        options = {'defer': 'defer'}\n         if app.config.mathjax_options:\n             options.update(app.config.mathjax_options)\n         app.add_js_file(app.config.mathjax_path, **options)  # type: ignore\n",
  "test_patch": "diff --git a/tests/test_ext_math.py b/tests/test_ext_math.py\n--- a/tests/test_ext_math.py\n+++ b/tests/test_ext_math.py\n@@ -71,7 +71,7 @@ def test_mathjax_options(app, status, warning):\n     app.builder.build_all()\n \n     content = (app.outdir / 'index.html').read_text()\n-    assert ('<script async=\"async\" integrity=\"sha384-0123456789\" '\n+    assert ('<script defer=\"defer\" integrity=\"sha384-0123456789\" '\n             'src=\"https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js\">'\n             '</script>' in content)\n \n",
  "problem_statement": "Add a way to defer loading of MathJax\n**Is your feature request related to a problem? Please describe.**\r\n\r\nIt is quite tricky to configure MathJax to work with Sphinx currently.\r\n\r\nSphinx loads MathJax asynchronously since https://github.com/sphinx-doc/sphinx/issues/3606 and https://github.com/sphinx-doc/sphinx/pull/5005.  While this was fine for MathJax 2, because of the special kind of ``<script>`` blocks mentioned in https://github.com/sphinx-doc/sphinx/issues/5616 , it doesn't work well with MathJax 3.\r\n\r\nIndeed, in MathJax 3, MathJax expect a config `<script>` block to be present *before* MathJax is loaded. Sphinx 4 added `mathjax3_config` parameter:\r\n\r\n```\r\n        if app.config.mathjax3_config:\r\n            body = 'window.MathJax = %s' % json.dumps(app.config.mathjax3_config)\r\n            app.add_js_file(None, body=body)\r\n```\r\n\r\nThis assumes that the `config` is a simple dictionary, which isn't sufficient: that configuration should be able to contain functions, for example.\r\n\r\nThe only possibility at the moment is to add a separate script file containing a MathJax configuration and to load it with ``app.add_js_file``.\r\n\r\n**Describe the solution you'd like**\r\n\r\nThere are three possibilities:\r\n\r\n- Allow arbitrary strings for mathjax3_config, and in that case don't JSON-serialize them.\r\n- Change `async` to `defer` when loading MathJax.\r\n- Make it possible for users to change `async` to `defer` themselves.  At the moment this isn't possible because the `async` flags is unconditionally added:\r\n\r\n  ```\r\n      if app.registry.html_assets_policy == 'always' or domain.has_equations(pagename):\r\n        # Enable mathjax only if equations exists\r\n        options = {'async': 'async'}\r\n        if app.config.mathjax_options:\r\n            options.update(app.config.mathjax_options)\r\n  ```\r\n\r\nThe latter two are preferable because they would allow individual pages to use different MathJax config by using a `.. raw::` block to override the default MathJax configuration on a given page (the script in that ``raw`` block will run before MathJax loads thanks to the `defer` option).\r\n\r\nCC @jfbu , the author of #5616.\r\n\r\nThanks!\r\n\n",
  "hints_text": "I'm not good at loading JS. Could you let me know the impact of changing `async` to `defer`? Are there any incompatible change for users? If not, we can change the loading option for MathJax to `defer` in the next version.\nI don't think it's an incompatible change.  For MDN:\r\n\r\n> - If the async attribute is present, then the script will be executed asynchronously as soon as it downloads.\r\n> - If the async attribute is absent but the defer attribute is present, then the script is executed when the page has finished parsing.\r\n\r\nSo changing `async` to `defer` just rules out certain behaviors (the script starts executing before the whole page is parsed), it shouldn't add any new ones.\r\n\nI found an explanation for this topic:\r\n\r\n>Note that here we use the defer attribute on both scripts so that they will execute in order, but still not block the rest of the page while the files are being downloaded to the browser. If the async attribute were used, there is no guarantee that the configuration would run first, and so you could get instances where MathJax doesn\u2019t get properly configured, and they would seem to occur randomly.\r\n>https://docs.mathjax.org/en/latest/web/configuration.html#using-a-local-file-for-configuration\r\n\r\nI believe using defer option instead is a good alternative.",
  "created_at": "2021-11-08T16:56:39Z",
  "version": "4.3",
  "FAIL_TO_PASS": "[\"tests/test_ext_math.py::test_mathjax_options\"]",
  "PASS_TO_PASS": "[\"tests/test_ext_math.py::test_math_compat\", \"tests/test_ext_math.py::test_math_eqref_format_html\", \"tests/test_ext_math.py::test_math_eqref_format_latex\", \"tests/test_ext_math.py::test_math_number_all_latex\", \"tests/test_ext_math.py::test_math_number_all_mathjax\", \"tests/test_ext_math.py::test_mathjax2_config\", \"tests/test_ext_math.py::test_mathjax3_config\", \"tests/test_ext_math.py::test_mathjax_align\", \"tests/test_ext_math.py::test_mathjax_is_installed_if_no_equations_when_forced\", \"tests/test_ext_math.py::test_mathjax_is_installed_only_if_document_having_math\", \"tests/test_ext_math.py::test_mathjax_is_not_installed_if_no_equations\", \"tests/test_ext_math.py::test_mathjax_numfig_html\"]",
  "environment_setup_commit": "6c6cc8a6f50b18331cb818160d168d7bb9c03e55",
  "patch_files": [
    "sphinx/ext/mathjax.py"
  ],
  "test_patch_files": [
    "tests/test_ext_math.py"
  ],
  "patch_diff_details": {
    "sphinx/ext/mathjax.py": {
      "diffs": [
        {
          "start_line_old": 84,
          "end_line_old": 84,
          "file_pos": 1,
          "file_context_length": 1197,
          "closest_snippet_id": "/tmp/repos/sphinx/sphinx/ext/mathjax.py_setup_",
          "closest_snippet_line_distance": 17,
          "pos": 2,
          "context_length": 528
        }
      ]
    }
  },
  "vectors": 1532,
  "snippets": [
    {
      "position": 1,
      "id": "/tmp/repos/sphinx/sphinx/ext/mathjax.py_setup_",
      "distance": 0.8073743581771851,
      "file_path": "sphinx/ext/mathjax.py",
      "start_line": 101,
      "end_line": 116,
      "tokens": 198,
      "context_length": 198,
      "file_pos": 1
    },
    {
      "position": 2,
      "id": "/tmp/repos/sphinx/sphinx/ext/mathjax.py_install_mathjax_install_mathjax.4.options.6.2",
      "distance": 0.8430867195129395,
      "file_path": "sphinx/ext/mathjax.py",
      "start_line": 73,
      "end_line": 98,
      "tokens": 330,
      "context_length": 528,
      "file_pos": 1
    },
    {
      "position": 3,
      "id": "/tmp/repos/sphinx/sphinx/ext/mathjax.py_json_html_visit_math.3",
      "distance": 0.9800481796264648,
      "file_path": "sphinx/ext/mathjax.py",
      "start_line": 13,
      "end_line": 38,
      "tokens": 222,
      "context_length": 750,
      "file_pos": 1
    },
    {
      "position": 4,
      "id": "/tmp/repos/sphinx/sphinx/ext/imgmath.py_setup_",
      "distance": 1.0598222017288208,
      "file_path": "sphinx/ext/imgmath.py",
      "start_line": 345,
      "end_line": 365,
      "tokens": 289,
      "context_length": 1039
    },
    {
      "position": 5,
      "id": "/tmp/repos/sphinx/sphinx/ext/mathjax.py_html_visit_displaymath_html_visit_displaymath.12",
      "distance": 1.0684057474136353,
      "file_path": "sphinx/ext/mathjax.py",
      "start_line": 41,
      "end_line": 70,
      "tokens": 356,
      "context_length": 1395,
      "file_pos": 2
    },
    {
      "position": 6,
      "id": "/tmp/repos/sphinx/sphinx/domains/math.py_MathDomain.resolve_any_xref_",
      "distance": 1.0707294940948486,
      "file_path": "sphinx/domains/math.py",
      "start_line": 127,
      "end_line": 156,
      "tokens": 240,
      "context_length": 1635
    },
    {
      "position": 7,
      "id": "/tmp/repos/sphinx/sphinx/application.py_Sphinx.add_js_file_Sphinx.add_js_file.3.2",
      "distance": 1.0891878604888916,
      "file_path": "sphinx/application.py",
      "start_line": 939,
      "end_line": 988,
      "tokens": 484,
      "context_length": 2119
    },
    {
      "position": 8,
      "id": "/tmp/repos/sphinx/sphinx/directives/patches.py_MathDirective.add_target_",
      "distance": 1.0979664325714111,
      "file_path": "sphinx/directives/patches.py",
      "start_line": 224,
      "end_line": 260,
      "tokens": 326,
      "context_length": 2445
    },
    {
      "position": 9,
      "id": "/tmp/repos/sphinx/sphinx/builders/latex/__init__.py_validate_config_values_default_latex_documents.4.1",
      "distance": 1.1255134344100952,
      "file_path": "sphinx/builders/latex/__init__.py",
      "start_line": 465,
      "end_line": 525,
      "tokens": 521,
      "context_length": 2966
    },
    {
      "position": 10,
      "id": "/tmp/repos/sphinx/sphinx/builders/html/__init__.py_70_",
      "distance": 1.1386947631835938,
      "file_path": "sphinx/builders/html/__init__.py",
      "start_line": 1305,
      "end_line": 1386,
      "tokens": 1000,
      "context_length": 3966
    },
    {
      "position": 11,
      "id": "/tmp/repos/sphinx/sphinx/ext/imgmath.py_posixpath_write_svg_depth.2.1",
      "distance": 1.1428148746490479,
      "file_path": "sphinx/ext/imgmath.py",
      "start_line": 11,
      "end_line": 82,
      "tokens": 506,
      "context_length": 4472
    },
    {
      "position": 12,
      "id": "/tmp/repos/sphinx/sphinx/directives/patches.py_MathDirective_MathDirective.run.9.1",
      "distance": 1.146048903465271,
      "file_path": "sphinx/directives/patches.py",
      "start_line": 194,
      "end_line": 222,
      "tokens": 218,
      "context_length": 4690
    },
    {
      "position": 13,
      "id": "/tmp/repos/sphinx/sphinx/domains/math.py_MathDomain.resolve_xref_MathDomain.resolve_xref.3.3.1.1",
      "distance": 1.1532742977142334,
      "file_path": "sphinx/domains/math.py",
      "start_line": 98,
      "end_line": 125,
      "tokens": 300,
      "context_length": 4990
    },
    {
      "position": 14,
      "id": "/tmp/repos/sphinx/sphinx/builders/html/__init__.py_validate_math_renderer_validate_html_extra_path.2.2.3.2",
      "distance": 1.1721408367156982,
      "file_path": "sphinx/builders/html/__init__.py",
      "start_line": 1219,
      "end_line": 1241,
      "tokens": 242,
      "context_length": 5232
    },
    {
      "position": 15,
      "id": "/tmp/repos/sphinx/sphinx/registry.py_SphinxComponentRegistry.add_html_math_renderer_SphinxComponentRegistry.add_html_theme.1",
      "distance": 1.1745340824127197,
      "file_path": "sphinx/registry.py",
      "start_line": 401,
      "end_line": 413,
      "tokens": 157,
      "context_length": 5389
    },
    {
      "position": 16,
      "id": "/tmp/repos/sphinx/sphinx/ext/autodoc/__init__.py_105_",
      "distance": 1.189329981803894,
      "file_path": "sphinx/ext/autodoc/__init__.py",
      "start_line": 2798,
      "end_line": 2841,
      "tokens": 528,
      "context_length": 5917
    },
    {
      "position": 17,
      "id": "/tmp/repos/sphinx/doc/conf.py_1_todo_include_todos.1",
      "distance": 1.1912264823913574,
      "file_path": "doc/conf.py",
      "start_line": 1,
      "end_line": 82,
      "tokens": 732,
      "context_length": 6649
    },
    {
      "position": 18,
      "id": "/tmp/repos/sphinx/sphinx/builders/latex/constants.py_ADDITIONAL_SETTINGS_",
      "distance": 1.1927449703216553,
      "file_path": "sphinx/builders/latex/constants.py",
      "start_line": 126,
      "end_line": 217,
      "tokens": 1040,
      "context_length": 7689
    },
    {
      "position": 19,
      "id": "/tmp/repos/sphinx/sphinx/builders/html/__init__.py_StandaloneHTMLBuilder.add_js_file_StandaloneHTMLBuilder.math_renderer_name.2.3.renderers.2.4.2.1",
      "distance": 1.1948758363723755,
      "file_path": "sphinx/builders/html/__init__.py",
      "start_line": 332,
      "end_line": 363,
      "tokens": 278,
      "context_length": 7967
    },
    {
      "position": 20,
      "id": "/tmp/repos/sphinx/sphinx/ext/imgmath.py_cleanup_tempdir_html_visit_math.3",
      "distance": 1.197711706161499,
      "file_path": "sphinx/ext/imgmath.py",
      "start_line": 275,
      "end_line": 311,
      "tokens": 328,
      "context_length": 8295
    },
    {
      "position": 21,
      "id": "/tmp/repos/sphinx/sphinx/domains/math.py_MathDomain_MathDomain.merge_domaindata.2.1",
      "distance": 1.2034167051315308,
      "file_path": "sphinx/domains/math.py",
      "start_line": 39,
      "end_line": 96,
      "tokens": 536,
      "context_length": 8831
    },
    {
      "position": 22,
      "id": "/tmp/repos/sphinx/sphinx/builders/latex/transforms.py_MathReferenceTransform_MathReferenceTransform.run.2.1.2.2",
      "distance": 1.2052841186523438,
      "file_path": "sphinx/builders/latex/transforms.py",
      "start_line": 532,
      "end_line": 548,
      "tokens": 182,
      "context_length": 9013
    },
    {
      "position": 23,
      "id": "/tmp/repos/sphinx/sphinx/builders/latex/__init__.py_setup_",
      "distance": 1.2139099836349487,
      "file_path": "sphinx/builders/latex/__init__.py",
      "start_line": 528,
      "end_line": 561,
      "tokens": 404,
      "context_length": 9417
    },
    {
      "position": 24,
      "id": "/tmp/repos/sphinx/sphinx/application.py_Sphinx.add_html_math_renderer_Sphinx.add_html_math_renderer.2",
      "distance": 1.2176237106323242,
      "file_path": "sphinx/application.py",
      "start_line": 1208,
      "end_line": 1222,
      "tokens": 165,
      "context_length": 9582
    },
    {
      "position": 25,
      "id": "/tmp/repos/sphinx/sphinx/ext/imgmath.py_html_visit_displaymath_html_visit_displaymath.7",
      "distance": 1.2251724004745483,
      "file_path": "sphinx/ext/imgmath.py",
      "start_line": 314,
      "end_line": 342,
      "tokens": 301,
      "context_length": 9883
    },
    {
      "position": 26,
      "id": "/tmp/repos/sphinx/sphinx/builders/html/__init__.py_setup_js_tag_helper_setup_js_tag_helper.4",
      "distance": 1.2291394472122192,
      "file_path": "sphinx/builders/html/__init__.py",
      "start_line": 1164,
      "end_line": 1196,
      "tokens": 281,
      "context_length": 10164
    },
    {
      "position": 27,
      "id": "/tmp/repos/sphinx/sphinx/builders/html/__init__.py_StandaloneHTMLBuilder.init_js_files_StandaloneHTMLBuilder.init_js_files.8.1",
      "distance": 1.2294201850891113,
      "file_path": "sphinx/builders/html/__init__.py",
      "start_line": 314,
      "end_line": 330,
      "tokens": 180,
      "context_length": 10344
    },
    {
      "position": 28,
      "id": "/tmp/repos/sphinx/sphinx/ext/imgmath.py_render_math_render_math.18.1",
      "distance": 1.2365907430648804,
      "file_path": "sphinx/ext/imgmath.py",
      "start_line": 213,
      "end_line": 272,
      "tokens": 592,
      "context_length": 10936
    },
    {
      "position": 29,
      "id": "/tmp/repos/sphinx/sphinx/domains/math.py_2_MathReferenceRole.result_nodes.2.1",
      "distance": 1.2373487949371338,
      "file_path": "sphinx/domains/math.py",
      "start_line": 11,
      "end_line": 36,
      "tokens": 188,
      "context_length": 11124
    },
    {
      "position": 30,
      "id": "/tmp/repos/sphinx/sphinx/jinja2glue.py_BuiltinTemplateLoader_BuiltinTemplateLoader.init.2.23.1",
      "distance": 1.239701271057129,
      "file_path": "sphinx/jinja2glue.py",
      "start_line": 145,
      "end_line": 193,
      "tokens": 463,
      "context_length": 11587
    },
    {
      "position": 31,
      "id": "/tmp/repos/sphinx/sphinx/highlighting.py_2_30.1",
      "distance": 1.247944712638855,
      "file_path": "sphinx/highlighting.py",
      "start_line": 11,
      "end_line": 68,
      "tokens": 613,
      "context_length": 12200
    },
    {
      "position": 32,
      "id": "/tmp/repos/sphinx/sphinx/util/docutils.py_using_user_docutils_conf_ElementLookupError.1",
      "distance": 1.2485003471374512,
      "file_path": "sphinx/util/docutils.py",
      "start_line": 146,
      "end_line": 170,
      "tokens": 194,
      "context_length": 12394
    },
    {
      "position": 33,
      "id": "/tmp/repos/sphinx/sphinx/util/jsdump.py_loads_",
      "distance": 1.2495355606079102,
      "file_path": "sphinx/util/jsdump.py",
      "start_line": 107,
      "end_line": 201,
      "tokens": 578,
      "context_length": 12972
    },
    {
      "position": 34,
      "id": "/tmp/repos/sphinx/sphinx/builders/latex/transforms.py_setup_",
      "distance": 1.2540221214294434,
      "file_path": "sphinx/builders/latex/transforms.py",
      "start_line": 613,
      "end_line": 630,
      "tokens": 142,
      "context_length": 13114
    },
    {
      "position": 35,
      "id": "/tmp/repos/sphinx/sphinx/application.py_Sphinx.add_latex_package_Sphinx.add_latex_package.2",
      "distance": 1.2554833889007568,
      "file_path": "sphinx/application.py",
      "start_line": 1069,
      "end_line": 1090,
      "tokens": 219,
      "context_length": 13333
    },
    {
      "position": 36,
      "id": "/tmp/repos/sphinx/sphinx/application.py_Sphinx.add_css_file_Sphinx.add_css_file.4.2",
      "distance": 1.2575805187225342,
      "file_path": "sphinx/application.py",
      "start_line": 990,
      "end_line": 1047,
      "tokens": 596,
      "context_length": 13929
    },
    {
      "position": 37,
      "id": "/tmp/repos/sphinx/sphinx/highlighting.py_PygmentsBridge_",
      "distance": 1.2587910890579224,
      "file_path": "sphinx/highlighting.py",
      "start_line": 71,
      "end_line": 180,
      "tokens": 873,
      "context_length": 14802
    },
    {
      "position": 38,
      "id": "/tmp/repos/sphinx/sphinx/cmd/build.py_handle_exception_jobs_argument.2.2.2.2.1.1",
      "distance": 1.260322093963623,
      "file_path": "sphinx/cmd/build.py",
      "start_line": 33,
      "end_line": 98,
      "tokens": 647,
      "context_length": 15449
    },
    {
      "position": 39,
      "id": "/tmp/repos/sphinx/sphinx/ext/imgmath.py_generate_latex_macro_generate_latex_macro.5.1",
      "distance": 1.2607486248016357,
      "file_path": "sphinx/ext/imgmath.py",
      "start_line": 85,
      "end_line": 106,
      "tokens": 188,
      "context_length": 15637
    },
    {
      "position": 40,
      "id": "/tmp/repos/sphinx/setup.py_15_15.5.2",
      "distance": 1.264128565788269,
      "file_path": "setup.py",
      "start_line": 81,
      "end_line": 173,
      "tokens": 643,
      "context_length": 16280
    },
    {
      "position": 41,
      "id": "/tmp/repos/sphinx/sphinx/builders/latex/constants.py_DEFAULT_SETTINGS_DEFAULT_SETTINGS.1",
      "distance": 1.2657794952392578,
      "file_path": "sphinx/builders/latex/constants.py",
      "start_line": 74,
      "end_line": 124,
      "tokens": 537,
      "context_length": 16817
    },
    {
      "position": 42,
      "id": "/tmp/repos/sphinx/sphinx/registry.py_SphinxComponentRegistry.load_extension_SphinxComponentRegistry.get_envversion.4.1",
      "distance": 1.2663075923919678,
      "file_path": "sphinx/registry.py",
      "start_line": 415,
      "end_line": 466,
      "tokens": 463,
      "context_length": 17280
    },
    {
      "position": 43,
      "id": "/tmp/repos/sphinx/sphinx/builders/latex/__init__.py_os_33",
      "distance": 1.2692687511444092,
      "file_path": "sphinx/builders/latex/__init__.py",
      "start_line": 11,
      "end_line": 42,
      "tokens": 331,
      "context_length": 17611
    },
    {
      "position": 44,
      "id": "/tmp/repos/sphinx/sphinx/ext/autodoc/__init__.py_re_exclude_members_option.3.1",
      "distance": 1.270120620727539,
      "file_path": "sphinx/ext/autodoc/__init__.py",
      "start_line": 13,
      "end_line": 114,
      "tokens": 788,
      "context_length": 18399
    },
    {
      "position": 45,
      "id": "/tmp/repos/sphinx/sphinx/registry.py_SphinxComponentRegistry.add_transform_SphinxComponentRegistry.add_latex_package.3.2.1",
      "distance": 1.2752176523208618,
      "file_path": "sphinx/registry.py",
      "start_line": 352,
      "end_line": 392,
      "tokens": 426,
      "context_length": 18825
    },
    {
      "position": 46,
      "id": "/tmp/repos/sphinx/sphinx/builders/latex/theming.py_configparser_Theme.update.3.1.2",
      "distance": 1.2786632776260376,
      "file_path": "sphinx/builders/latex/theming.py",
      "start_line": 11,
      "end_line": 48,
      "tokens": 256,
      "context_length": 19081
    },
    {
      "position": 47,
      "id": "/tmp/repos/sphinx/sphinx/directives/code.py_LiteralInclude.run_",
      "distance": 1.2800819873809814,
      "file_path": "sphinx/directives/code.py",
      "start_line": 407,
      "end_line": 470,
      "tokens": 642,
      "context_length": 19723
    },
    {
      "position": 48,
      "id": "/tmp/repos/sphinx/sphinx/ext/imgmath.py_compile_math_compile_math.12.4.1",
      "distance": 1.2909047603607178,
      "file_path": "sphinx/ext/imgmath.py",
      "start_line": 122,
      "end_line": 146,
      "tokens": 268,
      "context_length": 19991
    },
    {
      "position": 49,
      "id": "/tmp/repos/sphinx/sphinx/domains/javascript.py_2_logger.1",
      "distance": 1.2955306768417358,
      "file_path": "sphinx/domains/javascript.py",
      "start_line": 11,
      "end_line": 33,
      "tokens": 199,
      "context_length": 20190
    },
    {
      "position": 50,
      "id": "/tmp/repos/sphinx/sphinx/ext/autodoc/__init__.py_FunctionDocumenter_FunctionDocumenter.2",
      "distance": 1.295653223991394,
      "file_path": "sphinx/ext/autodoc/__init__.py",
      "start_line": 1281,
      "end_line": 1400,
      "tokens": 1004,
      "context_length": 21194
    },
    {
      "position": 51,
      "id": "/tmp/repos/sphinx/doc/conf.py_setup_",
      "distance": 1.2956781387329102,
      "file_path": "doc/conf.py",
      "start_line": 141,
      "end_line": 162,
      "tokens": 255,
      "context_length": 21449
    },
    {
      "position": 52,
      "id": "/tmp/repos/sphinx/sphinx/ext/graphviz.py_setup_",
      "distance": 1.2960610389709473,
      "file_path": "sphinx/ext/graphviz.py",
      "start_line": 405,
      "end_line": 421,
      "tokens": 196,
      "context_length": 21645
    },
    {
      "position": 53,
      "id": "/tmp/repos/sphinx/sphinx/domains/javascript.py_JavaScriptDomain.get_objects_",
      "distance": 1.297755241394043,
      "file_path": "sphinx/domains/javascript.py",
      "start_line": 450,
      "end_line": 473,
      "tokens": 200,
      "context_length": 21845
    },
    {
      "position": 54,
      "id": "/tmp/repos/sphinx/sphinx/extension.py_verify_needs_extensions_",
      "distance": 1.2986414432525635,
      "file_path": "sphinx/extension.py",
      "start_line": 44,
      "end_line": 82,
      "tokens": 273,
      "context_length": 22118
    },
    {
      "position": 55,
      "id": "/tmp/repos/sphinx/setup.py_os_Tee.flush.1",
      "distance": 1.2996633052825928,
      "file_path": "setup.py",
      "start_line": 1,
      "end_line": 78,
      "tokens": 478,
      "context_length": 22596
    },
    {
      "position": 56,
      "id": "/tmp/repos/sphinx/sphinx/writers/latex.py_LaTeXTranslator.__init__.1_LaTeXTranslator.__init__.self.handled_abbrs.1",
      "distance": 1.3035292625427246,
      "file_path": "sphinx/writers/latex.py",
      "start_line": 284,
      "end_line": 436,
      "tokens": 1688,
      "context_length": 24284
    },
    {
      "position": 57,
      "id": "/tmp/repos/sphinx/sphinx/ext/apidoc.py_get_parser_get_parser.18",
      "distance": 1.303841233253479,
      "file_path": "sphinx/ext/apidoc.py",
      "start_line": 303,
      "end_line": 368,
      "tokens": 752,
      "context_length": 25036
    },
    {
      "position": 58,
      "id": "/tmp/repos/sphinx/sphinx/ext/autodoc/typehints.py_augment_descriptions_with_types_",
      "distance": 1.3050403594970703,
      "file_path": "sphinx/ext/autodoc/typehints.py",
      "start_line": 130,
      "end_line": 185,
      "tokens": 460,
      "context_length": 25496
    },
    {
      "position": 59,
      "id": "/tmp/repos/sphinx/sphinx/ext/autodoc/directive.py_warnings_DummyOptionSpec.__getitem__.1.1",
      "distance": 1.3086541891098022,
      "file_path": "sphinx/ext/autodoc/directive.py",
      "start_line": 9,
      "end_line": 47,
      "tokens": 310,
      "context_length": 25806
    },
    {
      "position": 60,
      "id": "/tmp/repos/sphinx/sphinx/builders/latex/__init__.py_XINDY_LANG_OPTIONS_XINDY_LANG_OPTIONS.1",
      "distance": 1.3098814487457275,
      "file_path": "sphinx/builders/latex/__init__.py",
      "start_line": 44,
      "end_line": 99,
      "tokens": 825,
      "context_length": 26631
    },
    {
      "position": 61,
      "id": "/tmp/repos/sphinx/sphinx/application.py_Sphinx.add_stylesheet_Sphinx.add_stylesheet.7",
      "distance": 1.3120250701904297,
      "file_path": "sphinx/application.py",
      "start_line": 1049,
      "end_line": 1067,
      "tokens": 138,
      "context_length": 26769
    },
    {
      "position": 62,
      "id": "/tmp/repos/sphinx/sphinx/directives/patches.py_os_logger.1",
      "distance": 1.3134348392486572,
      "file_path": "sphinx/directives/patches.py",
      "start_line": 9,
      "end_line": 44,
      "tokens": 292,
      "context_length": 27061
    },
    {
      "position": 63,
      "id": "/tmp/repos/sphinx/sphinx/ext/autodoc/__init__.py_MethodDocumenter.1_MethodDocumenter.2",
      "distance": 1.31494140625,
      "file_path": "sphinx/ext/autodoc/__init__.py",
      "start_line": 2070,
      "end_line": 2275,
      "tokens": 1863,
      "context_length": 28924
    },
    {
      "position": 64,
      "id": "/tmp/repos/sphinx/sphinx/ext/todo.py_setup_",
      "distance": 1.3159148693084717,
      "file_path": "sphinx/ext/todo.py",
      "start_line": 225,
      "end_line": 248,
      "tokens": 214,
      "context_length": 29138
    },
    {
      "position": 65,
      "id": "/tmp/repos/sphinx/sphinx/directives/other.py_setup_",
      "distance": 1.3160526752471924,
      "file_path": "sphinx/directives/other.py",
      "start_line": 369,
      "end_line": 393,
      "tokens": 228,
      "context_length": 29366
    },
    {
      "position": 66,
      "id": "/tmp/repos/sphinx/sphinx/builders/manpage.py_default_man_pages_",
      "distance": 1.3168065547943115,
      "file_path": "sphinx/builders/manpage.py",
      "start_line": 110,
      "end_line": 129,
      "tokens": 166,
      "context_length": 29532
    },
    {
      "position": 67,
      "id": "/tmp/repos/sphinx/sphinx/application.py_builtin_extensions_logger.1",
      "distance": 1.316962480545044,
      "file_path": "sphinx/application.py",
      "start_line": 61,
      "end_line": 123,
      "tokens": 494,
      "context_length": 30026
    },
    {
      "position": 68,
      "id": "/tmp/repos/sphinx/sphinx/ext/autodoc/__init__.py_NonDataDescriptorMixin_NonDataDescriptorMixin.get_doc.1.4.2",
      "distance": 1.3170238733291626,
      "file_path": "sphinx/ext/autodoc/__init__.py",
      "start_line": 2278,
      "end_line": 2306,
      "tokens": 248,
      "context_length": 30274
    },
    {
      "position": 69,
      "id": "/tmp/repos/sphinx/sphinx/jinja2glue.py_2__toint.1.2.1.1",
      "distance": 1.3170530796051025,
      "file_path": "sphinx/jinja2glue.py",
      "start_line": 11,
      "end_line": 44,
      "tokens": 219,
      "context_length": 30493
    },
    {
      "position": 70,
      "id": "/tmp/repos/sphinx/sphinx/application.py_Sphinx.set_html_assets_policy_Sphinx.html_themes.2.1",
      "distance": 1.3181421756744385,
      "file_path": "sphinx/application.py",
      "start_line": 1273,
      "end_line": 1289,
      "tokens": 143,
      "context_length": 30636
    },
    {
      "position": 71,
      "id": "/tmp/repos/sphinx/sphinx/domains/javascript.py_JSObject.add_target_and_index_JSObject.add_target_and_index.12.2.1",
      "distance": 1.3183825016021729,
      "file_path": "sphinx/domains/javascript.py",
      "start_line": 119,
      "end_line": 140,
      "tokens": 283,
      "context_length": 30919
    },
    {
      "position": 72,
      "id": "/tmp/repos/sphinx/sphinx/domains/index.py_IndexDomain_IndexDomain.merge_domaindata.1.1",
      "distance": 1.3185009956359863,
      "file_path": "sphinx/domains/index.py",
      "start_line": 32,
      "end_line": 46,
      "tokens": 129,
      "context_length": 31048
    },
    {
      "position": 73,
      "id": "/tmp/repos/sphinx/sphinx/transforms/__init__.py_setup_",
      "distance": 1.3226375579833984,
      "file_path": "sphinx/transforms/__init__.py",
      "start_line": 408,
      "end_line": 429,
      "tokens": 172,
      "context_length": 31220
    },
    {
      "position": 74,
      "id": "/tmp/repos/sphinx/sphinx/domains/python.py_setup_",
      "distance": 1.3234879970550537,
      "file_path": "sphinx/domains/python.py",
      "start_line": 1460,
      "end_line": 1474,
      "tokens": 110,
      "context_length": 31330
    },
    {
      "position": 75,
      "id": "/tmp/repos/sphinx/sphinx/builders/latex/constants.py_2_LUALATEX_DEFAULT_FONTPKG.1",
      "distance": 1.324317216873169,
      "file_path": "sphinx/builders/latex/constants.py",
      "start_line": 11,
      "end_line": 72,
      "tokens": 612,
      "context_length": 31942
    },
    {
      "position": 76,
      "id": "/tmp/repos/sphinx/sphinx/ext/viewcode.py_setup_",
      "distance": 1.3245980739593506,
      "file_path": "sphinx/ext/viewcode.py",
      "start_line": 344,
      "end_line": 363,
      "tokens": 216,
      "context_length": 32158
    },
    {
      "position": 77,
      "id": "/tmp/repos/sphinx/sphinx/builders/epub3.py_setup_",
      "distance": 1.325100302696228,
      "file_path": "sphinx/builders/epub3.py",
      "start_line": 241,
      "end_line": 284,
      "tokens": 607,
      "context_length": 32765
    },
    {
      "position": 78,
      "id": "/tmp/repos/sphinx/sphinx/cmd/quickstart.py_argparse_choice",
      "distance": 1.3251099586486816,
      "file_path": "sphinx/cmd/quickstart.py",
      "start_line": 11,
      "end_line": 119,
      "tokens": 756,
      "context_length": 33521
    },
    {
      "position": 79,
      "id": "/tmp/repos/sphinx/sphinx/environment/__init__.py_BuildEnvironment.check_dependents_BuildEnvironment.get_doctree.6.1",
      "distance": 1.3253123760223389,
      "file_path": "sphinx/environment/__init__.py",
      "start_line": 445,
      "end_line": 523,
      "tokens": 687,
      "context_length": 34208
    },
    {
      "position": 80,
      "id": "/tmp/repos/sphinx/sphinx/ext/autodoc/__init__.py_SlotsMixin.get_doc_SlotsMixin._datadescriptor.2.2.1.1",
      "distance": 1.3272045850753784,
      "file_path": "sphinx/ext/autodoc/__init__.py",
      "start_line": 2338,
      "end_line": 2361,
      "tokens": 210,
      "context_length": 34418
    },
    {
      "position": 81,
      "id": "/tmp/repos/sphinx/sphinx/writers/latex.py_LaTeXTranslator.visit_math_reference_",
      "distance": 1.3283523321151733,
      "file_path": "sphinx/writers/latex.py",
      "start_line": 2065,
      "end_line": 2091,
      "tokens": 251,
      "context_length": 34669
    },
    {
      "position": 82,
      "id": "/tmp/repos/sphinx/sphinx/domains/javascript.py_JavaScriptDomain_JavaScriptDomain.clear_doc.2.1.1",
      "distance": 1.3286869525909424,
      "file_path": "sphinx/domains/javascript.py",
      "start_line": 334,
      "end_line": 393,
      "tokens": 626,
      "context_length": 35295
    },
    {
      "position": 83,
      "id": "/tmp/repos/sphinx/sphinx/ext/autodoc/__init__.py_SlotsMixin_SlotsMixin.should_suppress_value_header.1.2.1.1",
      "distance": 1.3288865089416504,
      "file_path": "sphinx/ext/autodoc/__init__.py",
      "start_line": 2309,
      "end_line": 2336,
      "tokens": 198,
      "context_length": 35493
    },
    {
      "position": 84,
      "id": "/tmp/repos/sphinx/sphinx/ext/autodoc/__init__.py_Documenter.add_content_Documenter.add_content.9.1.1",
      "distance": 1.3299667835235596,
      "file_path": "sphinx/ext/autodoc/__init__.py",
      "start_line": 601,
      "end_line": 642,
      "tokens": 409,
      "context_length": 35902
    },
    {
      "position": 85,
      "id": "/tmp/repos/sphinx/sphinx/ext/autodoc/__init__.py_UninitializedGlobalVariableMixin_UninitializedGlobalVariableMixin.get_doc.1.2.2",
      "distance": 1.330217719078064,
      "file_path": "sphinx/ext/autodoc/__init__.py",
      "start_line": 1896,
      "end_line": 1934,
      "tokens": 307,
      "context_length": 36209
    },
    {
      "position": 86,
      "id": "/tmp/repos/sphinx/sphinx/pycode/ast.py_sys_OPERATORS.1",
      "distance": 1.3304202556610107,
      "file_path": "sphinx/pycode/ast.py",
      "start_line": 11,
      "end_line": 44,
      "tokens": 214,
      "context_length": 36423
    },
    {
      "position": 87,
      "id": "/tmp/repos/sphinx/doc/conf.py_extlinks_parse_event.8.1",
      "distance": 1.330773949623108,
      "file_path": "doc/conf.py",
      "start_line": 83,
      "end_line": 138,
      "tokens": 476,
      "context_length": 36899
    },
    {
      "position": 88,
      "id": "/tmp/repos/sphinx/utils/jssplitter_generator.py_json_js_src.1",
      "distance": 1.3314411640167236,
      "file_path": "utils/jssplitter_generator.py",
      "start_line": 1,
      "end_line": 80,
      "tokens": 529,
      "context_length": 37428
    },
    {
      "position": 89,
      "id": "/tmp/repos/sphinx/sphinx/util/docutils.py_sphinx_domains_sphinx_domains.disable.roles.role.1",
      "distance": 1.3316309452056885,
      "file_path": "sphinx/util/docutils.py",
      "start_line": 173,
      "end_line": 197,
      "tokens": 192,
      "context_length": 37620
    },
    {
      "position": 90,
      "id": "/tmp/repos/sphinx/sphinx/domains/cpp.py_ASTDeclSpecs.get_id_ASTDeclaratorNameParamQual.describe_signature.4.1",
      "distance": 1.3319300413131714,
      "file_path": "sphinx/domains/cpp.py",
      "start_line": 2301,
      "end_line": 2520,
      "tokens": 1639,
      "context_length": 39259
    }
  ],
  "files": [
    {
      "file_path": "sphinx/ext/mathjax.py",
      "position": 1,
      "tokens": 1197,
      "context_length": 1197
    },
    {
      "file_path": "sphinx/ext/imgmath.py",
      "position": 2,
      "tokens": 3185,
      "context_length": 4382
    },
    {
      "file_path": "sphinx/domains/math.py",
      "position": 3,
      "tokens": 1302,
      "context_length": 5684
    },
    {
      "file_path": "sphinx/application.py",
      "position": 4,
      "tokens": 11757,
      "context_length": 17441
    },
    {
      "file_path": "sphinx/directives/patches.py",
      "position": 5,
      "tokens": 1938,
      "context_length": 19379
    },
    {
      "file_path": "sphinx/builders/latex/__init__.py",
      "position": 6,
      "tokens": 5712,
      "context_length": 25091
    },
    {
      "file_path": "sphinx/builders/html/__init__.py",
      "position": 7,
      "tokens": 12363,
      "context_length": 37454
    },
    {
      "file_path": "sphinx/registry.py",
      "position": 8,
      "tokens": 4640,
      "context_length": 42094
    },
    {
      "file_path": "sphinx/ext/autodoc/__init__.py",
      "position": 9,
      "tokens": 23912,
      "context_length": 66006
    },
    {
      "file_path": "doc/conf.py",
      "position": 10,
      "tokens": 1465,
      "context_length": 67471
    },
    {
      "file_path": "sphinx/builders/latex/constants.py",
      "position": 11,
      "tokens": 2245,
      "context_length": 69716
    },
    {
      "file_path": "sphinx/builders/latex/transforms.py",
      "position": 12,
      "tokens": 4324,
      "context_length": 74040
    },
    {
      "file_path": "sphinx/jinja2glue.py",
      "position": 13,
      "tokens": 1625,
      "context_length": 75665
    },
    {
      "file_path": "sphinx/highlighting.py",
      "position": 14,
      "tokens": 1539,
      "context_length": 77204
    },
    {
      "file_path": "sphinx/util/docutils.py",
      "position": 15,
      "tokens": 4201,
      "context_length": 81405
    },
    {
      "file_path": "sphinx/util/jsdump.py",
      "position": 16,
      "tokens": 1406,
      "context_length": 82811
    },
    {
      "file_path": "sphinx/cmd/build.py",
      "position": 17,
      "tokens": 2662,
      "context_length": 85473
    },
    {
      "file_path": "setup.py",
      "position": 18,
      "tokens": 1773,
      "context_length": 87246
    },
    {
      "file_path": "sphinx/builders/latex/theming.py",
      "position": 19,
      "tokens": 1024,
      "context_length": 88270
    },
    {
      "file_path": "sphinx/directives/code.py",
      "position": 20,
      "tokens": 3851,
      "context_length": 92121
    },
    {
      "file_path": "sphinx/domains/javascript.py",
      "position": 21,
      "tokens": 4153,
      "context_length": 96274
    },
    {
      "file_path": "sphinx/ext/graphviz.py",
      "position": 22,
      "tokens": 3736,
      "context_length": 100010
    },
    {
      "file_path": "sphinx/extension.py",
      "position": 23,
      "tokens": 563,
      "context_length": 100573
    },
    {
      "file_path": "sphinx/writers/latex.py",
      "position": 24,
      "tokens": 19391,
      "context_length": 119964
    },
    {
      "file_path": "sphinx/ext/apidoc.py",
      "position": 25,
      "tokens": 4234,
      "context_length": 124198
    },
    {
      "file_path": "sphinx/ext/autodoc/typehints.py",
      "position": 26,
      "tokens": 1454,
      "context_length": 125652
    },
    {
      "file_path": "sphinx/ext/autodoc/directive.py",
      "position": 27,
      "tokens": 1451,
      "context_length": 127103
    },
    {
      "file_path": "sphinx/ext/todo.py",
      "position": 28,
      "tokens": 1841,
      "context_length": 128944
    },
    {
      "file_path": "sphinx/directives/other.py",
      "position": 29,
      "tokens": 3127,
      "context_length": 132071
    },
    {
      "file_path": "sphinx/builders/manpage.py",
      "position": 30,
      "tokens": 963,
      "context_length": 133034
    },
    {
      "file_path": "sphinx/domains/index.py",
      "position": 31,
      "tokens": 943,
      "context_length": 133977
    },
    {
      "file_path": "sphinx/transforms/__init__.py",
      "position": 32,
      "tokens": 3172,
      "context_length": 137149
    },
    {
      "file_path": "sphinx/domains/python.py",
      "position": 33,
      "tokens": 12618,
      "context_length": 149767
    },
    {
      "file_path": "sphinx/ext/viewcode.py",
      "position": 34,
      "tokens": 3097,
      "context_length": 152864
    },
    {
      "file_path": "sphinx/builders/epub3.py",
      "position": 35,
      "tokens": 2587,
      "context_length": 155451
    },
    {
      "file_path": "sphinx/cmd/quickstart.py",
      "position": 36,
      "tokens": 5570,
      "context_length": 161021
    },
    {
      "file_path": "sphinx/environment/__init__.py",
      "position": 37,
      "tokens": 5521,
      "context_length": 166542
    },
    {
      "file_path": "sphinx/pycode/ast.py",
      "position": 38,
      "tokens": 2087,
      "context_length": 168629
    },
    {
      "file_path": "utils/jssplitter_generator.py",
      "position": 39,
      "tokens": 974,
      "context_length": 169603
    },
    {
      "file_path": "sphinx/domains/cpp.py",
      "position": 40,
      "tokens": 66905,
      "context_length": 236508
    }
  ]
}